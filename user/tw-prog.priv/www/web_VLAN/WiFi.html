<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns= "http://www.w3c.org/1999/xhtml">

<head>
<title>D-LINK</title>
<!-- for browser tab logo -->
<link rel="icon" href="/image/dlink-favicon.ico">
<link rel="shortcut icon" href="/image/favicon.ico" type="image/x-icon" /> 
<meta http-equiv="X-UA-Compatible" content="IE=9">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta http-equiv="Content-Type" content="text/css">
<link href="css/jquery.selectbox.css" type="text/css" rel="stylesheet" />
<link href="css/style_pages.css" type="text/css" rel="stylesheet" media="all" />
<script type="text/javascript" charset="utf-8" src="/js/initialJQ.js"></script>
<script type="text/javascript" charset="utf-8" src="/js/initialJS.js"></script>
<script type="text/javascript" charset="utf-8" src="/js/jquery.validate.js"></script>
<script type="text/javascript" charset="utf-8" src="/js/SOAP/SOAPWLanRadio.js"></script>
<script type="text/javascript" charset="utf-8" src="/js/SOAP/SOAPSchedule.js"></script>
<script type="text/javascript" charset="utf-8" src="/js/SOAP/SOAPCovr.js"></script>

<link rel="stylesheet" type="text/css" href="css/style_pop.css" media="all" />
<script type="text/javascript" charset="utf-8" src="/js/popView.js"></script>

<script type="text/javascript">
//xframeoption
if(top!=self){top.location=self.location;}

//session
if (sessionStorage.getItem('PrivateKey') === null){
	window.location.replace('../info/Login.html');
}

	var textautoEU = "";
	var smartTrue;
	var covrTrue;
	var _ReciprocalNumber = 25;
	
	/* Global variable */
	/* init wireless support mode */
	var guest_datalist = new Array();
	var wifi_datalist = new Array();

	function WiFiSetting(band, settingsObj, securityObj)
	{
		this.band = band;
		this.setting = settingsObj;
		this.security = securityObj;
	}
	
	function GuestSetting(band, settingsObj)
	{
		this.band = band;
		this.setting = settingsObj;
	}

	function getWiFiData(list, band)
	{
		for(obj in list)
		{
			if(band == list[obj].band)
			{
				return list[obj];
			}
		}
		return null;
	}

	function RadioIDToBand(radioid)
	{
		var band = null;
		switch(radioid)
		{
			case "RADIO_2.4GHz":
				band = "24";
				break;
			case "RADIO_5GHz":
				band = "5";
				break;
			case "RADIO_5GHz_2":
				band = "52";
				break;
			case "RADIO_2.4GHz_Guest":
				band = "24_Guest";
				break;
			case "RADIO_5GHz_Guest":
				band = "5_Guest";
				break;
			case "RADIO_5GHz_2_Guest":
				band = "52_Guest";
				break;
			case "2.4GHZ":
				band = "24";
				break;
			case "5GHZ":
				band = "5";
				break;
		}

		return band;
	}
	
	function Load_HTML()
	{ 
		$("#header").load("header.html");
	}
	
	function Initial()
	{
		initialMenu();
		initialDetectRouterConnection();
	}
	
	function GetXML()
	{
		InitInfo().done(function(){
			get_wireless("RADIO_2.4GHz");
			get_wireless("RADIO_5GHz");
			get_wireless("RADIO_2.4GHz_Guest");
			get_wireless("RADIO_5GHz_Guest");

			smartTrue = currentDevice.featureSmartConnect;
			covrTrue = currentDevice.featureCovrWIFI;



			if(smartTrue||covrTrue){
				switch(true){
					case smartTrue :
					getSmartConnectStatus();
					break;
					case covrTrue :
					getWiFiSONSettings();
					break;
				}
				if (currentDevice.feature2nd5GHz) {
					//get_wireless("RADIO_5GHz_2");
					//get_wireless("RADIO_5GHz_2_Guest");
				}
			} else {
				document.getElementById("RADIO_24").style.display = "inline";
				document.getElementById("RADIO_5").style.display = "inline";
				
				// ifdef featureFTPServer then show it
				if(currentDevice.featureFTPServer == false)
				{
					$("#div_WPS").hide();
				}else{
					$("#div_WPS").show();
				}
			}



			//#ifdef featureWPS
			if(currentDevice.featureWPS)
			{
				getWPS();
			}

		});
	}
	
	function getSmartConnectStatus()
	{
		var getSmartconnectSettingsResponse = new SOAPGetSmartconnectSettingsResponse();
		var soapAction = new SOAPAction();
		var result_smartconnect = soapAction.sendSOAPAction("GetSmartconnectSettings", null, getSmartconnectSettingsResponse);

		result_smartconnect.done(function(obj)
		{
			if(obj.Enabled.toLowerCase() == "true")
			{
				$("#status_smart").prop("checked", true);
			}
			else
			{
				$("#status_smart").prop("checked", false);
			}
			$("#RADIO_smart").show();
			GetRADIOStatus("smart");
		});
	}
	function getWiFiSONSettings() {
	    var getWiFiSONSettings = new SOAPGetWiFiSONSettings();
	    var soapAction = new SOAPAction();
	    var result_covrconnect = soapAction.sendSOAPAction("GetWiFiSONSettings", null, getWiFiSONSettings);

	    result_covrconnect.done(function(obj) {
	        if (obj.WiFiSONEnabled == "true") {
	            $("#status_covr").prop("checked", true);
	        } else {
	            $("#status_covr").prop("checked", false);
                $("#ap_roaming_wrap").hide();
            }

            if(obj.MUMIMOEnabled == "true") {
            	$('#mu_mimo').prop('checked', true);
            } else {
            	$('#mu_mimo').prop('checked', false);
            }

	        $("#RADIO_covr").show();
	        GetRADIOStatus("covr");
	    }).fail(function(){
	        //console.log("failed to get WiFiSON settings")
	    });

	}
	function InitInfo()
	{
		var dtd = $.Deferred();

		var soapAction = new SOAPAction();
		var getWLanRadiosResponse = new SOAPGetWLanRadiosResponse();
		var getScheduleSettingsResponse = new SOAPGetScheduleSettingsResponse();

		var resultRadio = soapAction.sendSOAPAction("GetWLanRadios", null, getWLanRadiosResponse);
		var resultSchedule = soapAction.sendSOAPAction("GetScheduleSettings", null, getScheduleSettingsResponse);

		$.when(resultRadio, resultSchedule).done(function(){
			// console.log(xml)

			for(var radioInfo in getWLanRadiosResponse.RadioInfos.RadioInfo)
			{
				var radioInfoObj = getWLanRadiosResponse.RadioInfos.RadioInfo[radioInfo];

				var band = RadioIDToBand(radioInfoObj.RadioID);

				var id = $("#channel_"+band);
				var scheduleid = $("#schedule_"+band);

				if(radioInfo == 0) {
					textautoEU = radioInfoObj.CountryCode;
				}
				
				for(var channel in radioInfoObj.Channels)
				{
					var num = radioInfoObj.Channels[channel];
					id.append('<option value="'+num+'">'+num+'</option>');
				}

				for(var row in getScheduleSettingsResponse.ScheduleInfoLists)
				{
					var name = getScheduleSettingsResponse.ScheduleInfoLists[row].ScheduleName;

					scheduleid.append('<option value="'+name+'">'+AllEncode(decode_char_text(name))+'</option>');
				}

				initWirelessMode(band);
				initChannelWidth(band);
			}
			dtd.resolve();
		});

		return dtd.promise();
	}

	
	function get_wireless(radioID)
	{
		var soapAction = new SOAPAction();
		var getWLanRadioSettings = new SOAPGetWLanRadioSettings();
		var getWLanRadioSecurity = new SOAPGetWLanRadioSecurity();
		var settingResponse = new SOAPGetWLanRadioSettingsResponse();
		var securityResponse = new SOAPGetWLanRadioSecurityResponse();
		var radioStr;

		var radioStr = RadioIDToBand(radioID);

		getWLanRadioSettings.RadioID = radioID;

		if(radioID.indexOf("Guest") > 0)
		{
			soapAction.sendSOAPAction("GetWLanRadioSettings", getWLanRadioSettings, settingResponse).done(function(obj){
				var guestSetting = new GuestSetting(radioStr, settingResponse);
				guest_datalist.push(guestSetting);
			});
			return;
		}
		
		var result = soapAction.sendSOAPAction("GetWLanRadioSettings", getWLanRadioSettings, settingResponse);

		getWLanRadioSecurity.RadioID = radioID;
		var result_security = soapAction.sendSOAPAction("GetWLanRadioSecurity", getWLanRadioSecurity, securityResponse);
		
		$.when(result, result_security)
		.done(function(obj){

			var wifiSetting = new WiFiSetting(radioStr, settingResponse, securityResponse);
			wifi_datalist.push(wifiSetting);
			
			show_wireless_info(radioStr, settingResponse, securityResponse);
		})
		.fail(function(obj){
			
		});
			
	}

	function show_wireless_info(band, settingObj, securityObj)
	{
		if(currentDevice.featureWEP==true){
			$('.security_24_WEP').show();
			$('.security_5_WEP').show();
			$('.security_52_WEP').show();
		}else{
			$('.security_24_WEP').hide();
			$('.security_5_WEP').hide();
			$('.security_52_WEP').hide();
		}

		var enabled = COMM_ToBOOL(settingObj.Enabled);
		$("#status_"+band).prop("checked", enabled);
		$("#wifiName_"+band).val(XMLDecode(settingObj.SSID));

		if (band == "5" || band == "52") {
			if (settingObj.Channel == "0") {
				$("#channel_"+band).val("0");
				$("#dfs_"+band).prop("checked", false);
			} else if (settingObj.Channel == "999") {
				$("#channel_"+band).val("0");
				$("#dfs_"+band).prop("checked", true);
			} else if (settingObj.Channel == "") {
				$("#channel_"+band).val("0");
				$("#dfs_"+band).prop("checked", false);
			} else
				$("#channel_"+band).val(settingObj.Channel);
		} else {
			$("#channel_"+band).val(settingObj.Channel);
		}

		$("#visibilityStatus_"+band).val(settingObj.SSIDBroadcast);	
		$("#transmissionPower_"+band).val(settingObj.TXPower);
		$("#schedule_"+band).val(settingObj.ScheduleName);
		//console.log(settingObj.ScheduleName)
		
		/* init wlan radio security */
		var enable = securityObj.Enabled;
		var type = securityObj.Type;
		//var encryption = securityObj.Encryption;
		var security = "";

		if(enable.toLowerCase() == "true")
		{
			var password = securityObj.Key;

			if(type == "WPA-PSK" || type == "WPA2-PSK" || type == "WPAORWPA2-PSK")
				security = "WPAORWPA2-PSK";
			else
				security = "WEP-SHARED";

			document.getElementById("password_"+band).value = password;
		}
		else
		{
			security = "None";
		}
		$("#security_"+band).val(security);

		/* Init 80211Mode and Channelwidth option list */
		var mode = settingObj.Mode.slice(6);	//802.11
		$("#80211Mode_"+band).val(mode);
		$("#channelWidth_"+band).val(settingObj.ChannelWidth);
		
		OnChangeSecurityType(security, band);

		$("#security_"+band).selectbox();
		$("#transmissionPower_"+band).selectbox();
		$("#visibilityStatus_"+band).selectbox();
		$("#channel_"+band).selectbox();
		$("#schedule_"+band).selectbox();
		
		if(band==24){
			var coeEnable = COMM_ToBOOL(settingObj.Coexistence);
			$("#coexistence_"+band).prop("checked", coeEnable);
		}

		DisableSettings(band, !enabled);
	
		//checkwps
		checkwps();
	}
	
	function getWPS()
	{
		var soapAction = new SOAPAction();
		var getWPSSettingsResponse = new SOAPGetWPSSettingsResponse();

		soapAction.sendSOAPAction("GetWPSSettings", null, getWPSSettingsResponse).done(function(obj){
			$("#wps_pbc").prop("checked", COMM_ToBOOL(obj.WPSPBC));
			$("#wps_pin").prop("checked", COMM_ToBOOL(obj.WPSPIN));

			$("#WPS").show();
			$("#24_adv_line").removeClass("2GSmartHide");
		});
	}

	//check wps disabled or not
	function checkwps(){
		var element;
		switch(true){
			case smartTrue:
				element = "smart";
				break;
			case covrTrue:
				element = "covr";
		}
		if($('#status_'+element).prop('checked')==true){
			//console.log("true1")
			$("#wps_pbc").attr("disabled", false);
			$("#wps_pin").attr("disabled", false);
		}else{
			if (currentDevice.feature2nd5GHz) {
				if($('#status_24').prop('checked')==false && $('#status_5').prop('checked')==false && $('#status_52').prop('checked')==false){
					//console.log("false2")
					$("#wps_pbc").attr("disabled", true);
					$("#wps_pin").attr("disabled", true);					
				}else{
					//console.log("true3")
					$("#wps_pbc").attr("disabled", false);
					$("#wps_pin").attr("disabled", false);
				}
			}else{
				if($('#status_24').prop('checked')==false && $('#status_5').prop('checked')==false){
					//console.log("false4")
					$("#wps_pbc").attr("disabled", true);
					$("#wps_pin").attr("disabled", true);					
				}else{
					//console.log("true5")
					$("#wps_pbc").attr("disabled", false);
					$("#wps_pin").attr("disabled", false);
				}
			}	
		}
	}
	
	function CheckConnectionStatus()
	{
		$.ajax({
			cache : false,
			url : "./js/CheckConnection",
			timeout : 2000,
			type : "GET",
			success : function(data) { SetXML(); },
			error : function() { document.getElementById("DetectRouterConnection").style.display = "inline"; }
		});
	}

	function createWlanSettings(band)
	{
		var setting = new SOAPSetWLanRadioSettings();
		var radioData = getWiFiData(wifi_datalist, band);

		switch(band)
		{
			case "24":
				setting.RadioID = "RADIO_2.4GHz";
				setting.Coexistence = $("#coexistence_"+band).prop("checked");
				setting.Channel = $("#channel_"+band).val();
				break;
			case "5":
				setting.RadioID = "RADIO_5GHz";
				if ($("#channel_"+band).val() == "0") {
					if ($("#dfs_"+band).prop("checked"))
						setting.Channel = "999";
					else
						setting.Channel = "0";
				} else 
						setting.Channel = $("#channel_"+band).val();
				break;
			case "52":
				setting.RadioID = "RADIO_5GHz_2";
				if ($("#channel_"+band).val() == "0") {
					if($("#dfs_"+band).prop("checked"))
						setting.Channel = "999";
					else
						setting.Channel = "0";
				} else 
					setting.Channel = $("#channel_"+band).val();
				break;
		}

		setting.Enabled = $("#status_"+band).prop("checked");
		setting.Mode = "802.11" + $("#80211Mode_"+band).val();
		setting.SSID = XMLEncode($("#wifiName_"+band).val());
		setting.SSIDBroadcast = $("#visibilityStatus_"+band).val();
		setting.ChannelWidth = $("#channelWidth_"+band).val();
		//setting.Channel = $("#channel_"+band).val();
		setting.SecondaryChannel = $("#channel_"+band).val();//radioData.setting.SecondaryChannel;
		//setting.QoS = radioData.setting.QoS;
		setting.ScheduleName = $("#schedule_"+band).val();
		//console.log(setting.ScheduleName)
		setting.TXPower = $("#transmissionPower_"+band).val();

		return setting;
	}

	function createWlanSecurity(band)
	{
		var security = new SOAPSetWLanRadioSecurity();
		var radioData = getWiFiData(wifi_datalist, band);
		var key = $("#password_"+band).val();
		var security_type = $("#security_"+band).val();
		var encryption = "";

		switch(band)
		{
			case "24":
				security.RadioID = "RADIO_2.4GHz";
				break;
			case "5":
				security.RadioID = "RADIO_5GHz";
				break;
			case "52":
				security.RadioID = "RADIO_5GHz_2";
				break;
		}
		
		if(security_type == "None")
		{
			security.Enabled = false;
		}
		else
		{		
			security.Enabled = true;

			if(security_type == "WEP-SHARED")
			{
				if(key.length == 5 || key.length==10)
				{
					encryption="WEP-64";
				}
				else if(key.length == 13 || key.length==26)
				{
					encryption="WEP-128";
				}

			}
			else	//WPA
			{
				encryption="TKIPORAES";
			}
			
			security.Type = security_type;
			security.Encryption = encryption;
			security.Key = key;
			security.KeyRenewal = 3600;
		}

		return security;
	}
	
	function SetXML()
	{
		var soapAction = new SOAPAction();
		// document.getElementById("CreatePopAlertMessage").style.display = "inline";
		// document.getElementById("waitSettingFinish").style.display = "inline";

		var msg = I18N("j", "Please wait") + " ...";
		PopView.show(msg);

		//smart connect
		var smart = false;
		var mu_mimo = false;
		//#ifdef featureSmartConnect

		//covr WiFi
		var covr = false;

		switch(true){
			case smartTrue:
			if($("#status_smart").prop('checked'))
			{
				smart = true;
			}
			
			var setSmartconnectSettings = new SOAPSetSmartconnectSettings();
			setSmartconnectSettings.Enabled = smart;
			soapAction.SetMultipleSOAP("SetSmartconnectSettings", setSmartconnectSettings, null);
			break;
			case covrTrue:
			//console.log("asd")
			if ($("#status_covr").prop('checked')) {
                covr = true;
            }
            var setCovrconnectSettings = new SOAPSetWiFiSONSettings();
            setCovrconnectSettings.WiFiSONEnabled = covr;
            setCovrconnectSettings.MUMIMOEnabled = $('#mu_mimo').prop('checked');
            //console.log(covr)
            soapAction.SetMultipleSOAP("SetWiFiSONSettings", setCovrconnectSettings, null);

		}


		//2.4 G
		setting = createWlanSettings("24");
		soapAction.SetMultipleSOAP("SetWLanRadioSettings", setting, null);

		security = createWlanSecurity("24");
		soapAction.SetMultipleSOAP("SetWLanRadioSecurity", security, null);

		// 5G
		if(smart == false && covr == false)
		{
			setting = createWlanSettings("5");
			soapAction.SetMultipleSOAP("SetWLanRadioSettings", setting, null);

			security = createWlanSecurity("5");
			soapAction.SetMultipleSOAP("SetWLanRadioSecurity", security, null);
		}

		//Guest Zone
		if($("#status_24").prop("checked") == false)
		{
			setting = createGuestSettings("24_Guest");
			soapAction.SetMultipleSOAP("SetWLanRadioSettings", setting, null);
		}
		if($("#status_5").prop("checked") == false)
		{
			setting = createGuestSettings("5_Guest");
			soapAction.SetMultipleSOAP("SetWLanRadioSettings", setting, null);
		}

		// 5G 2
		//#ifdef featureSmartConnect
		switch(true){
			case smartTrue:
				if(smart == false){
					if (currentDevice.feature2nd5GHz) {
						setting = createWlanSettings("52");
						soapAction.SetMultipleSOAP("SetWLanRadioSettings", setting, null);

						security = createWlanSecurity("52");
						soapAction.SetMultipleSOAP("SetWLanRadioSecurity", security, null);

						//Guest zone
						if ($("#status_52").prop("checked") == false) {
							setting = createGuestSettings("52_Guest");
							soapAction.SetMultipleSOAP("SetWLanRadioSettings", setting, null);
						}
					}
					}
				break;
			case covrTrue:
				if (covr == false) {
				    if (currentDevice.feature2nd5GHz) {
				        setting = createWlanSettings("52");
				        soapAction.SetMultipleSOAP("SetWLanRadioSettings", setting, null);

				        security = createWlanSecurity("52");
				        soapAction.SetMultipleSOAP("SetWLanRadioSecurity", security, null);

				        //Guest zone
				        if ($("#status_52").prop("checked") == false) {
				            setting = createGuestSettings("52_Guest");
				            soapAction.SetMultipleSOAP("SetWLanRadioSettings", setting, null);
				        }
				    }
				}
		}
		
		//WPS
		//#ifdef featureWPS
		if(currentDevice.featureWPS)
		{	
			var setWPSSettings = new SOAPSetWPSSettings();
			setWPSSettings.WPSPBC = $("#wps_pbc").prop("checked");
			setWPSSettings.WPSPIN = $("#wps_pin").prop("checked");
			soapAction.SetMultipleSOAP("SetWPSSettings", setWPSSettings, null);
		}

		soapAction.SendMultipleSOAPAction("SetMultipleActions").done(function(){
			Start_reciprocal_Number_RestoreConfiguration();
		});
		
	}

	function createGuestSettings(band)
	{
		var guestData = getWiFiData(guest_datalist, band);
		var settingResponse = guestData.setting;
		var setting = new SOAPSetWLanRadioSettings();

		switch(band)
		{
			case "24_Guest":
				setting.RadioID = "RADIO_2.4GHz_Guest";
				break;
			case "5_Guest":
				setting.RadioID = "RADIO_5GHz_Guest";
				break;
			case "52_Guest":
				setting.RadioID = "RADIO_5GHz_2_Guest";
				break;
		}

		setting.Enabled = false;
		setting.Mode = settingResponse.Mode;
		setting.SSID = settingResponse.SSID;
		setting.SSIDBroadcast = settingResponse.SSIDBroadcast;
		setting.ChannelWidth = settingResponse.ChannelWidth;
		setting.Channel = settingResponse.Channel;
		setting.SecondaryChannel = settingResponse.SecondaryChannel;
		setting.QoS = settingResponse.QoS;
		setting.ScheduleName = settingResponse.ScheduleName;
		setting.TXPower = settingResponse.TXPower;
		setting.Coexistence = settingResponse.Coexistence;

		return setting;
	}

	function initWirelessMode(band)
	{
		var id = $("#80211Mode_"+band);
		var value = id.val();
		id.empty();

		switch(band)
		{
			case "24":
				id.append('<option id="'+ band +'_bgn" value="bgn">Mixed 802.11b/g/n</option>');
				id.append('<option id="'+ band +'_gn" value="gn">Mixed 802.11g/n</option>');
				break;
			case "5":
			case "52":
				id.append('<option id="'+ band +'_anac" value="anac">Mixed 802.11a/n/ac</option>');
				id.append('<option id="'+ band +'_nac" value="nac">Mixed 802.11n/ac</option>');
				id.append('<option id="'+ band +'_an" value="an">Mixed 802.11a/n</option>');
				id.append('<option id="'+ band +'_ac" value="ac">802.11ac only</option>');
				id.append('<option id="'+ band +'_a" value="a">802.11a only</option>');
				break;
		}
		id.append('<option id="'+ band +'_n" value="n">802.11n only</option>');

		id.val(value);
	}

	function initChannelWidth(band)
	{
		var id = $("#channelWidth_"+band);
		var value = id.val();

		id.empty();
		if((band == "5")||(band == "52"))
		{
			id.append('<option id="'+ band +'_204080" value="1">Auto 20/40/80 MHz</option>');
		}
		id.append('<option id="'+ band +'_2040" value="0">Auto 20/40 MHz</option>');
		id.append('<option id="'+ band +'_20" value="20">20 MHz</option>');

		id.val(value);
	}

	function checkOptionNotSupported(id)
	{
		if($(id+" option:selected").css("display") == "none")
		{
			return true;
		}
		return false;
	}

	function OnChangeSecurityType(value, band)
	{
		//#ifdef featureSmartConnect
		if(currentDevice.featureSmartConnect)
		{
			if($("#status_smart").prop("checked"))
			{
				return;
			}
		}
	
		var security_advstatus = $("#RADIO_"+band+"_adv").css("display");
		var id = $("#80211Mode_"+band);	//Wireless Mode
		
		id.selectbox('detach');
		$("#80211Mode_"+band+" option").show();

		if((value == "None")&&(security_advstatus != "none"))
		{
			$("#password_"+band).attr("disabled", true);
		}
		else
		{
			$("#password_"+band).attr("disabled", !$("#status_"+band).prop("checked"));

			//remove item which is not supported
			if(value == "WEP-SHARED")
			{
				switch(band)
				{
					case "24":
						$("#"+band+"_n").hide();

						//set to default
						if(checkOptionNotSupported("#80211Mode_"+band))
						{
							id.val("bgn");
						}
						break;
					case "5":
					case "52":
						$("#"+band+"_ac").hide();
						$("#"+band+"_nac").hide();
						$("#"+band+"_n").hide();

						//set to default
						if(checkOptionNotSupported("#80211Mode_"+band))
						{
							id.val("anac");
						}
						break;
				}
			}
		}
		id.selectbox('attach');
		//Channel Width
		setChannelWidth(band);
	}

	function setChannelWidth(band)
	{
		var id = $("#channelWidth_"+band);
		var mode = $("#80211Mode_"+band).val();
		var security = $("#security_"+band).val();
		var channel = parseInt($("#channel_"+band).val());
		var channelWidthCount = 0;

		//check if only one channel width (then set to auto if has better)
		$("#channelWidth_"+band).children().each(function(index){
			if($(this).css("display") != "none")
			{
				channelWidthCount++;
			}
		});

		id.selectbox('detach');	
		$("#channelWidth_"+band+" option").show();
		
		//remove item which is not supported
		if(security == "WEP-SHARED")
		{
			$("#"+band+"_2040").hide();
			$("#"+band+"_204080").hide();
		}
		else	//WPA, none
		{
			switch(band)
			{
				case "24":
					//channel
					if((channel == 12)||(channel == 13))	//20
					{
						$("#"+band+"_2040").hide();
					}
					break;
				case "5":
				case "52":
					//channel, 20 only
					if(((channel >= 52)&&(channel <= 142))||	//DFS channel
						(channel == 165) )						//Law
					{
						$("#"+band+"_2040").hide();
						$("#"+band+"_204080").hide();
					}
					else
					{
						//mode
						switch(mode)
						{
							case "a": 	//20
								$("#"+band+"_2040").hide();
								$("#"+band+"_204080").hide();
								break;
							case "n": 	//20/40
							case "an":
								$("#"+band+"_20").hide();
								$("#"+band+"_204080").hide();
								break;
							default: 	//20/40, 20/40/80
								$("#"+band+"_20").hide();
								break;
						}
					}
					break;
			}			
		}
		//set to default
		if(checkOptionNotSupported("#channelWidth_"+band)||(channelWidthCount < 2))
		{
			//set to best (first)
			$("#channelWidth_"+band).children().each(function(index){
				if($(this).css("display") != "none")
				{
					$("#channelWidth_"+band).val($(this).val());
					return false;
				}
			});
		}
		//coexistance
		if(band == "24")
		{
			showCoexistance($("#channelWidth_"+band).val());
		}

		if (band == "5" || band == "52") {
			showdfs(band, channel);
		}
		
		id.selectbox('attach');
	}

	// function getCountryCodeEU () {
	// 	var returnValue = false;
	// 	var dtd = $.Deferred();
	// 	$.ajax({
	//     	url : "version.txt",
	//     	type : "post",
	// 		async: false,
	//     	success : function(data) {
	// 			var CountryCode_5G = data.indexOf("5GHz country code");
	// 			//var DFS_5G = data.indexOf("5GHz DFS Channel");
	// 			//if (data.indexOf("EU") > CountryCode_5G && data.indexOf("EU") < DFS_5G) {
	// 			if (data.indexOf("EU") > CountryCode_5G) {
					
	// 				returnValue = true;
	// 			}

	// 			dtd.resolve(returnValue);
	//     	}
	//     });
		
	// 	// return returnValue;
	// 	return dtd.promise();
	// }

	function showCoexistance(channelWidth)
	{
		if(channelWidth == "20")
		{
			$("#coexistence_24_tr").hide();
		}
		else
		{
			$("#coexistence_24_tr").show();
		}
	}

	function showdfs(band, channel) {
		if(channel == "0") {
			var isEU;
			isEU = textautoEU;
			if(isEU.indexOf("EU") >= 0) {
				if (band == "5") {
					$("#show_dfs_5G").show();
				} else if(band == "52") {
					$("#show_dfs_5G2").show();
				}
			} else {
				if (band == "5") {
					$("#show_dfs_5G").hide();
				} else if(band == "52") {
					$("#show_dfs_5G2").hide();
				}
			}
		} else {
			if(band == "5") {
				$("#show_dfs_5G").hide();
			} else if(band == "52") {
				$("#show_dfs_5G2").hide();
			}
		}
	}
	
	function DisableSettings(band, disable)
	{
		var security_advstatus = $("#RADIO_"+band+"_adv").css("display");

		$("#wifiName_"+band).attr("disabled", disable);
	
		var security = $("#security_"+band).val();
		if((security=="None")&&(security_advstatus != "none"))
		{
			$("#password_"+band).attr("disabled", true);
		}
		else
		{
			$("#password_"+band).attr("disabled", disable);
		}
		
		var boxstatus;
		if(disable)
		{
			boxstatus = "disable";
		}
		else 
		{
			boxstatus = "enable";
		}

		//HT20/40 Coexistence or DFS button
		if(band==24){
			$("#coexistence_24").attr("disabled", disable);
		}else{
			$("#dfs_"+band).attr("disabled", disable);
		}
		
		$("#security_"+band).selectbox(boxstatus);
		$("#80211Mode_"+band).selectbox(boxstatus);
		$("#channel_"+band).selectbox(boxstatus);
		$("#transmissionPower_"+band).selectbox(boxstatus);
		$("#channelWidth_"+band).selectbox(boxstatus);
		$("#visibilityStatus_"+band).selectbox(boxstatus);
		$("#schedule_"+band).selectbox(boxstatus);
	}


	function GetRADIOStatus(type)
	{	
		var element = $("#status_"+ type ).prop("checked");

		if(element == true)	{
            if(type == "covr"){
				$("#ap_roaming_wrap").show();
            }
			$("#wifi_24G_title").html(I18N("j", "Wireless(Wi-Fi)"));
			document.getElementById("RADIO_24").style.display = "inline";
			document.getElementById("status_24_tr").style.display = "none";
			//$("#status_24").prop("checked", true);
			//DisableSettings("24", false);

			$(".2GSmartHide").hide();
			document.getElementById("RADIO_5").style.display = "none";
			document.getElementById("RADIO_52").style.display = "none";
		}
		else if(element == false)
		{
            $("#ap_roaming_wrap").hide();
			$("#wifi_24G_title").html(I18N("j", "2.4GHz"));
			document.getElementById("RADIO_24").style.display = "inline";
			$(".2GSmartHide").show();
			document.getElementById("status_24_tr").style.display = "";
			//$("#status_24").prop("checked", true);
			//DisableSettings("24", false);

			document.getElementById("RADIO_5").style.display = "inline";

			if (currentDevice.feature2nd5GHz)
				document.getElementById("RADIO_52").style.display = "inline";
			
			OnChangeSecurityType($("#security_24").val(), "24")
			
			if (!currentDevice.feature2nd5GHz) { // only one 5GHz
				$("#5GHzTitle").html(I18N("j", "5GHz"));
			}
		}

		// ifdef featureFTPServer then show it
		if(currentDevice.featureFTPServer == false)
		{
			$("#div_WPS").hide();
		}else{
			$("#div_WPS").show();
		}
	
		//checkwps
		checkwps();
	}

	
	function ChangeRADIOStatus(type)
	{	
		var element = $("#status_"+ type ).prop("checked");

		if(element == true)	{
            if(type == "covr"){
				$("#ap_roaming_wrap").show();
            }
			$("#wifi_24G_title").html(I18N("j", "Wireless(Wi-Fi)"));
			document.getElementById("RADIO_24").style.display = "inline";
			document.getElementById("status_24_tr").style.display = "none";
			$("#status_24").prop("checked", true);
			DisableSettings("24", false);

			$(".2GSmartHide").hide();
			document.getElementById("RADIO_5").style.display = "none";
			document.getElementById("RADIO_52").style.display = "none";
		}
		else if(element == false)
		{
            $("#ap_roaming_wrap").hide();
			$("#wifi_24G_title").html(I18N("j", "2.4GHz"));
			document.getElementById("RADIO_24").style.display = "inline";
			$(".2GSmartHide").show();
			document.getElementById("status_24_tr").style.display = "";
			$("#status_24").prop("checked", true);
			DisableSettings("24", false);

			document.getElementById("RADIO_5").style.display = "inline";

			if (currentDevice.feature2nd5GHz)
				document.getElementById("RADIO_52").style.display = "inline";
			
			OnChangeSecurityType($("#security_24").val(), "24")
			
			if (!currentDevice.feature2nd5GHz) { // only one 5GHz
				$("#5GHzTitle").html(I18N("j", "5GHz"));
			}
		}

		// ifdef featureFTPServer then show it
		if(currentDevice.featureFTPServer == false)
		{
			$("#div_WPS").hide();
		}else{
			$("#div_WPS").show();
		}
	
		//checkwps
		checkwps();
	}
	
	function ChangeBandStatus(band)
	{
		var status = $("#status_"+band).prop("checked");

		if(status){
			DisableSettings(band, false);
		}else{
			DisableSettings(band, true);
		}

		//checkwps
		checkwps();
	}

	function OnPressPassword(element, band)
	{
		var security_advstatus = $("#RADIO_"+band+"_adv").css("display");
		if(security_advstatus != "none")
			return;

		var security_select = $("#security_"+band);

		if(element.value == "")
		{
			security_select.val("None");
		}
		else
		{
			if(security_select.val() == "None")
				$("#security_"+band).val("WPAORWPA2-PSK");
		}
	}

	//override from pagetool.js
	function showAdv(band) 
	{
		var block = $("#RADIO_"+band+"_adv");
		var security_type = $("#security_"+band).val();

		if(block.css("display") == "none")
		{
			block.show();
		}
		else 
		{
			block.hide();
		}
		//reset security selection
		
		$("#security_"+band).selectbox('detach').selectbox('attach');

		OnChangeSecurityType(security_type, band);

		// set enable/disable for the detach selectbox
		var status = $("#status_"+band).prop("checked");
		var selectedSecurity = "";
		if (status)
			selectedSecurity = "enable";
		else 
			selectedSecurity = "disable";
		$("#security_"+band).selectbox(selectedSecurity);
		$("#80211Mode_"+band).selectbox(selectedSecurity);
		$("#channelWidth_"+band).selectbox(selectedSecurity);
		$("#channel_"+band).selectbox('detach').selectbox('attach');
		$("#transmissionPower_"+band).selectbox('detach').selectbox('attach');
		$("#visibilityStatus_"+band).selectbox('detach').selectbox('attach');
		$("#schedule_"+band).selectbox('detach').selectbox('attach');
		$("#channel_"+band).selectbox(selectedSecurity);
		$("#transmissionPower_"+band).selectbox(selectedSecurity);
		$("#visibilityStatus_"+band).selectbox(selectedSecurity);
		$("#schedule_"+band).selectbox(selectedSecurity);

		changeTimeoutAction();
	}
	
	function Start_reciprocal_Number_RestoreConfiguration() {
		var msg = I18N("j", "Please wait") + " ...";
		var msg2 = I18N("j", "The new settings have been saved.");
		PopView.showWithCountdown(msg, currentDevice.okcount).always(function(){
			PopView.showConfirm(msg2).done(function(){
				window.location.reload();
			});
		});
		// if (_ReciprocalNumber >= 0) {
		// 	// document.getElementById("reciprocal_Number").innerHTML = _ReciprocalNumber + " " + I18N("j", "Sec");
		// 	// _ReciprocalNumber --;
		// 	// setTimeout("Start_reciprocal_Number_RestoreConfiguration()", 1000);
		// } else {
		// 	document.getElementById("waitSettingFinish").style.display = "none";
		// 	document.getElementById("SuccessSettings").style.display = "inline";
		// }
	}
	
	function returnToHome()
	{
		window.location.reload();
	}
	function save_button_changed()
	{
		// $(".save_btn").attr("disabled", false);
		document.getElementById("Save_Disable_btn").style.display = "none";
		document.getElementById("Save_btn").style.display = "block";
		changeTimeoutAction();
		changeFlag = true;
	}

//	DFS Popup Warning Message
	function popupIDialog(element)	{
		if(element == true) {
			document.getElementById("createPop").style.display = "inline";
		}
	}

	function closeIDialog()	{
		document.getElementById("createPop").style.display = "none";
	}
// -------------------------------

	$(document).ready(function(){
		//event
		$("input, select").change(function () { 
			save_button_changed();
		});
		$("input").keypress(function () { 
			save_button_changed();
		});
		setValidate();

		Load_HTML();
		Initial();
		setMenu("menu_Settings");
		GetXML();
		startTimeout();
		

	});

</script>
</head>
<body>
	<form role="form" name="wifi_form" id="wifi_form" method="POST" action="">
		<div id="wrapper">
			<!-- ------------------ Logo ------------------------ -->
			<div id="header"></div>
			<!-- ------------------ Menu ------------------------ -->
			<div id="menu"></div>
			<div id="menu_edge"></div>
			<!-- ------------------ Content -------------------- -->
			<div id="content">
				<!-- ------------------ info ------------------------ -->	
				<div id="info">
					<div id="FunctionName"><script>I18N("h", "Wireless(Wi-Fi)");</script></div>
					<div id="wallimage"><img src="image/wifi_24.png" alt="" width="195" height="119"/></div>
					<div id="directions">
						<script>I18N("h", "Use this section to configure the wireless settings for your D-Link Router. Please note that changes made on this section may also need to be duplicated on your Wireless Client.");</script>
					</div>
				</div>
				<!-- ------------------ funcBar -------------------- -->
				<div id="funcBar">
					<div id="pagePath">&nbsp;<script>I18N("h", "Settings");</script> >> <script>I18N("h", "Wireless(Wi-Fi)");</script></div>
					<ul id="rightFunc">
						<!-- <li><button type="submit" class="save_btn" onclick="changeTimeoutAction();" style="cursor:pointer;" disabled><script>I18N("h", "Save");</script></button></li> -->
						<li style="display:block"><div id="Save_btn" onclick="document.getElementById('sumbit_CheckData').click();changeTimeoutAction();" style="cursor:pointer; display:none"><script>I18N("h", "Save");</script></div></li>
						<li style="display:block"><div id="Save_Disable_btn"><script>I18N("h", "Save");</script></div></li>
						<input type="submit" id="sumbit_CheckData" class="submit" value="submit" style="display:none" />
						<li><a href="javascript:CheckHTMLStatus('GuestZone');" style="text-decoration:none;" onclick="return confirmExit()"><div id="page_btn" class="linkstyle_1"><script>I18N("h", "Guest Zone");</script></div></a></li> 
					</ul>
				</div>
	     	<!-- ------------------ main -------------------- -->
	     	<div id="main">
			<!-- ------------------ Wi-Fi Smart Connection || Wi-Fi Covr-------------------- -->
			<div id="RADIO_smart" style="display:none">
				<table class="block" border="0" cellspacing="0" style="margin: 10px 0 0 0;">
					<tbody>
					<tr>
						<td><div class ="title"><script>I18N("h", "Smart Connect");</script></div></td>
					</tr>
					<tr>
						<th><script>I18N("h", "Status");</script>:</th>
						<td>
							<input type="checkbox" class="chkbox" id="status_smart" onclick="ChangeRADIOStatus('smart')"/><label for="status_smart"><span class="chkbox_disabled"><script>I18N("h","Disabled");</script></span><span class="chkbox_enabled"><script>I18N("h","Enabled");</script></span></label>
						</td>
					</tr>
					</tbody>
				</table>
				<hr  />
			</div>
			<div id="RADIO_covr" style="display:none">
			    <table class="block" border="0" cellspacing="0" style="margin: 10px 0 0 0;">
			        <tbody>
			            <tr>
			                <td>
			                    <div class="title">
			                        <script>
			                        I18N("h", "Covr Wi-Fi System");
			                        </script>
			                    </div>
			                </td>
			            </tr>
			            <tr>
			                <th>
			                    <script>
			                    I18N("h", "Status");
			                    </script>:</th>
			                <td>
			                    <input type="checkbox" class="chkbox" id="status_covr" onclick="ChangeRADIOStatus('covr')" />
			                    <label for="status_covr"><span class="chkbox_disabled"><script>I18N("h","Disabled");</script></span><span class="chkbox_enabled"><script>I18N("h","Enabled");</script></span></label>
			                </td>
			            </tr>
			            <tr>
			                <th>
			                    <script>
			                    I18N("h", "MU-MIMO");
			                    </script>:</th>
			                <td>
			                    <input type="checkbox" class="chkbox" id="mu_mimo" onclick="" />
			                    <label for="mu_mimo"><span class="chkbox_disabled"><script>I18N("h","Disabled");</script></span><span class="chkbox_enabled"><script>I18N("h","Enabled");</script></span></label>
			                </td>
			            </tr>
			            <tr id="ap_roaming_wrap">
			                <th>
			                    <script>
			                    I18N("h", "AP Roaming");
			                    </script>:</th>
			                <td>
			                    <input type="checkbox" class="chkbox" id="ap_roaming" onclick="ChangeRADIOStatus()" />
			                    <label for="ap_roaming"><span class="chkbox_disabled"><script>I18N("h","Disabled");</script></span><span class="chkbox_enabled"><script>I18N("h","Enabled");</script></span></label>
			                    <script>
			                    	$("#ap_roaming").click().attr("disabled","disabled");
			                    </script>
			                </td>
			            </tr>
			        </tbody>
			    </table>
			    <hr />
			</div>
			<!-- ------------------ Wi-Fi RADIO_2.4GHz -------------------- -->
			<div id="RADIO_24" style="display:none;">
				<table class="block" border="0" cellspacing="0" style="margin: 10px 0 0 0;">
					<tbody>
						<tr>
							<td colspan="2"><div id="wifi_24G_title" class ="title"><script>I18N("h", "2.4GHz");</script></div></td>
						</tr>
						<tr id="status_24_tr">
							<th><script>I18N("h", "Status");</script>:</th>
							<td>
								<input type="checkbox" class="chkbox" id="status_24" onchange="ChangeBandStatus('24')"/><label for="status_24"><span class="chkbox_disabled"><script>I18N("h","Disabled");</script></span><span class="chkbox_enabled"><script>I18N("h","Enabled");</script></span></label>
							</td>
						</tr>
						<tr>
							<th><script>I18N("h", "Wi-Fi Name (SSID)");</script>:</th>
							<td><input class="styled-text" type="text" name="wifiName_24" maxlength="32" size="30" id="wifiName_24"></td>
						</tr>
						<tr>
							<th><script>I18N("h", "Password");</script>:</th>
							<td><input class="styled-text" type="text" name="password_24" size="30" id="password_24" maxlength="63" onKeyUp="OnPressPassword(this, '24')"></td>
						</tr>
						
					</tbody>
				</table>
				<div class="advButton">
					<span onclick="showAdv('24');">
						<script>I18N("h", "Advanced Settings");</script>...
					</span>
				</div>
				<hr  />
				<!-- ------------------ Wi-Fi RADIO_2.4GHz  Adv---------------------->
				<div id="RADIO_24_adv" style="display:none">
					<table class="block">
						<tbody>
							<tr>
								<th><script>I18N("h", "Security Mode");</script>:</th>
								<td>
									<div class="styled-select">
										<select name="security_24" id="security_24" onChange="OnChangeSecurityType(this.value, '24')">
										<option value="None">None</option>
										<option class="security_24_WEP" value="WEP-SHARED">WEP</option>
										<option value="WPAORWPA2-PSK">WPA/WPA2-Personal</option>
										</select>
									</div>
								</td>
							</tr>
							<tr id="show_80211Mode_24G" class = "2GSmartHide">
								<th><script>I18N("h", "802.11 Mode");</script>:</th>
								<td>
									<div class="styled-select">
										<select name="80211Mode_24" id="80211Mode_24" onChange="setChannelWidth('24')">
										</select>
									</div>
								</td>
							</tr>
							<tr class = "2GSmartHide">
								<th><script>I18N("h", "Wi-Fi Channel");</script>:</th>
								<td>
									<div class="styled-select">
										<select name="channel_24" id="channel_24" onChange="setChannelWidth('24')">
											<option value="0">Auto</option>
										</select>
									</div>
								</td>
							</tr>
							<tr>
								<th><script>I18N("h", "Transmission Power");</script>:</th>
								<td>
									<div class="styled-select">
										<select name="transmissionPower_24" id="transmissionPower_24">
											<option value="100" selected>High</option>
											<option value="75">Medium</option>
											<option value="50">Low</option>
										</select>
									</div>
								</td>
							</tr>  
							<tr class = "2GSmartHide">
								<th><script>I18N("h", "Channel Width");</script>:</th>
								<td>
									<div class="styled-select">
										<select name="channelWidth_24" id="channelWidth_24" onChange="showCoexistance(this.value)">
										</select>
									</div>
								</td>
							</tr>
							<tr id="coexistence_24_tr" class = "2GSmartHide">
								<th><script>I18N("h", "coexistence");</script>:</th>
								<td>
									<input type="checkbox" class="chkbox" id="coexistence_24"/><label for="coexistence_24"><span class="chkbox_disabled"><script>I18N("h","Disabled");</script></span><span class="chkbox_enabled"><script>I18N("h","Enabled");</script></span></label>
								</td>
							</tr>
							<tr class = "2GSmartHide">
								<th><script>I18N("h", "Visibility Status");</script>:</th>
								<td>
									<div class="styled-select">
										<select name="visibilityStatus_24" id="visibilityStatus_24">
											<option value="true">Visible</option>
											<option value="false">Invisible</option>
										</select>
									</div>
								</td>
							</tr> 
							<tr>
								<th class="linkstyle_1"><a href="Schedule.html"><script>I18N("h", "Schedule");</script></a>:</th>
								<td>
									<div class="styled-select">
										<select name="schedule_24" id="schedule_24">
											<option value="Always" selected>Always</option>
										</select>
									</div>
								</td>
							</tr>
						</tbody>
					</table> 
					<!--<hr id="24_adv_line" class="2GSmartHide"/>-->
					<hr/>
				</div>
			</div>
			<!-- ------------------ Wi-Fi RADIO_5GHz  -------------------- -->
			<div id="RADIO_5" style="display:none;">
				<table class="block" cellspacing="0" style="margin: 10px 0 0 0;">
					<tbody>
						<tr>
							<td><div id="5GHzTitle" class ="title"><script>I18N("h", "Primary 5GHz");</script></div></td>
							<td></td>
						</tr>
						<tr>
							<th><script>I18N("h", "Status");</script>:</th>
							<td>
								<input type="checkbox" class="chkbox" id="status_5" onchange="ChangeBandStatus('5')"/><label for="status_5"><span class="chkbox_disabled"><script>I18N("h","Disabled");</script></span><span class="chkbox_enabled"><script>I18N("h","Enabled");</script></span></label>
							</td>
						</tr>
						<tr>
							<th><script>I18N("h", "Wi-Fi Name (SSID)");</script>:</th>
							<td><input class="styled-text" type="text" name="wifiName_5" size="30" maxlength="32" id="wifiName_5"></td>
						</tr>
						<tr>
							<th><script>I18N("h", "Password");</script>:</th>
							<td><input class="styled-text" type="text" name="password_5" size="30" id="password_5" maxlength="63" onKeyUp="OnPressPassword(this, '5')"></td>
						</tr>
					</tbody>
				</table>
				<div class="advButton">
					<span onclick="showAdv('5');">
						<script>I18N("h", "Advanced Settings");</script>...
					</span>
				</div>
				<hr />
				<!-- ------------------ Wi-Fi RADIO_5GHz  adv---------------------->
				<div id="RADIO_5_adv" style="display:none">
					<table  class="block" border="0">
						<tbody>
							<tr>
								<th><script>I18N("h", "Security Mode");</script>:</th>
								<td>
									<div class="styled-select">
										<select name="security_5" id="security_5" onChange="OnChangeSecurityType(this.value, '5')">
											<option value="None">None</option>
											<option class="security_5_WEP" value="WEP-SHARED">WEP</option>
											<option value="WPAORWPA2-PSK">WPA/WPA2-Personal</option>
										</select>
									</div>  
								</td>
							</tr>
							<tr id="show_80211Mode_5G">
								<th><script>I18N("h", "802.11 Mode");</script>:</th>
								<td>
									<div class="styled-select">
										<select name="80211Mode_5" id="80211Mode_5" onChange="setChannelWidth('5')">
										</select>
									</div>  
								</td>
							</tr>
							<tr>
								<th><script>I18N("h", "Wi-Fi Channel");</script>:</th>
								<td>
									<div class="styled-select">
										<select name="channel_5" id="channel_5" onChange="setChannelWidth('5')">
											<option value="0">Auto</option>
										</select>
									</div>
								</td>
							</tr>
							<tr id="show_dfs_5G">
								<th><script>I18N("h", "DFS Channel");</script>:</th>
								<td>
									<input type="checkbox" class="chkbox" id="dfs_5" onclick="popupIDialog($('#dfs_5').prop('checked'));"/><label for="dfs_5"><span class="chkbox_disabled"><script>I18N("h","Disabled");</script></span><span class="chkbox_enabled"><script>I18N("h","Enabled");</script></span></label>
								</td>
							</tr>
							<tr>
								<th><script>I18N("h", "Transmission Power");</script>:</th>
								<td>
									<div class="styled-select">
										<select name="transmissionPower_5" id="transmissionPower_5">
											<option value="100" selected>High</option>
											<option value="75">Medium</option>
											<option value="50">Low</option>
										</select>
									</div> 
								</td>
							</tr>  
							<tr>
								<th><script>I18N("h", "Channel Width");</script>:</th>
								<td>
									<div class="styled-select">
										<select name="channelWidth_5" id="channelWidth_5">
										</select>
									</div> 
								</td>
							</tr>
							<tr>
								<th><script>I18N("h", "Visibility Status");</script>:</th>
								<td>
									<div class="styled-select">
										<select name="visibilityStatus_5" id="visibilityStatus_5">
											<option value="true">Visible</option>
											<option value="false">Invisible</option>
										</select>
									</div> 
								</td>
							</tr>
							<tr>
								<th class="linkstyle_1"><a href="Schedule.html"><script>I18N("h", "Schedule");</script></a>:</th>
								<td>
									<div class="styled-select">
									<select name="schedule_5" id="schedule_5">
									 	<option value="Always" selected>Always</option>
									</select>
									</div>
								</td>
							</tr>
						</tbody>
					</table>
					<hr  />
				</div>
			</div>
			<!-- popalert -->
			<!-- ***** DFS Popup Message ***** -->
			<div id="createPop" style="display:none">
				<div class="dialogBox" style="width:400px; top:180px;">	
					<table id="buttonTable" border="0">
						<tbody>
							<tr>
								<th style="width: 400px; text-align:left; font-weight: normal; padding: 30px 40px 0 40px;">
									<script>I18N("h", "DFS enables you to use more channels to help find one with the least interference. \n\nHowever, please note that when using DFS, the router must scan for radar signals for a minute before using a channel, and will change channels automatically if radar signals are detected.");</script>
								</th>
							</tr>
							<tr>
								<td style="text-align:center; padding:20px 0 0 0;" width="20px">
									<button type="button" class="styled_button_s" id="btn_OK"  onclick="closeIDialog();">
									<script>I18N("h", "OK");</script>
									</button>
								</td>
							</tr>
						</tbody>
					</table>
				</div>
			</div><!-- DFS Popup Message  -->

			<!-- ------------------ Wi-Fi RADIO_5GHz2 High Band -------------------- -->
			<div id="RADIO_52" style="display:none">
				<table class="block" style="margin: 10px 0 0 0;">
					<tbody>
						<tr>
							<td><div class ="title"><script>I18N("h", "Secondary 5GHz");</script></div></td>
							<td></td>
						</tr>
						<tr>
							<th><script>I18N("h", "Status");</script>:</th>
							<td>
								<input type="checkbox" class="chkbox" id="status_52" onchange="ChangeBandStatus('52')"/><label for="status_52"><span class="chkbox_disabled"><script>I18N("h","Disabled");</script></span><span class="chkbox_enabled"><script>I18N("h","Enabled");</script></span></label>
							</td>
						</tr>
						<tr>
							<th><script>I18N("h", "Wi-Fi Name (SSID)");</script>:</th>
							<td><input class="styled-text" type="text" name="wifiName_52" size="30" maxlength="32" id="wifiName_52"></td>
						</tr>
						<tr>
							<th><script>I18N("h", "Password");</script>:</th>
							<td><input class="styled-text" type="text" name="password_52" maxlength="63" size="30" id="password_52" onKeyUp="OnPressPassword(this, '52')"></td>
						</tr>
					</tbody>
				</table>
				<div class="advButton">
					<span onclick="showAdv('52');">
						<script>I18N("h", "Advanced Settings");</script>...
					</span>
				</div>
				<hr />
				<!-- ------------------ Wi-Fi RADIO_5GHz2  adv---------------------->
				<div id="RADIO_52_adv" style="display:none">
					<table  class="block" border="0">
						<tbody>
							<tr>
								<th><script>I18N("h", "Security Mode");</script>:</th>
								<td>
									<div class="styled-select">
										<select name="security_52" id="security_52" onChange="OnChangeSecurityType(this.value, '52')">
											<option value="None">None</option>
											<option class="security_52_WEP" value="WEP-SHARED">WEP</option>
											<option value="WPAORWPA2-PSK">WPA/WPA2-Personal</option>
										</select>
									</div>  
								</td>
							</tr>
							<tr id="show_80211Mode_5G2">
								<th><script>I18N("h", "802.11 Mode");</script>:</th>
								<td>
									<div class="styled-select">
										<select name="80211Mode_52" id="80211Mode_52" onChange="setChannelWidth('52')">
										</select>
									</div>  
								</td>
							</tr>
							<tr>
								<th><script>I18N("h", "Wi-Fi Channel");</script>:</th>
								<td>
									<div class="styled-select">
										<select name="channel_52" id="channel_52" onChange="setChannelWidth('52')">
											<option value="0">Auto</option>
										</select>
									</div>
								</td>
							</tr>
							<tr id="show_dfs_5G2">
								<th><script>I18N("h", "DFS Channel");</script>:</th>
								<td>
									<input type="checkbox" class="chkbox" id="dfs_52" onclick="popupIDialog($('#dfs_52').prop('checked'));"/><label for="dfs_52"><span class="chkbox_disabled"><script>I18N("h","Disabled");</script></span><span class="chkbox_enabled"><script>I18N("h","Enabled");</script></span></label>
								</td>
							</tr>
							<tr>
								<th><script>I18N("h", "Transmission Power");</script>:</th>
								<td>
									<div class="styled-select">
										<select name="transmissionPower_52" id="transmissionPower_52">
											<option value="100" selected>High</option>
											<option value="75">Medium</option>
											<option value="50">Low</option>
										</select>
									</div> 
								</td>
							</tr>  
							<tr>
								<th><script>I18N("h", "Channel Width");</script>:</th>
								<td>
									<div class="styled-select">
										<select name="channelWidth_52" id="channelWidth_52">
										</select>
									</div> 
								</td>
							</tr>
							<tr>
								<th><script>I18N("h", "Visibility Status");</script>:</th>
								<td>
									<div class="styled-select">
										<select name="visibilityStatus_52" id="visibilityStatus_52">
											<option value="true">Visible</option>
											<option value="false">Invisible</option>
										</select>
									</div> 
								</td>
							</tr>
							<tr>
								<th class="linkstyle_1"><a href="Schedule.html"><script>I18N("h", "Schedule");</script></a>:</th>
								<td>
									<div class="styled-select">
									<select name="schedule_52" id="schedule_52">
									 	<option value="Always" selected>Always</option>
									</select>
									</div>
								</td>
							</tr>
						</tbody>
					</table>
					<hr />
				</div> <!--  id="RADIO_52_adv" -->
			</div> <!--- id="RADIO_52" -->
			<!-- ------------------ WPS -------------------- -->
			<div id="div_WPS" style="display:none;">
				<table class="block" style="margin: 10px 0 0 0;">
					<tbody>
						<tr>
							<td><div class ="title"><script>I18N("h", "Wi-Fi Protected Setup");</script></div></td>
						</tr>
						<tr>
							<th><script>I18N("h", "WPS-PBC Status");</script>:</th>
							<td>
								<input type="checkbox" class="chkbox" id="wps_pbc"/>
								<label for="wps_pbc"><span class="chkbox_disabled"><script>I18N("h","Disabled");</script></span><span class="chkbox_enabled"><script>I18N("h","Enabled");</script></span></label>
							</td>
						</tr>
						<tr>
							<th><script>I18N("h", "WPS-PIN Status");</script>:</th>
							<td>
								<input type="checkbox" class="chkbox" id="wps_pin"/><label for="wps_pin"><span class="chkbox_disabled"><script>I18N("h","Disabled");</script></span><span class="chkbox_enabled"><script>I18N("h","Enabled");</script></span></label>
							</td>
						</tr>
					</tbody>
				</table>
			</div> <!-- id="div_WPS" -->
	     	</div> <!-- id="main" -->
			<!-- ------------------ message -------------------- -->
			<div id="CreatePopAlertMessage" style="display:none">
				<div id="AlertPopRect">
					<div id="AlertPopBody">
						<table class="myAlertPop_table_b" id="waitSettingFinish" border="0" cellspacing="0" style="display:none">
							<tbody>
								<tr>
									<td>
										<center><div id="Loading_pop_image"></div></center>
									</td>
								</tr>
								<tr>
									<td><label id="reciprocal_Number"></label></td>
								</tr>
								<tr>
									<td id="dialog_msg_black"><label id="result_Message"><script>I18N("h", "Your changes are being saved.");</script></label></td>
								</tr>
							</tbody>
						</table>
						<table class="myAlertPop_table_b" id="SuccessSettings" border="0" cellspacing="0"  style="display:none">
						   <tbody>
								 <tr>
								 	<td>
										<center><div id="Information_pop_image"></div></center>
									</td>
								 </tr>
								 <tr>
									 <td>
									 	<div id="dialog_msg_black"><script>I18N("h", "The new settings have been saved.");</script></div>
									 </td>
								 </tr>
								 <tr>
									 <td>
									 	<center><div id="Confirm_btn" onclick="returnToHome()" style="cursor:pointer"><script>I18N("h", "OK");</script></div></center>
									 </td>
								 </tr>
						   </tbody>
						</table>
					</div> <!-- id="AlertPopBody" -->
				</div> <!-- id="AlertPopRect" -->
			</div> <!-- id="CreatePopAlertMessage" -->
	     	</div> <!-- id="content" -->
				<!-- Detect Router Connection, Timmy Add 2013/08/15 -->
				<div id="DetectRouterConnection" style="display:none"></div>
				<div id="footer">
					<div id="copyright"><script>I18N("h", "COPYRIGHT");</script></div>
				</div>
		</div> <!-- id="wrapper" -->
	<!-- popalert -->
	<div id="popalert" class="black_overlay" style="display:none">
	  <div class="popup_window_border" style="position:relative;top:15%;">
	    <div class="popup_window">
	      <div id="popalert_circle">
	        <img src="image/loading.gif" width="62px" height="62px">
	      </div>
	      <div id="popalert_countdown"></div>
	      <div id="popalert_title" style="display:none"></div>
	      <div id="popalert_InformationIMG" style="display:none"></div>
	      <div id="popalert_desc"></div>
	      <div id="popalert_buttons" class="btn-group" role="group" aria-label="...">
	        <button type="button" id="popalert_ok" class="btn btn-default">
	          <script>I18N("h", "OK");</script>
	        </button>
	        <button type="button" id="popalert_cancel" class="btn btn-default">
	          <script>I18N("h", "Cancel");</script>
	        </button>
	      </div>
	    </div>
	  </div>
	</div><!-- popalert end -->

	</form>
<script type="text/javascript" charset="utf-8">
function setValidate()
{
	$.validator.addMethod("checkPassword", function( value, element ) {
		var id = $(element).attr("id");
		var band = id.slice(id.lastIndexOf("_")+1);

		var security_type = $("#security_"+band).val();

		var security_advstatus = $("#RADIO_"+band+"_adv").css("display");
		if((security_type == "None") || (value != "") ||((security_advstatus=="none") && (value =="")))
		{
			return true;
		}
		return false;
	}, jQuery.validator.messages.check_Password);
	
	// Check Is WPA
	$.validator.addMethod("checkASCIIChar", function( value, element ) {
		var ValidHEXRegex = /^[ -~]+$/;

		var id = $(element).attr("id");
		var band = id.slice(id.lastIndexOf("_")+1);
		var security_type = $("#security_"+band).val();
		//no security or WEP	
		if((security_type == "None") || (security_type == "WEP-SHARED"))
		{
			return true;
		}
		
		return COMM_IsASCII(value);
	}, I18N("j","Text field contains illegal characters."));

	$.validator.addMethod("checkWPAPassword", function( value, element ) {
		var id = $(element).attr("id");
		var band = id.slice(id.lastIndexOf("_")+1);

		var security_type = $("#security_"+band).val();

		//no security or WEP	
		if((security_type == "None") || (security_type == "WEP-SHARED"))
		{
			return true;
		}

		//WPA
		if (value.length > 63 || value.length < 8)
		{
			return false;
		}
		return true;
	}, I18N("j","Your password must be between 8-63 characters length"));

	// Check Is WEP
	$.validator.addMethod("checkWEPPassword", function( value, element ) {
		var id = $(element).attr("id");
		var band = id.slice(id.lastIndexOf("_")+1);

		var security_type = $("#security_"+band).val();

		//not WEP	
		if(security_type != "WEP-SHARED")
		{
			return true;
		}

		//for Dlink spec
		if(value.length != 13)
				return false;

		return true;
	}, jQuery.validator.messages.password_WEPCheck);


	// Check password whitespace
	$.validator.addMethod("checkpasswordsp", function( value, element ) {
		var regexwhitespace = /^\s{1,}$/;
		var returnVal=true;

		if(regexwhitespace.test(value)){
			returnVal=false;
		}
		
		return returnVal;
	}, I18N("j","Text field contains illegal characters."));


	//start and end can't has whitespace
	$.validator.addMethod("trimpasswordsp", function( value, element ) {
		var returnVal = true;

		if(value != value.trim()){
			returnVal = false;
		}
		
		return returnVal;
	}, I18N("j","Text field contains illegal characters."));
	
	// check wifi ssid
	$.validator.addMethod("checkssid", function( value, element )
	{	
		var id = $(element).attr("id");
		var band = id.slice(id.lastIndexOf("_")+1);
		if($("#status_"+band).prop("checked"))	//if Wi-Fi enabled
		{
			if(value == "")
				return false;
		}

		return true;
	}, I18N("j", "Please enter a Wi-Fi Name(SSID)."));


	// check wifi ssid-checkillegalssid
	$.validator.addMethod("checkillegalssid", function( value, element )
	{	
		var id = $(element).attr("id");
		var band = id.slice(id.lastIndexOf("_")+1);

		var regexunicode=/^[\u0000-\uFFFF]{1,}$/;
		var regexfullword=/[^\x00-\xFF]{1,}/;
		var regexwhitespace=/^\s{1,}$/;

		var returnVal=true;

		if($("#status_"+band).prop("checked"))	//if Wi-Fi enabled
		{
			if(regexunicode.test(value)){
				if(regexfullword.test(value)){
					returnVal=false;
				}
				if(regexwhitespace.test(value)){
					returnVal=false;	
				}
			}else{
				returnVal=false;
			}
		}else{
			returnVal=true;
		}
		return returnVal;
	}, I18N("j","Text field contains illegal characters."));
	
	$('#wifi_form').validate({
		rules: {
			wifiName_24: {
				checkssid: true,
				checkillegalssid:true,
				trimpasswordsp: true
			},
			password_24: {
				checkPassword: true,
				checkASCIIChar: true,
				checkWPAPassword: true,
				checkWEPPassword: true,
				checkpasswordsp: true,
				trimpasswordsp: true
			},
			wifiName_5: {
				checkssid: true,
				checkillegalssid:true,
				trimpasswordsp: true
			},
			password_5: {
				checkPassword: true,
				checkASCIIChar: true,
				checkWPAPassword: true,
				checkWEPPassword: true,
				checkpasswordsp: true,
				trimpasswordsp: true
			},
			wifiName_52: {
				checkssid: true,
				checkillegalssid:true,
				trimpasswordsp: true
			},
			password_52: {
				checkPassword: true,
				checkASCIIChar: true,
				checkWPAPassword: true,
				checkWEPPassword: true,
				checkpasswordsp: true,
				trimpasswordsp: true
			}
		},
		submitHandler: function(form) {
			CheckConnectionStatus();
			return false;
		}
	});

};
</script>
</body>
</html> 
