/* svn info: $Revision: 900 $ $Date: 2018-06-25 16:45:16 +0800 (Mon, 25 Jun 2018) $ */
function Datalist(){this.list=new Array,this.maxrowid=0}function RuleObj(){this.list=new Array,this.timeArray=new Array(7);for(var t=0;t<7;t++)this.timeArray[t]=new Array(24)}function TimeSet(t,e,i){this.date=t,this.start=e,this.end=i}Datalist.prototype.getData=function(t){var e,i;for(e=0;e<this.list.length&&(i=this.list[e]).rowid!=t;e++);return i},Datalist.prototype.getRowNum=function(t){var e=0;for(e=0;e<this.list.length&&t!=this.list[e].rowid;e++);return e},Datalist.prototype.editData=function(t,e){var i=this.getRowNum(t);return 0!=this.checkData(e,i)&&(e.setRowid(t),this.list.splice(i,1,e),e.setDataToRow($("#tr"+e.rowid)),!0)},Datalist.prototype.deleteData=function(t){var e=this.getRowNum(t);this.list.splice(e,1),$("#tr"+t).remove()},Datalist.prototype.push=function(t){return 0!=this.checkData(t,null)&&(t.setRowid(this.maxrowid),this.list.push(t),this.maxrowid++,t.addRowToHTML("tblSchedule"),!0)},Datalist.prototype.checkData=function(t,e){var i,s,a,r=/_[0-9]$/,n=0;for(""==t.name.replace(/\s/g,"")&&(t.name="NewRule",a=t.name,n=1),i=0;i<this.list.length;i++)if(i!=e)if(s=this.list[i].name,r.test(s)){var l=s.split("_");a=l[0];var o=parseInt(l[1],10);if(t.name==a)n<=o&&(n=o+1);else if(r.test(t.name)){var h=t.name.split("_");h[0]==a&&o==(n=parseInt(h[1],10))&&n++}}else t.name==s&&(a=t.name,n=1);return"NewRule"!=t.name&&"Always"!=t.name||(t.name=a+"_"+n,0==n&&n++),0<n&&(t.name=a+"_"+n),!0},Datalist.prototype.length=function(){return this.list.length},RuleObj.prototype={list:null,rowid:null,name:null,tmpDate:null,setRowid:function(t){this.rowid=t},setName:function(t){this.name=t},length:function(){return this.list.length},push:function(t){return this.list.push(t),!0},remove:function(t){this.list.splice(t,1)},showName:function(){return HTMLEncode(this.name)},addRowToHTML:function(t){var e;e="<tr id='tr"+this.rowid+"'></tr>",$("#"+t+"> tbody").append(e),this.setDataToRow($("#tr"+this.rowid))},setDataToRow:function(t){var e;e="<td>"+this.showName()+"</td>",e+="<td>"+this.showSchedule()+"</td>",e+="<td><img src='image/edit_btn.png?v=2fc10c4616' width=28 height=28 style='cursor:pointer' onclick='editData("+this.rowid+")'/></td>",e+="<td><img src='image/trash.png?v=8fee37bb10' width=41 height=41 style='cursor:pointer' onclick='deleteData("+this.rowid+")'/></td>",t.html(e)},showTimeRange:function(t){var e=new DisplayTime,i="",s=-1,a=-1;switch(t+1){case 1:i="#Monday ";break;case 2:i="#Tuesday ";break;case 3:i="#Wednesday ";break;case 4:i="#Thursday ";break;case 5:i="#Friday ";break;case 6:i="#Saturday ";break;case 7:i="#Sunday "}$(i+".display").remove(),$(i+".sprite").remove();for(var r=0;r<24;r++)if(s<0&&1==this.timeArray[t][r]&&(s=r),0<=s&&(1!=this.timeArray[t][r]?a=r:23==r&&(a=24)),0<=s&&0<=a){3<a-s&&($(i+".week li").eq(s).append(e),e.innerHTML=s+":00 - "+a+":00",e=new DisplayTime);var n=new SpriteBtn;$(i+".week li").eq(a-1).append(n),a=s=-1}}},TimeSet.prototype={date:null,start:null,end:null},RuleObj.prototype.showSchedule=function(){var t="",e="",i="",s=0;this.list=this.list.sort(function(t,e){return t.date>e.date?1:-1});for(var a=0;a<this.list.length;a++){if(i==this.list[a].date)t+=", ";else{switch(0<a&&(t+="<br>"),this.list[a].date){case 1:e="Monday";break;case 2:e="Tuesday";break;case 3:e="Wednesday";break;case 4:e="Thursday";break;case 5:e="Friday";break;case 6:e="Saturday";break;case 7:e="Sunday"}t+=I18N("j",e)+" : ",i=this.list[a].date}0==this.list[a].start&&24==this.list[a].end?(t+=I18N("j","All Day"),s++):t+=this.list[a].start+":00 - "+this.list[a].end+":00"}return 7==s&&(t=I18N("j","All Week")),t},RuleObj.prototype.makeTimeSet=function(){var t=-1,e=-1,i=null;this.list=new Array;for(var s=0;s<7;s++)for(var a=0;a<24;a++)t<0&&1==this.timeArray[s][a]&&(t=a),0<=t&&(1!=this.timeArray[s][a]?e=a:23==a&&(e=24)),0<=t&&0<=e&&(i=new TimeSet(s+1,t,e),this.list.push(i),i=null,e=t=-1)},RuleObj.prototype.makeAllWeek=function(){for(var t=0;t<this.list.length;t++){var e=this.list[t],i=0;if(1==e.date){for(var s=0,a=this.list.length;s<a;s++)e.start==this.list[s].start&&e.end==this.list[s].end&&i++;if(7==i){for(s=0;s<this.list.length;)this.list[s]!=e&&e.start==this.list[s].start&&e.end==this.list[s].end?this.list.splice(s,1):s++;t=e.date=0}}}},RuleObj.prototype.releaseAllWeek=function(){for(var t=0;t<this.list.length;t++)if("0"==this.list[t].date.toString()){for(var e=2;e<=7;e++){var i=new TimeSet(e,this.list[t].start,this.list[t].end);this.list.push(i)}this.list[t].date=1}};