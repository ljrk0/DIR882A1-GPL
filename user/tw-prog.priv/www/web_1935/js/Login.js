/* svn info: $Revision: 847 $ $Date: 2018-06-06 18:37:11 +0800 (Wed, 06 Jun 2018) $ */
function doLogin(o,i){var t=null,r=$.Deferred(),a=new SOAPAction,s=new SOAPLogin,e=new SOAPLoginResponse;return s.Action="request",s.Username="Admin",s.Captcha=i,a.sendSOAPAction("Login",s,e).done(function(e){if(""!=e.Challenge&&""!=e.Cookie&&""!=e.PublicKey){t=(t=hex_hmac_md5(e.PublicKey+o,e.Challenge)).toUpperCase(),$.cookie("uid",e.Cookie,{expires:1,path:"/"}),sessionStorage.setItem("Cookie",e.Cookie),sessionStorage.setItem("PrivateKey",t);var n=hex_hmac_md5(t,e.Challenge);n=n.toUpperCase(),s.Action="login",s.LoginPassword=n,s.Captcha=i,a.sendSOAPAction("Login",s,null).done(function(e){"FAILED"==e.LoginResult?r.reject():r.resolve()}).fail(function(){r.reject()})}else r.reject()}).fail(function(){r.reject()}),r.promise()}function COMM_RandomStr(e){for(var n="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",o="",i=0;i<e;i+=1){var t=Math.floor(Math.random()*n.length);o+=n.substring(t,t+1)}return o}