/* svn info: $Revision: 1056 $ $Date: 2018-08-17 18:29:45 +0800 (Fri, 17 Aug 2018) $ */
/*!
 * jQuery Selectbox plugin 0.2
 *
 * Copyright 2011-2012, Dimitar Ivanov (http://www.bulgaria-web-developers.com/projects/javascript/selectbox/)
 * Licensed under the MIT (http://www.opensource.org/licenses/mit-license.php) license.
 * 
 * Date: Tue Jul 17 19:58:36 2012 +0300
 */
!function(f,s){var _="selectbox",x=!1;function e(){this._state=[],this._defaults={classHolder:"sbHolder",classHolderDisabled:"sbHolderDisabled",classSelector:"sbSelector",classOptions:"sbOptions",classGroup:"sbGroup",classSub:"sbSub",classDisabled:"sbDisabled",classToggleOpen:"sbToggleOpen",classToggle:"sbToggle",classFocus:"sbFocus",width:200,speed:100,effect:"slide",onChange:null,onOpen:null,onClose:null}}f.extend(e.prototype,{_isOpenSelectbox:function(s){return s?this._getInst(s).isOpen:x},_isDisabledSelectbox:function(s){return s?this._getInst(s).isDisabled:x},_attachSelectbox:function(o,s){if(this._getInst(o))return x;var e,d,c,r,t,i,n=f(o),p=this,u=p._newInst(n),b=x,a=(n.find("optgroup"),n.find("option")),g=a.length;function l(){var s,e,t=this.attr("id").split("_")[1];for(s in p._state)s!==t&&p._state.hasOwnProperty(s)&&(e=f("select[sb='"+s+"']")[0])&&p._closeSelectbox(e)}function h(){var n=!(!arguments[1]||!arguments[1].sub),a=!(!arguments[1]||!arguments[1].disabled),l="";arguments[0].each(function(s){var e,t=f(this),i=f("<li>");l=-1<t.closest("select").attr("id").toLowerCase().indexOf("schedule")||-1<t.closest("select").attr("id").toLowerCase().indexOf("timezone")?t.text():I18N("j",t.text()),t.is(":selected")&&(d.text(l),b=!0),s===g-1&&i.addClass("last"),t.is(":disabled")||a||"none"==t.css("display")?"none"==t.css("display")||(e=f("<span>",{text:l}).addClass(u.settings.classDisabled),n&&e.addClass(u.settings.classSub),e.appendTo(i)):(e=f("<a>",{href:""+t.val(),rel:t.val()}).text(l).bind("vclick.sb",function(s){s&&s.preventDefault&&s.preventDefault();var e=c,t=f(this);e.attr("id").split("_")[1];p._changeSelectbox(o,t.attr("rel"),l),p._closeSelectbox(o)}).bind("vmouseover.sb",function(){var s=f(this);s.parent().siblings().find("a").removeClass(u.settings.classFocus),s.addClass(u.settings.classFocus)}).bind("vmouseout.sb",function(){f(this).removeClass(u.settings.classFocus)}),n&&e.addClass(u.settings.classSub),t.is(":selected")&&e.addClass(u.settings.classFocus),e.appendTo(i)),i.appendTo(r)})}n.attr("sb",u.uid),f.extend(u.settings,p._defaults,s),p._state[u.uid]=x,n.hide(),u.settings.width.toString().indexOf("%")<0?(t=parseInt(u.settings.width)+"px",i=parseInt(u.settings.width)-30+"px"):i=t=u.settings.width,e=f("<div>",{id:"sbHolder_"+u.uid,class:u.settings.classHolder,style:"width:"+t,tabindex:n.attr("tabindex")}),(d=f("<a>",{id:"sbSelector_"+u.uid,href:"#",class:u.settings.classSelector,style:"width:"+i})).on("vclick",function(s){s.preventDefault(),l.apply(f(this),[]);var e=f(this).attr("id").split("_")[1];p._state[e]?p._closeSelectbox(o):p._openSelectbox(o)}),(c=f("<a>",{id:"sbToggle_"+u.uid,href:"#",class:u.settings.classToggle})).on("vclick",function(s){s.preventDefault(),l.apply(f(this),[]);var e=f(this).attr("id").split("_")[1];p._state[e]?p._closeSelectbox(o):p._openSelectbox(o)}),c.appendTo(e),r=f("<ul>",{id:"sbOptions_"+u.uid,class:u.settings.classOptions,style:"width:"+t,css:{display:"none"}}),n.children().each(function(s){var e,t=f(this),i={};if(t.is("option")){var n=t.text().split(";");1<n.length&&t.text(n[1]),h(t)}else t.is("optgroup")&&(e=f("<li>"),f("<span>",{text:t.attr("label")}).addClass(u.settings.classGroup).appendTo(e),e.appendTo(r),t.is(":disabled")&&(i.disabled=!0),i.sub=!0,h(t.find("option"),i))}),b||d.text(a.first().text()),f.data(o,_,u),e.data("uid",u.uid).bind("keydown.sb",function(s){var e=s.charCode?s.charCode:s.keyCode?s.keyCode:0,t=f(this),i=t.data("uid"),n=t.siblings("select[sb='"+i+"']").data(_),a=t.siblings(["select[sb='",i,"']"].join("")).get(0),l=t.find("ul").find("a."+n.settings.classFocus);switch(e){case 37:case 38:if(0<l.length)f("a",t).removeClass(n.settings.classFocus),0<(o=l.parent().prevAll("li:has(a)").eq(0).find("a")).length&&(o.addClass(n.settings.classFocus).focus(),f("#sbSelector_"+i).text(o.text()));break;case 39:case 40:var o;f("a",t).removeClass(n.settings.classFocus),0<(o=0<l.length?l.parent().nextAll("li:has(a)").eq(0).find("a"):t.find("ul").find("a").eq(0)).length&&(o.addClass(n.settings.classFocus).focus(),f("#sbSelector_"+i).text(o.text()));break;case 13:0<l.length&&p._changeSelectbox(a,l.attr("rel"),l.text()),p._closeSelectbox(a);break;case 9:if(a)(n=p._getInst(a))&&(0<l.length&&p._changeSelectbox(a,l.attr("rel"),l.text()),p._closeSelectbox(a));var d=parseInt(t.attr("tabindex"),10);s.shiftKey?d--:d++,f("*[tabindex='"+d+"']").focus();break;case 27:p._closeSelectbox(a)}return s.stopPropagation(),!1}).delegate("a","vmouseover",function(s){f(this).addClass(u.settings.classFocus)}).delegate("a","vmouseout",function(s){f(this).removeClass(u.settings.classFocus)}),r.children().last().find("a").css("border-bottom","0px"),d.appendTo(e),r.appendTo(e),e.insertAfter(n),f("html").on("vmousedown",function(s){s.stopPropagation(),f("select").selectbox("close")}),f([".",u.settings.classHolder,", .",u.settings.classSelector].join("")).on("vmousedown",function(s){s.stopPropagation()})},_detachSelectbox:function(s){var e=this._getInst(s);if(!e)return x;f("#sbHolder_"+e.uid).remove(),f.data(s,_,null),f(s).show()},_changeSelectbox:function(s,e,t){var i,n=this._getInst(s);n&&(i=this._get(n,"onChange"),f("#sbSelector_"+n.uid).text(t)),e=e.replace(/\'/g,"\\'"),f(s).find("option[value='"+e+"']").prop("selected",!0),n&&i?i.apply(n.input?n.input[0]:null,[e,n]):n&&n.input&&n.input.trigger("change")},_enableSelectbox:function(s){var e=this._getInst(s);if(!e||!e.isDisabled)return x;f("#sbHolder_"+e.uid).removeClass(e.settings.classHolderDisabled),e.isDisabled=x,f.data(s,_,e)},_disableSelectbox:function(s){var e=this._getInst(s);if(!e||e.isDisabled)return x;f("#sbHolder_"+e.uid).addClass(e.settings.classHolderDisabled),e.isDisabled=!0,f.data(s,_,e)},_optionSelectbox:function(s,e,t){var i=this._getInst(s);if(!i)return x;i[e]=t,f.data(s,_,i)},_openSelectbox:function(s){var e=this._getInst(s);if(e&&!e.isOpen&&!e.isDisabled){var t=f("#sbOptions_"+e.uid),i=parseInt(f(window).height(),10),n=f("#sbHolder_"+e.uid).offset(),a=f(window).scrollTop(),l=t.prev().height(),o=i-(n.top-a)-l/2,d=this._get(e,"onOpen"),c=f("#sbOptions_"+e.uid).children("li:not(:empty)").length,r=o-l,p=c*l,u=n.top-a-l;r<p&&p<u?(l=0-l*c-4*c-1,f("#sbOptions_"+e.uid).removeClass("down").addClass("up"),f("#sbHolder_"+e.uid).addClass("up")):(f("#sbOptions_"+e.uid).removeClass("up").addClass("down"),f("#sbHolder_"+e.uid).addClass("down"));var b=f("#sbHolder_"+e.uid).width()+2;t.css({top:l+"px",width:b,maxHeight:o-l+"px"}),"fade"===e.settings.effect?t.fadeIn(e.settings.speed):t.slideDown(e.settings.speed),f("#sbToggle_"+e.uid).addClass(e.settings.classToggleOpen),this._state[e.uid]=!0,e.isOpen=!0,d&&d.apply(e.input?e.input[0]:null,[e]),f.data(s,_,e)}},_closeSelectbox:function(s){var e=this._getInst(s);if(e&&e.isOpen){var t=this._get(e,"onClose");"fade"===e.settings.effect?f("#sbOptions_"+e.uid).fadeOut(e.settings.speed):f("#sbOptions_"+e.uid).slideUp(e.settings.speed),f("#sbToggle_"+e.uid).removeClass(e.settings.classToggleOpen),f("#sbHolder_"+e.uid).removeClass("up down"),this._state[e.uid]=x,e.isOpen=x,t&&t.apply(e.input?e.input[0]:null,[e]),f.data(s,_,e)}},_newInst:function(s){return{id:s[0].id.replace(/([^A-Za-z0-9_-])/g,"\\\\$1"),input:s,uid:Math.floor(99999999*Math.random()),isOpen:x,isDisabled:x,settings:{}}},_getInst:function(s){try{return f.data(s,_)}catch(s){throw"Missing instance data for this selectbox"}},_get:function(s,e){return void 0!==s.settings[e]?s.settings[e]:this._defaults[e]}}),f.fn.selectbox=function(s){var e=Array.prototype.slice.call(arguments,1);return"string"==typeof s&&"isDisabled"==s?f.selectbox["_"+s+"Selectbox"].apply(f.selectbox,[this[0]].concat(e)):"option"==s&&2==arguments.length&&"string"==typeof arguments[1]?f.selectbox["_"+s+"Selectbox"].apply(f.selectbox,[this[0]].concat(e)):this.each(function(){"string"==typeof s?f.selectbox["_"+s+"Selectbox"].apply(f.selectbox,[this].concat(e)):f.selectbox._attachSelectbox(this,s)})},f.selectbox=new e,f.selectbox.version="0.2"}(jQuery);