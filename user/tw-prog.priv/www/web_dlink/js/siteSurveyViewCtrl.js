var siteSurveyViewCtrl=function(){function l(){$("#scanSection, #passwordSection").hide()}function g(a){0!=f&&($("body").off("touchmove"),$("#SurveyListTable").off("touchmove"),$("#wrapper").css({height:"","overflow-y":""}),a&&($("#SurveyListTable").on("touchmove",function(a){a.stopPropagation()}),$("body").on("touchmove",function(a){a.preventDefault()}),a=$(window).height(),$("#wrapper").css({height:a,"overflow-y":"hidden"})),$("#survey_key").off("focus").on("focus",function(a){var d=$("#passwordSection");
a=$(window).height();var e=d.height(),d=d.offset();a=parseInt((a-350)/2-e/2);a=d.top-$(document).scrollTop()-a;0<a&&$(document).scrollTop(a)}))}function n(){$("#SiteSurvey").hide();g(!1);$(window).resize(function(){})}function t(){$(window).resize(function(){m()})}function m(){$("#SiteSurveySection").css({top:"","max-height":""});$("#SurveyListTable").css({"max-height":""});var a=$(window).height(),b=$("#SiteSurveySection").outerHeight();200>a&&(a=200);b=parseInt(a/2-b/2);0<b&&150>b?$("#SiteSurveySection").css({top:b,
"max-height":""}):150<=b?$("#SiteSurveySection").css({top:150,"max-height":""}):$("#SiteSurveySection").css({top:10,"max-height":a-20});a=$("#SiteSurveySection").height()-80;$("#SurveyListTable").css({"max-height":a})}function p(a){l();$("#backBtn").hide();$("#selectBtn").css("width","100%").html(I18N("j","Select")).attr("disabled",!0).off("click").on("click",function(){var a=siteSelected;"NONE"!=a.SupportedSecurity.SecurityInfo[0].SecurityType.toUpperCase()?u(a):q(a)});var b=$("#SurveyListTable");
b.html("");for(var d in a){var e=a[d],c='<button type="button" class="list-group-item">'+HTMLEncode(e.SSID),c=c+'<span class="stationInfo">',c=c+v(e.SupportedSecurity.SecurityInfo[0].SecurityType),c=c+w(parseInt(e.SignalStrength)),c=c+"</span></button>",c=$(c);x(c,e);b.append(c)}$("#SiteSurvey").show();$("#scanSection").show();m();g(!0)}function x(a,b){var d="click";f&&(d="touchstart");a.on(d,function(a){changeTimeoutAction();siteSelected=b;$("#selectBtn").attr("disabled",!1);$("#SurveyListTable > button").removeClass("list-selected");
$(this).addClass("list-selected");f&&(r=a.originalEvent.touches[0].pageY)});if(f)a.on("touchmove",function(a){20<=Math.abs(a.originalEvent.touches[0].pageY-r)&&(siteSelected=null,$("#selectBtn").attr("disabled",!0),$("#SurveyListTable > button").removeClass("list-selected"))})}function u(a){l();y();$("#selectBtn").html(I18N("j","OK")).off("click").on("click",function(){$("#survey_form").submit()});$("#passwordSection_desc").html(I18N('j', "A password is required to join \"%s\"", HTMLEncode(a.SSID)));$("#survey_key").attr("placeholder",
I18N("j","Password")).val("");$("#backBtn").show();$("#passwordSection").show();$("#selectBtn").css("width","");g(!1);m();$("#survey_key").focus()}function q(a){$("#APCssid").val(a.SSID);$("#APCssid_auto").html(HTMLEncode(a.SSID));$("#APCssid_div").hide();$("#APCssid_div_auto").show();"NONE"!=a.SupportedSecurity.SecurityInfo[0].SecurityType.toUpperCase()?$("#APCkey").val($("#survey_key").val()).attr("disabled",!1):$("#APCkey").val("").attr("disabled",!0);save_button_changed();n()}function v(a){var b=
"";"NONE"!=a.toUpperCase()&&(b="<img src='image/wisp_security.png' width='15' height='21' />");return b}function w(a){var b="";35>=a?b="wisp_strength_low.png":35<a&&70>=a?b="wisp_strength_medium.png":70<a&&(b="wisp_strength_high.png");return"<img src='image/"+b+"' width='25' height='20' />"}function y(){null!=h&&h.resetForm();h=$("#survey_form").validate({rules:{survey_key:{checkASCIIChar:!0,checkWPAPassword:!0}},submitHandler:function(a){q(siteSelected);return!1},errorPlacement:function(a,b){var d=
b.parent();a.insertAfter(d).css({color:"#f00","font-size":"14px","font-weight":"normal"})},skipBr:function(a){return 0==a.parent("div").length?!1:!0}})}var h=null,k=null,r=0,f=!1;return{init:function(){var a="click";k=h=null;(f=isTouch())&&(a="tap");$("#closeBtn").on(a,function(){n()});$("#backBtn").on("click",function(){p(k)})},start:function(){$("#SiteSurvey").hide();l();$("#SurveyListTable").html("");k=siteSelected=null;t();PopView.show(I18N("j","Scanning..."));doSiteSurvey().done(function(a){k=
a;p(a);PopView.hide()});g(!0)}}}();