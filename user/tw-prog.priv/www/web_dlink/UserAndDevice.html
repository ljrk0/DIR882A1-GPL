<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns= "http://www.w3c.org/1999/xhtml">

<head>
<title>D-LINK</title>
<!-- for browser tab logo -->
<link rel="icon" href="/image/dlink-favicon.ico">
<link rel="shortcut icon" href="/image/favicon.ico" type="image/x-icon" /> 
<meta http-equiv="X-UA-Compatible" content="IE=9">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta http-equiv="Content-Type" content="text/css">
<link rel="stylesheet" type="text/css" href="/css/jquery.selectbox.css" />
<script type="text/javascript" charset="utf-8" src="/js/initialJQ.js"></script>
<script type="text/javascript" charset="utf-8" src="/js/initialJS.js"></script>
<script type="text/javascript" charset="utf-8" src="/js/initialCSS.js"></script>
<script type="text/javascript" charset="utf-8" src="/js/initialValidate.js"></script>
<script type="text/javascript" charset="utf-8" src="/js/UserDevice_CreateUser.js"></script>
<script type="text/javascript" charset="utf-8" src="/js/SOAP/SOAPUser.js"></script>

<link rel="stylesheet" type="text/css" href="css/style_pop.css" media="all" />
<script type="text/javascript" charset="utf-8" src="/js/popView.js"></script>

<style>
body {position:relative;}
#createPop	{	display: none;position:absolute;z-index:500;left:0;top:0;width:100%;height:200%;	}
#editPop 	{	display: none;position:absolute;z-index:500;left:0;top:0;width:100%;height:200%;	}
.progressBar {
	background-color: #fff;
	height: 30px;
	width: 300px;
	border: 1px solid #4598aa;
	color: #222;
}
.progressBar .bar {
	background-color: #4598aa;
	height: 30px;
	width: 0px;
}
</style>
<script type="text/javascript">
//xframeoption
if(top!=self){top.location=self.location;}

//session
if (sessionStorage.getItem('PrivateKey') === null){
	window.location.replace('../info/Login.html');
}

	var HNAP = new HNAP_XML();
	var set_Iteration;
	var counter = 1;
	var counter2 = 1;
	// Detect how many PortForwarding we can use.
	var Total_User = 0;
	// Set up the limit total Portforward
	var Limit_TotalUser = 10;
	var IsOpenFolder = 0;
	var IsOpenFolder2 = 0;
	var Name_CheckList = [];
	var DefaultDirectory_Path = "";
	var DefaultDirectory_Name = "";
	var DefaultDirectory_RootN = "";
	var DefaultDirectory_RootP = "";
	var userList = new Array();
	var delUserList = new Array();
	var clickmode = "add";
	function Load_HTML()	{	$("#header").load("header.html");	}
	function Initial() {
		initialMenu();
		initialDetectRouterConnection();
	}
	function setIteration(value)	{	set_Iteration = value;	}
	function createUserButton() {
		changeTimeoutAction();
		document.getElementById("status_SAMBA").checked = true;
		document.getElementById("status_FTP").checked = false;
		document.getElementById("status_VPN").checked = false;
		document.getElementById("SAMBA_Folder").value = I18N("j", "root");
		document.getElementById("FTP_Folder").value = I18N("j", "root");
		document.getElementById("createPop").style.display = "block";
		document.getElementById("createButton").disabled = true;
		$("#SAMBA_Permission").selectbox('detach');
		$("#SAMBA_Permission").val('1');
		$("#SAMBA_Permission").selectbox('attach');
		$("#SAMBA_Permission").selectbox('enable');
		$("#FTP_Permission").selectbox('detach');
		$("#FTP_Permission").val('1');
		$("#FTP_Permission").selectbox('attach');
		$("#FTP_Permission").selectbox('disable');
		document.getElementById("SAMBA_Folder").disabled = false;
		document.getElementById("FTP_Folder").disabled = true;
		document.getElementById("searchFolderSAMBA").disabled = false;
		document.getElementById("searchFolderFTP").disabled = true;
	}
	function closeCreateUserPOP() {
		changeTimeoutAction();
		
		var GetResult = AddRowToIndex();
		
		if (GetResult == "Success") {
			document.getElementById("status_SAMBA").checked = true;
			document.getElementById("status_FTP").checked = false;
			document.getElementById("status_VPN").checked = false;
			document.getElementById("createPop").style.display = "none";
			document.getElementById("createButton").disabled = false;
			$("#SAMBA_Permission").selectbox('detach');
			$("#SAMBA_Permission").val('1');
			$("#SAMBA_Permission").selectbox('attach');
			$("#FTP_Permission").selectbox('detach');
			$("#FTP_Permission").val('1');
			$("#FTP_Permission").selectbox('attach');
			check_TotalUser(Limit_TotalUser, Total_User);
		}
	}
	function clearCreateRulePOP() {
		changeTimeoutAction();
		
		document.getElementById("status_SAMBA").checked = true;
		document.getElementById("status_FTP").checked = false;
		document.getElementById("status_VPN").checked = false;
		document.getElementById("createPop").style.display = "none";
		document.getElementById("createButton").disabled = false;
		document.getElementById("shareport_UserName").value = "";
		document.getElementById("shareport_Password").value = "";
		$("#SAMBA_Permission").selectbox('detach');
		$("#SAMBA_Permission").val('1');
		$("#SAMBA_Permission").selectbox('attach');
		$("#SAMBA_Permission").selectbox('enable');
		$("#FTP_Permission").selectbox('detach');
		$("#FTP_Permission").val('1');
		$("#FTP_Permission").selectbox('attach');
		$("#FTP_Permission").selectbox('disable');
		document.getElementById("SAMBA_Folder").value = I18N("j", "root");
		$("#user_c1_form").validate().resetForm();
		document.getElementById("FTP_Folder").value = I18N("j", "root");
	}
	function editData(id) {
		changeTimeoutAction();
		
		// document.getElementById("editPop").style.display = "inline";
		document.getElementById("editPop").style.display = "block";
		document.getElementById("createButton").disabled = true;
		editDataGet(id);
	}
	function downloadData(userName) {
		changeTimeoutAction();

		document.forms['dlquickvpnsettings'].action = "/HNAP1/dlquickvpnsettings.cgi?username=" + userName;
		document.forms['dlquickvpnsettings'].submit();	    
	}
	function closeEditUserPOP(set_Iteration) {
		changeTimeoutAction();
		
		var the_Iteration = set_Iteration;
		var GetResult = assignRowToIndex(the_Iteration);
		if (GetResult == "Success")
		{
			document.getElementById("editPop").style.display = "none";
			document.getElementById("createButton").disabled = false;
		}
		else if (GetResult == "Error")		{	alert("Name cannot be the same.");	}
		else if (GetResult == "NameNull")	{	alert("Name cannot be null.");		}
		else		{	document.getElementById("editPop").style.display = "none";	}
	}

	function clearEditRulePOP() {
		changeTimeoutAction();
		
		document.getElementById("editPop").style.display = "none";
		document.getElementById("createButton").disabled = false;
		$("#user_c2_form").validate().resetForm();
	}

	function closeTreeViewPOP() {
		if(clickmode == "add"){
			document.getElementById("createPop").style.display = "block";
			document.getElementById("treeViewPop").style.display = "none";
			document.getElementById("partitionView").innerHTML = "";
			document.getElementById("FolderTreeView").innerHTML = "";
		}else{
			document.getElementById("editPop").style.display = "block";
			document.getElementById("treeViewPop").style.display = "none";
			document.getElementById("partitionView").innerHTML = "";
			document.getElementById("FolderTreeView").innerHTML = "";
		}
	}
	function closeTreeView2POP() {
		document.getElementById("editPop").style.display = "block";
		document.getElementById("treeViewPop2").style.display = "none";
		document.getElementById("partitionView2").innerHTML = "";
		document.getElementById("FolderTreeView2").innerHTML = "";
	}
	
	function GetEditDirectoryList() {
		var xml_GetListDirectory = HNAP.GetXML("GetListDirectory");
		var partition_List = xml_GetListDirectory.Get("GetListDirectoryResponse/DirectoryList/ListDirectoryInfo#");
		var div1 = document.getElementById("partitionView2");
		var div2 = document.getElementById("FolderTreeView2");
		var tmp = "";
		div1.innerHTML = "";
		div2.innerHTML = "";
		document.getElementById("editPop").style.display = "none";
		document.getElementById("treeViewPop2").style.display = "inline";
		if (partition_List > 1)
		{
			for (var i = 1; i <= partition_List; i ++)
			{
				tmp = "<li><a href=\"javascript:GetDirectory_EditPartition(" + i + ")\" id=\"editpartition_" + i + "\" style=\"font-size:16px;line-height:35px;color:#4598aa;\"></a></li>";
				div1.innerHTML += tmp;
				var Directory_Name = xml_GetListDirectory.Get("GetListDirectoryResponse/DirectoryList/ListDirectoryInfo:" + i + "/DirectoryName");
				Directory_Name = Directory_Name.replace(":", "");
				document.getElementById("editpartition_" + i).innerHTML = Directory_Name;
			}
			var Directory_Path = xml_GetListDirectory.Get("GetListDirectoryResponse/DirectoryList/ListDirectoryInfo:1/DirectoryPath");
			GetDirectory_EditPartition(1);
		}
		else
		{
			tmp = "<li><a href=\"javascript:GetDirectory_EditPartition(1)\" id=\"editpartition_1\" style=\"font-size:16px;line-height:35px;color:#4598aa;\"></a></li>";
			div1.innerHTML += tmp;
			var Directory_Name = xml_GetListDirectory.Get("GetListDirectoryResponse/DirectoryList/ListDirectoryInfo:1/DirectoryName");
			var Directory_Path = xml_GetListDirectory.Get("GetListDirectoryResponse/DirectoryList/ListDirectoryInfo:1/DirectoryPath");
			Directory_Name = Directory_Name.replace(":", "");
			document.getElementById("editpartition_1").innerHTML = Directory_Name;
			GetDirectory_EditPartition(1);
		}
	}
	function GetEditSubFolderList(linkstr) {
		if (IsOpenFolder == 0)
		{
			var xml_GetListDirectory = HNAP.GetXML("GetListDirectory", new Array("ListDirectoryPath", linkstr));
			var Directory_ListNumber = xml_GetListDirectory.Get("GetListDirectoryResponse/DirectoryList/ListDirectoryInfo#");
			var div1 = document.getElementById("FolderTreeView2");
			var List_counter = 1;
			var default_Setting = 0;
			div1.innerHTML += "<br />";
			for (var i = 0; i < Directory_ListNumber; i ++)
			{
				var folder_Name = xml_GetListDirectory.Get("GetListDirectoryResponse/DirectoryList/ListDirectoryInfo:" + List_counter + "/DirectoryName");
				var folder_Path = xml_GetListDirectory.Get("GetListDirectoryResponse/DirectoryList/ListDirectoryInfo:" + List_counter + "/DirectoryPath");
				var folder_Sub = xml_GetListDirectory.Get("GetListDirectoryResponse/DirectoryList/ListDirectoryInfo:" + List_counter + "/SubDirectory");
				var re_folder_Name = { trueFolderName: folder_Name };
				if (folder_Sub == "true")	{	div1.innerHTML += "<div id=subfolder_" + counter + ">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href=\"javascript:Get_SubFolderList2(" + counter + ");\"><img src=\"image/folder_open.png\" border=\"0\"><a href=\"javascript:Return_Back2(" + counter + ");\">" + re_folder_Name.trueFolderName + "</a><label></label><label></label><label></label></div>";	}
				else						{	div1.innerHTML += "<div id=subfolder_" + counter + ">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href=\"javascript:Get_SubFolderList2(" + counter + ");\"><a href=\"javascript:Return_Back2(" + counter + ");\">" + re_folder_Name.trueFolderName + "</a><label></label><label></label><label></label></div>";	}
				document.getElementById("subfolder_" + counter).childNodes[3].innerHTML = folder_Path;
				document.getElementById("subfolder_" + counter).childNodes[3].style.display = "none";
				document.getElementById("subfolder_" + counter).childNodes[4].innerHTML = folder_Sub;
				document.getElementById("subfolder_" + counter).childNodes[4].style.display = "none";
				document.getElementById("subfolder_" + counter).childNodes[5].innerHTML = default_Setting;
				document.getElementById("subfolder_" + counter).childNodes[5].style.display = "none";
				counter ++;
				List_counter ++;
			}
			IsOpenFolder = 1;
		}
	}
	function Get_SubFolderList2(str) {
		var GetDefaultSettings = document.getElementById("subfolder_" + str).childNodes[5].innerHTML;
		if (GetDefaultSettings == 0) {
			// ????e?O?_???l???
			var getSubFolder = document.getElementById("subfolder_" + str).childNodes[4].innerHTML;
			if (getSubFolder == "true") {
				document.getElementById("subfolder_" + str).childNodes[5].innerHTML = 1;
				// ???o??e?????
				var getFolder = document.getElementById("subfolder_" + str).childNodes[3].innerHTML;
				var xml_GetListDirectory = HNAP.GetXML("GetListDirectory", new Array("ListDirectoryPath", getFolder));
				// ??List????h?????
				var Directory_ListNumber = xml_GetListDirectory.Get("GetListDirectoryResponse/DirectoryList/ListDirectoryInfo#");
				var List_counter = 1;
				// ?O?_???l???
				var folder_Sub = xml_GetListDirectory.Get("GetListDirectoryResponse/DirectoryList/ListDirectoryInfo:" + List_counter + "/SubDirectory");
				document.getElementById("subfolder_" + str).childNodes[1].childNodes[0].src = "./image/folder_close.png";
				var div1 = document.getElementById("subfolder_" + str);
				for (var i = 0; i < Directory_ListNumber; i ++)
				{
					var folder_Name = xml_GetListDirectory.Get("GetListDirectoryResponse/DirectoryList/ListDirectoryInfo:" + List_counter + "/DirectoryName");
					var folder_Path = xml_GetListDirectory.Get("GetListDirectoryResponse/DirectoryList/ListDirectoryInfo:" + List_counter + "/DirectoryPath");
					var folder_Sub = xml_GetListDirectory.Get("GetListDirectoryResponse/DirectoryList/ListDirectoryInfo:" + List_counter + "/SubDirectory");
					var default_Setting = 0;
					var re_folder_Name = { trueFolderName: folder_Name };
					var brcount = folder_Path.match(/\//g);
					var tmp = "";
					tmp += "<div id=subfolder_" + counter + ">";
					for (var j = 1; j < brcount.length; j ++)	{	tmp += "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;";	}
					if (folder_Sub == "true")	{	tmp += "<a href=\"javascript:Get_SubFolderList2(" + counter + ");\"><img src=\"image/folder_open.png\" border=\"0\"><a href=\"javascript:Return_Back2(" + counter + ");\"></a><label></label><label></label><label></label></div>";	}
					else						{	tmp += "&nbsp;&nbsp;&nbsp;&nbsp;<a href=\"javascript:Get_SubFolderList2(" + counter + ");\"><a href=\"javascript:Return_Back2(" + counter + ");\"></a><label></label><label></label><label></label></div>";	}
					div1.innerHTML += tmp;
					document.getElementById("subfolder_" + counter).childNodes[2].innerHTML = re_folder_Name.trueFolderName;
					document.getElementById("subfolder_" + counter).childNodes[3].innerHTML = folder_Path;
					document.getElementById("subfolder_" + counter).childNodes[3].style.display = "none";
					document.getElementById("subfolder_" + counter).childNodes[4].innerHTML = folder_Sub;
					document.getElementById("subfolder_" + counter).childNodes[4].style.display = "none";
					document.getElementById("subfolder_" + counter).childNodes[5].innerHTML = default_Setting;
					document.getElementById("subfolder_" + counter).childNodes[5].style.display = "none";
					counter ++;
					List_counter ++;
				}
			} else {
				document.getElementById("subfolder_" + str).childNodes[1].childNodes[0].src = "/image/folder_close.png";	
			}
		} else {
			var folder_Sub = document.getElementById("subfolder_" + str).childNodes[4].innerHTML;
			var folder_Path = document.getElementById("subfolder_" + str).childNodes[3].innerHTML;
			var getFolder = document.getElementById("subfolder_" + str).childNodes[2].innerHTML;
			var div = document.getElementById("subfolder_" + str);
			var re_folder_Name = { trueFolderName: getFolder };
			var brcount = folder_Path.match(/\//g);
			var tmp = "";
			for (var j = 1; j < brcount.length; j ++)	{	tmp += "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;";	}
			div.innerHTML = tmp + "<a href=\"javascript:Get_SubFolderList2(" + str + ");\" id=subfolder_" + str + "><img src=\"image/folder_open.png\" border=\"0\"></a><a href=\"javascript:Return_Back2(" + str + ");\"></a><label></label><label></label><label></label></div>";
			var default_Setting = 0;
			document.getElementById("subfolder_" + str).childNodes[2].innerHTML = re_folder_Name.trueFolderName;
			document.getElementById("subfolder_" + str).childNodes[3].innerHTML = folder_Path;
			document.getElementById("subfolder_" + str).childNodes[3].style.display = "none";
			document.getElementById("subfolder_" + str).childNodes[4].innerHTML = folder_Sub;
			document.getElementById("subfolder_" + str).childNodes[4].style.display = "none";
			document.getElementById("subfolder_" + str).childNodes[5].innerHTML = default_Setting;
			document.getElementById("subfolder_" + str).childNodes[5].style.display = "none";
		}
	}
	function GetDirectoryList(mode, band) {
		clickmode = mode;
		var xml_GetListDirectory = HNAP.GetXML("GetListDirectory");
		var partition_List = xml_GetListDirectory.Get("GetListDirectoryResponse/DirectoryList/ListDirectoryInfo#");
		var div1 = document.getElementById("partitionView");
		var div2 = document.getElementById("FolderTreeView");
		var tmp = "";
		div1.innerHTML = "";
		div2.innerHTML = "";
		if(clickmode =="add"){
			document.getElementById("createPop").style.display = "none";
			document.getElementById("treeViewPop").style.display = "inline";
		} else {
			document.getElementById("editPop").style.display = "none";
			document.getElementById("treeViewPop").style.display = "inline";
		}


		if (partition_List > 1) {
			for (var i = 1; i <= partition_List; i ++) {
				tmp = "<li><a href=\"javascript:GetDirectory_Partition(" + i + ", '" + mode + "', '" + band + "')\" id=\"partition_" + i + "\" style=\"font-size:16px;line-height:35px;color:#4598aa;\"></a></li>";
				div1.innerHTML += tmp;
				var Directory_Name = xml_GetListDirectory.Get("GetListDirectoryResponse/DirectoryList/ListDirectoryInfo:" + i + "/DirectoryName");
				Directory_Name = Directory_Name.replace(":", "");
				document.getElementById("partition_" + i).innerHTML = Directory_Name;
			}
			var Directory_Path = xml_GetListDirectory.Get("GetListDirectoryResponse/DirectoryList/ListDirectoryInfo:1/DirectoryPath");
			GetDirectory_Partition(1, mode, band);
		} else {
			tmp = "<li><a href=\"javascript:GetDirectory_Partition(1, '" + mode + "', '" + band + "')\" id=\"partition_1\" style=\"font-size:16px;line-height:35px;color:#4598aa;\"></a></li>";
			div1.innerHTML += tmp;
			var Directory_Name = xml_GetListDirectory.Get("GetListDirectoryResponse/DirectoryList/ListDirectoryInfo:1/DirectoryName");
			var Directory_Path = xml_GetListDirectory.Get("GetListDirectoryResponse/DirectoryList/ListDirectoryInfo:1/DirectoryPath");
			Directory_Name = Directory_Name.replace(":", "");
			document.getElementById("partition_1").innerHTML = Directory_Name;
			GetDirectory_Partition(1, mode, band);
		}
	}
	
	function GetDirectory_Partition(val, mode, band) {
		var div1 = document.getElementById("FolderTreeView");
		div1.innerHTML = "";
		setTimeout("GetDirectory_Partition_Append(" + val + ", '" + mode + "', '" + band + "')", 100);
	}

	function GetDirectory_Partition_Append(val, mode, band) {
		var xml_GetListDirectory = HNAP.GetXML("GetListDirectory");
		var Directory_Path = xml_GetListDirectory.Get("GetListDirectoryResponse/DirectoryList/ListDirectoryInfo:" + val + "/DirectoryPath");
		var div1 = document.getElementById("FolderTreeView");
		div1.innerHTML += "<a href=\"javascript:ReturnBack('" + mode + "', '" + band + "');\" id=\"rootName\" style=\"margin: 0 0 0 10px;\"></a>";
		document.getElementById("rootName").innerHTML = Directory_Path;
		IsOpenFolder = 0;
		GetSubFolderList(Directory_Path, mode, band);
	}

	function GetDirectory_EditPartition(val) {
		var div1 = document.getElementById("FolderTreeView2");
		div1.innerHTML = "";
		setTimeout("GetDirectory_EditPartition_Append(" + val + ")", 100);
	}

	function GetDirectory_EditPartition_Append(val) {
		var xml_GetListDirectory = HNAP.GetXML("GetListDirectory");
		var Directory_Path = xml_GetListDirectory.Get("GetListDirectoryResponse/DirectoryList/ListDirectoryInfo:" + val + "/DirectoryPath");
		var div1 = document.getElementById("FolderTreeView2");
		div1.innerHTML += "<a href=\"javascript:ReturnBack2();\" id=\"rootName2\" style=\"margin: 0 0 0 10px;\"></a>";
		document.getElementById("rootName2").innerHTML = Directory_Path;
		IsOpenFolder = 0;
		GetEditSubFolderList(Directory_Path);
	}

	function Get_SubFolderList(str, mode, band) {
		var GetDefaultSettings = document.getElementById("subfolder_" + str).childNodes[5].innerHTML;
		if (GetDefaultSettings == 0) {
			// ????e?O?_???l???
			var getSubFolder = document.getElementById("subfolder_" + str).childNodes[4].innerHTML;
			if (getSubFolder == "true") {
				document.getElementById("subfolder_" + str).childNodes[5].innerHTML = 1;
				// ???o??e?????
				var getFolder = document.getElementById("subfolder_" + str).childNodes[3].innerHTML;
				var xml_GetListDirectory = HNAP.GetXML("GetListDirectory", new Array("ListDirectoryPath", getFolder));
				// ??List????h?????
				var Directory_ListNumber = xml_GetListDirectory.Get("GetListDirectoryResponse/DirectoryList/ListDirectoryInfo#");
				var List_counter = 1;
				// ?O?_???l???
				var folder_Sub = xml_GetListDirectory.Get("GetListDirectoryResponse/DirectoryList/ListDirectoryInfo:" + List_counter + "/SubDirectory");
				document.getElementById("subfolder_" + str).childNodes[1].childNodes[0].src = "./image/folder_close.png";
				var div1 = document.getElementById("subfolder_" + str);
				for (var i = 0; i < Directory_ListNumber; i ++) {
					var folder_Name = xml_GetListDirectory.Get("GetListDirectoryResponse/DirectoryList/ListDirectoryInfo:" + List_counter + "/DirectoryName");
					var folder_Path = xml_GetListDirectory.Get("GetListDirectoryResponse/DirectoryList/ListDirectoryInfo:" + List_counter + "/DirectoryPath");
					var folder_Sub = xml_GetListDirectory.Get("GetListDirectoryResponse/DirectoryList/ListDirectoryInfo:" + List_counter + "/SubDirectory");
					var default_Setting = 0;
					var re_folder_Name = { trueFolderName: folder_Name };
					var brcount = folder_Path.match(/\//g);
					var tmp = "";
					tmp += "<div id=subfolder_" + counter + ">";
					for (var j = 1; j < brcount.length - 1; j ++)	{	tmp += "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;";	}
					{
						tmp += "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;";
					}
					if (folder_Sub == "true")	{	tmp += "<a href=\"javascript:Get_SubFolderList(" + counter + ", '" + mode + "', '" + band + "');\"><img src=\"image/folder_open.png\" border=\"0\"><a href=\"javascript:Return_Back(" + counter + ", '" + mode + "', '" + band + "');\"></a><label></label><label></label><label></label></div>";	}
					else						{	tmp += "&nbsp;&nbsp;&nbsp;&nbsp;<a href=\"javascript:Get_SubFolderList(" + counter + ", '" + mode + "', '" + band + "');\"><a href=\"javascript:Return_Back(" + counter + ", '" + mode + "', '" + band + "');\"></a><label></label><label></label><label></label></div>";	}
					div1.innerHTML += tmp;
					document.getElementById("subfolder_" + counter).childNodes[2].innerHTML = re_folder_Name.trueFolderName;
					document.getElementById("subfolder_" + counter).childNodes[3].innerHTML = folder_Path;
					document.getElementById("subfolder_" + counter).childNodes[3].style.display = "none";
					document.getElementById("subfolder_" + counter).childNodes[4].innerHTML = folder_Sub;
					document.getElementById("subfolder_" + counter).childNodes[4].style.display = "none";
					document.getElementById("subfolder_" + counter).childNodes[5].innerHTML = default_Setting;
					document.getElementById("subfolder_" + counter).childNodes[5].style.display = "none";
					counter ++;
					List_counter ++;
				}
			}
			else	{	document.getElementById("subfolder_" + str).childNodes[1].childNodes[0].src = "/image/folder_close.png";	}
		}
		else
		{
			var folder_Sub = document.getElementById("subfolder_" + str).childNodes[4].innerHTML;
			var folder_Path = document.getElementById("subfolder_" + str).childNodes[3].innerHTML;
			var getFolder = document.getElementById("subfolder_" + str).childNodes[2].innerHTML;
			var div = document.getElementById("subfolder_" + str);
			var re_folder_Name = { trueFolderName: getFolder };
			var brcount = folder_Path.match(/\//g);
			var tmp = "";
			for (var j = 1; j < brcount.length; j ++)	{	tmp += "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;";	}
			div.innerHTML = tmp + "<a href=\"javascript:Get_SubFolderList(" + str + ", '" + mode + "', '" + band + "');\" id=subfolder_" + str + "><img src=\"image/folder_open.png\" border=\"0\"></a><a href=\"javascript:Return_Back(" + str + ", '" + mode + "', '" + band + "');\"></a><label></label><label></label><label></label></div>";
			var default_Setting = 0;
			document.getElementById("subfolder_" + str).childNodes[2].innerHTML = re_folder_Name.trueFolderName;
			document.getElementById("subfolder_" + str).childNodes[3].innerHTML = folder_Path;
			document.getElementById("subfolder_" + str).childNodes[3].style.display = "none";
			document.getElementById("subfolder_" + str).childNodes[4].innerHTML = folder_Sub;
			document.getElementById("subfolder_" + str).childNodes[4].style.display = "none";
			document.getElementById("subfolder_" + str).childNodes[5].innerHTML = default_Setting;
			document.getElementById("subfolder_" + str).childNodes[5].style.display = "none";
		}
	}
	function GetSubFolderList(linkstr, mode, band)
	{
		if (IsOpenFolder == 0)
		{
			var xml_GetListDirectory = HNAP.GetXML("GetListDirectory", new Array("ListDirectoryPath", linkstr));
			var Directory_ListNumber = xml_GetListDirectory.Get("GetListDirectoryResponse/DirectoryList/ListDirectoryInfo#");
			var div1 = document.getElementById("FolderTreeView");
			var List_counter = 1;
			var default_Setting = 0;
			div1.innerHTML += "<br />";
			for (var i = 0; i < Directory_ListNumber; i ++)
			{
				var folder_Name = xml_GetListDirectory.Get("GetListDirectoryResponse/DirectoryList/ListDirectoryInfo:" + List_counter + "/DirectoryName");
				var folder_Path = xml_GetListDirectory.Get("GetListDirectoryResponse/DirectoryList/ListDirectoryInfo:" + List_counter + "/DirectoryPath");
				var folder_Sub = xml_GetListDirectory.Get("GetListDirectoryResponse/DirectoryList/ListDirectoryInfo:" + List_counter + "/SubDirectory");
				var re_folder_Name = { trueFolderName: folder_Name };
				if (folder_Sub == "true")	{	div1.innerHTML += "<div id=subfolder_" + counter + ">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href=\"javascript:Get_SubFolderList(" + counter + ", '" + mode + "', '" + band + "');\"><img src=\"image/folder_open.png\" border=\"0\"><a href=\"javascript:Return_Back(" + counter + ", '" + mode + "', '" + band + "');\">" + re_folder_Name.trueFolderName + "</a><label></label><label></label><label></label></div>";	}
				else						{	div1.innerHTML += "<div id=subfolder_" + counter + ">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href=\"javascript:Get_SubFolderList(" + counter + ", '" + mode + "', '" + band + "');\"><a href=\"javascript:Return_Back(" + counter + ", '" + mode + "', '" + band + "');\">" + re_folder_Name.trueFolderName + "</a><label></label><label></label><label></label></div>";	}
				document.getElementById("subfolder_" + counter).childNodes[3].innerHTML = folder_Path;
				document.getElementById("subfolder_" + counter).childNodes[3].style.display = "none";
				document.getElementById("subfolder_" + counter).childNodes[4].innerHTML = folder_Sub;
				document.getElementById("subfolder_" + counter).childNodes[4].style.display = "none";
				document.getElementById("subfolder_" + counter).childNodes[5].innerHTML = default_Setting;
				document.getElementById("subfolder_" + counter).childNodes[5].style.display = "none";
				counter ++;
				List_counter ++;
			}
			IsOpenFolder = 1;
		}
	}

	function ReturnBack(mode, band) {
		if (mode == "add") {
			if (band == "SAMBA") {
				document.getElementById("SAMBA_Folder").value = document.getElementById("rootName").innerHTML;
			} else {
				document.getElementById("FTP_Folder").value = document.getElementById("rootName").innerHTML;
			}
			document.getElementById("createPop").style.display = "block";
		} else {
			if (band == "SAMBA") {
				document.getElementById("edit_SAMBA_Folder").value = document.getElementById("rootName").innerHTML;
			} else {
				document.getElementById("edit_FTP_Folder").value = document.getElementById("rootName").innerHTML;
			}
			document.getElementById("editPop").style.display = "block";
		}
		//document.getElementById("shareport_Folder").value = document.getElementById("rootName").innerHTML;
		
		document.getElementById("treeViewPop").style.display = "none";
	}

	function Return_Back(counter, mode, band) {
		if (mode == "add") {
			if (band == "SAMBA") {
				document.getElementById("SAMBA_Folder").value = document.getElementById("subfolder_" + counter).childNodes[3].innerHTML;
			} else {
				document.getElementById("FTP_Folder").value = document.getElementById("subfolder_" + counter).childNodes[3].innerHTML;
			}
		} else {
			if (band == "SAMBA") {
				document.getElementById("edit_SAMBA_Folder").value = document.getElementById("subfolder_" + counter).childNodes[3].innerHTML;
			} else {
				document.getElementById("edit_FTP_Folder").value = document.getElementById("subfolder_" + counter).childNodes[3].innerHTML;
			}
		}
		//document.getElementById("shareport_Folder").value = document.getElementById("subfolder_" + counter).childNodes[3].innerHTML;

		if (mode == "add") {
			document.getElementById("createPop").style.display = "block";
		} else {
			document.getElementById("editPop").style.display = "block";
		}

		document.getElementById("treeViewPop").style.display = "none";
	}

	function ReturnBack2() {
		document.getElementById("edit_Folder").value = document.getElementById("rootName2").innerHTML;
		document.getElementById("editPop").style.display = "block";
		document.getElementById("treeViewPop2").style.display = "none";
	}

	function Return_Back2(counter2) {
		document.getElementById("edit_Folder").value = document.getElementById("subfolder_" + counter2).childNodes[3].innerHTML;
		document.getElementById("editPop").style.display = "block";
		document.getElementById("treeViewPop2").style.display = "none";
	}

	function GetXML() {
		var soapAction = new SOAPAction();
		var userSetting = new SOAPGetUsersSettings();
		userList.length = 0;
		var userSetting_query = soapAction.sendSOAPAction("GetUsersSettings", null, userSetting);
		
		$.when(userSetting_query).done(function(obj) {
			for (var userUnit in userSetting.StorageUsersLists.StorageUser) {
				var user = userSetting.StorageUsersLists.StorageUser[userUnit];
				var userEnabled = user.Enabled;
				var userName = user.UserName;
				var userPassword = user.Password;
				var SAMBA, FTP, VPN, SAMBAFolder, FTPFolder;

				userList.push(userName);
				//add Total_User number
				Total_User += 1;


				for (var serviceInfo in user.ServiceInfoLists.ServiceInfo) {
					var service = user.ServiceInfoLists.ServiceInfo[serviceInfo];
					var serviceEnabled = service.Enabled;
					var serviceName = service.ServiceName;
					var accessPath = service.AccessPath;
					var permission = service.Permission; 

					if (serviceName == "SAMBA") {
						if (serviceEnabled == "true") {
							SAMBA = (permission == "true") ? "2" : "1";
							SAMBAFolder = (accessPath == "/") ? I18N("j","root") : accessPath;
						} else {
							SAMBA = "0";
							SAMBAFolder = "";
						}  
					}

					if (serviceName == "FTP") {
						if (serviceEnabled == "true") {
							FTP = (permission == "true") ? "2" : "1";
							FTPFolder = (accessPath == "/") ? I18N("j","root") : accessPath;
						} else {
							FTP = "0";
							FTPFolder = "";
						}  
					}

					if (serviceName == "VPN") {
						if (serviceEnabled == "true") {
							// VPN = (permission == "true") ? "Enabled" : "Disabled";
							VPN = "Enabled";
						} else {
							VPN = "Disabled";
						}
					}

				}

				// GetHNAPInformatiom("", userName, userPassword, SAMBA, FTP, VPN, userEnabled, SAMBAFolder, FTPFolder);
				// addRowToTable(null);
				addRowToTable(null, "", userName, userPassword, SAMBA, FTP, VPN, userEnabled, SAMBAFolder, FTPFolder);
			}
			check_TotalUser(Limit_TotalUser, Total_User);
		});
				
		document.getElementById("main").style.display = "inline";

		//HNAP.GetXMLAsync("GetMultipleHNAPs", null, "GetXML", function(xml)	{	GetResult_1st(xml)	});	
	}

	function CheckConnectionStatus() {
		$.ajax({
			cache : false,
			url : "./js/CheckConnection",
			timeout : 5000,
			type : "GET",
			success : function(data) { SetXML(); },
			error : function() { document.getElementById("DetectRouterConnection").style.display = "inline"; }
		});
	}
	
	function SetXML() {
		var msg = I18N("j", "Please wait") + " ...";
		PopView.show(msg);

		var tbl = document.getElementById(TABLE_NAME);
		var soapAction = new SOAPAction();
		var macfilterResult = null;
		var userSetting = new SOAPSetUsersSettings();

		if(delUserList.length > 0) {
			for (var j = 0; j < delUserList.length; j++) {
				var delUser = new SOAPDelUserSettings();
				delUser.UserName = delUserList[j];
				soapAction.sendSOAPAction("DelUserSettings", delUser, null);
			}
		}

		for(var i = 1; i <= Total_User; i ++){

			var userEnabled = tbl.rows[i].childNodes[0].childNodes[0].checked;
			var userName = tbl.rows[i].childNodes[1].childNodes[0].innerHTML;
			var SAMBA = tbl.rows[i].childNodes[2].childNodes[0].innerHTML;
			var FTP = tbl.rows[i].childNodes[3].childNodes[0].innerHTML;
			var VPN = tbl.rows[i].childNodes[4].childNodes[0].innerHTML;
			var userPassword = tbl.rows[i].childNodes[8].childNodes[0].innerHTML;
			var SAMBAFolder = tbl.rows[i].childNodes[9].childNodes[0].innerHTML;
			var FTPFolder = tbl.rows[i].childNodes[10].childNodes[0].innerHTML;

			if(i == 1) {  //admin old model problem fix
				SAMBAFolder = "/";
				FTPFolder = "/";
			}

			var storageUser = new SOAPStorageUser();
			storageUser.Enabled = userEnabled;
			storageUser.UserName = userName;
			storageUser.Password = userPassword;
				
			var serviceInfo = new SOAPServiceInfo();
			if (SAMBA == "-") {
				serviceInfo.Enabled = false;
				serviceInfo.ServiceName = "SAMBA";
			} else {
				serviceInfo.Enabled = true;
				serviceInfo.ServiceName = "SAMBA";

				if(SAMBAFolder == I18N("j","root")) {
					SAMBAFolder = "/";
				}

				serviceInfo.AccessPath = SAMBAFolder;
				serviceInfo.Permission = (SAMBA == I18N("j", "Read Only")) ? false : true;
			}
			storageUser.ServiceInfoLists.push(serviceInfo);
				
			var serviceInfo = new SOAPServiceInfo();
			if (FTP == "-") {
				serviceInfo.Enabled = false;
				serviceInfo.ServiceName = "FTP";
			} else {
				serviceInfo.Enabled = true;
				serviceInfo.ServiceName = "FTP";

				if(FTPFolder == I18N("j","root")) {
					FTPFolder = "/";
				}

				serviceInfo.AccessPath = FTPFolder;
				serviceInfo.Permission = (FTP == I18N("j", "Read Only")) ? false : true;
			}
			storageUser.ServiceInfoLists.push(serviceInfo);

			var serviceInfo = new SOAPServiceInfo();
			if (VPN == "-") {
				serviceInfo.Enabled = false;
				serviceInfo.ServiceName = "VPN";
			} else {
				serviceInfo.Enabled = true;
				serviceInfo.ServiceName = "VPN";
			}
			storageUser.ServiceInfoLists.push(serviceInfo);
			userSetting.StorageUsersLists.push(storageUser);
		}

		macfilterResult = soapAction.sendSOAPAction("SetUsersSettings", userSetting, null);
		macfilterResult.done(function(obj){
			if(obj.SetUsersSettingsResult == "OK" || obj.SetUsersSettingsResult == "RESTART") {
				Start_reciprocal_Number_RestoreConfiguration(false);
			} else if(obj.SetUsersSettingsResult == "REBOOT") {
				Start_reciprocal_Number_RestoreConfiguration(true);
			} else {
				window.location.reload();
			}
		});
	}

	function Start_reciprocal_Number_RestoreConfiguration(reboot) {
		var msg = I18N("j", "Please wait") + " ...";
		var msg2 = I18N("j", "The new settings have been saved.");
		var timer = currentDevice.okcount;
		var soapAction = new SOAPAction();

		if(reboot == true) {
			msg = I18N("j", "Your changes are being saved, and the device will need to reboot.");
			timer = currentDevice.rebootcount;
			soapAction.sendSOAPAction("Reboot", null, null);
		}

		PopView.showWithCountdown(msg, timer).always(function() {
			PopView.showConfirm(msg2).done(function() {
				location.reload();
			});
		});
	}	

	function waitSettingFinished() {	window.location.reload();	}
  
	function ChangeBandStatus(mode, band) {
		var status = $("#" + mode + "status_"+band).prop("checked");

		switch(band)
		{
		case 'SAMBA':
        //$("#SAMBA_Permission").attr("disabled", !status);
        if(status)
			$("#" + mode + "SAMBA_Permission").selectbox("enable");
		else
			$("#" + mode + "SAMBA_Permission").selectbox("disable");
        $("#" + mode + "SAMBA_Folder").attr("disabled", !status); 
        $("#" + mode + "searchFolderSAMBA").attr("disabled", !status);        
		break;
			
		case 'FTP':
        //$("#FTP_Permission").attr("disabled", !status);
        if(status)
			$("#" + mode + "FTP_Permission").selectbox("enable");
		else
			$("#" + mode + "FTP_Permission").selectbox("disable");
		$("#" + mode + "FTP_Folder").attr("disabled", !status); 
		$("#" + mode + "searchFolderFTP").attr("disabled", !status);  
		break;

		}
	} 

</script>

<script language="JavaScript">
	// 2013/07/30 Timmy Add
	function focusToFirstIndex(str) {
		if (str.id == "save_buttonFocus")	{	if(window.event.keyCode == 9)	{	document.getElementById("shareport_UserName").focus();	}	}
		if (str.id == "save_buttonFocus2")	{	if(window.event.keyCode == 9)	{	document.getElementById("edit_UserName").focus();		}	}
	}
</script>
<script language="JavaScript">
	// 2013/09/23 Timmy Modify
	$(function() {
		$("select").change(function () {	save_button_changed();	});
		$("input").keydown(function () {	save_button_changed();	});
	});
	
	function save_button_changed() {
		document.getElementById("Save_Disable_btn").style.display = "none";
		document.getElementById("Save_btn").style.display = "block";
		changeFlag = true;
		changeTimeoutAction();
	}
</script>

</head>

<body>
	<div id="wrapper">
		<!-- ------------------ Logo ----------------------- -->
		<div id="header"></div>
		<!-- ------------------ Menu ------------------------->
		<div id="menu"></div>
		<div id="menu_edge"></div>
		<!-- ------------------ Content -------------------- -->
		<div id="content">
			<!-- ------------------ info -------------------- -->	
	  		<div id="info"> 
			    <div id="FunctionName"><script>I18N("h", "User");</script></div>
				<div id="wallimage"><img src="image/page_userDevice.png" alt="" width="195" height="119"/></div>
		        <div id="directions">
					<script>I18N("h", "Use this page to create user accounts to manage access to services provided by the router.");</script>
				</div>
	    	</div>
			<!-- ------------------ funcBar -------------------->
			<div id="funcBar">
				<div id="pagePath">&nbsp;<script>I18N("h", "Management");</script>&nbsp;&gt;&gt;&nbsp;<script>I18N("h", "User");</script></div>
				<ul id="rightFunc">
					<li style="display:block"><div id="Save_btn" onclick="CheckConnectionStatus();changeTimeoutAction();" style="cursor:pointer; display:none"><script>I18N("h", "Save");</script></div></li>
					<li style="display:block"><div id="Save_Disable_btn"><script>I18N("h", "Save");</script></div></li>
					<!--<li style="display:block"><a href="javascript:CheckHTMLStatus('Group');" style="text-decoration:none;" onclick="return confirmExit()"><div id="page_btn" class="linkstyle_1"><script>I18N("h", "Group");</script></div></a></li>-->
				</ul>
			</div>
			<!-- ------------------ main -------------------- -->
			<div id="main" style="display:none">
				<form id="dlquickvpnsettings" action="" method="post">
					<!-- ------------------ table -------------------- -->
					<table class="myTable2" border="0" cellspacing="0" id="tblUserList">
						<thead>
						     <tr>
								<th><script>I18N("h", "Status");</script></th>
								<th><script>I18N("h", "Name");</script></th>
								<th><script>I18N("h", "SAMBA");</script></th>
								<th><script>I18N("h", "FTP");</script></th>
								<th><script>I18N("h", "VPN");</script></th>
								<th><script>I18N("h", "Export VPN Profile (iOS/Mac OS X)");</script></th>
								<th><script>I18N("h", "Edit");</script></th>
								<th><script>I18N("h", "Delete");</script></th>
								<th style="display:none"><script>I18N("h", "Password");</script></th>
								<th style="display:none;"></th>
								<th style="display:none;"></th>
						     </tr>
						</thead>
						<tbody>
						</tbody>
					</table>
				</form>	
				<br /><br />
					<button type="button" name="createButton" id="createButton" class="styled_button_s" onclick="createUserButton()"><script>I18N("h", "Create User");</script></button>
					&nbsp;&nbsp;<script>I18N("h", "Remaining");</script>:&nbsp;<label id="RemainingRules">9</label>
				<br />
				<div id="treeViewPop" style="display:none">
				<div class="dialogBox" style="width:550px;height:400px;">
				<div id="closeCreatePopBtn" onclick="closeTreeViewPOP()" style="cursor:pointer"></div>
					<table class="myCreatePop_table_left" style="width:200px" border="0" cellspacing="0" id="tblTreeView1">
						<tbody>
							<tr>
								<td><div class ="popTitle_s"><script>I18N("h", "Disk Name");</script></div></td>
							</tr>
							<td>
								<div id="partitionView" style="overflow:auto; height:350px; width:175px; text-align:left; margin: 0 0 0 10px; white-space:nowrap;"></div>
							</td>
						</tbody>
					</table>
					<table class="myCreatePop_table_right" style="width:350px" border="0" cellspacing="0" id="tblTreeView2">
						<tbody>
							<tr>
								<td><div class ="popTitle_s"><script>I18N("h", "Select Folder");</script></div></td>
							</tr>
							<td>
							<div id="FolderTreeView" style="overflow:auto; height:350px; width:340px; text-align:left;line-height:25px;border-style:groove; white-space:nowrap;">
								<a href="javascript:ReturnBack();" id="rootName" style="margin: 0 0 0 10px;"></a>
							</div>
							</td>
						</tbody>
					</table>
				</div>
				</div>
				<div id="treeViewPop2" style="display:none">
				<div class="dialogBox" style="width:550px;height:400px;">
				<div id="closeCreatePopBtn" onclick="closeTreeView2POP()" style="cursor:pointer"></div>
					<table class="myCreatePop_table_left" style="width:200px" border="0" cellspacing="0" id="tblTreeView3">
						<tbody>
							<tr>
								<td><div class ="popTitle_s"><script>I18N("h", "Disk Name");</script></div></td>
							</tr>
							<td>
								<div id="partitionView2" style="overflow:auto;height:350px;text-align:left;margin: 0 0 0 10px;"></div>
							</td>
						</tbody>
					</table>
					<table class="myCreatePop_table_right" style="width:350px" border="0" cellspacing="0" id="tblTreeView4">
						<tbody>
							<tr>
								<td><div class ="popTitle_s"><script>I18N("h", "Select Folder");</script></div></td>
							</tr>
							<td>
							<div id="FolderTreeView2" style="overflow:auto; height:350px; width:340px; text-align:left;line-height:25px;border-style:groove;white-space:nowrap;">
								<a href="javascript:ReturnBack2();" id="rootName2" style="margin: 0 0 0 10px;"></a>
							</div>
							</td>
						</tbody>
					</table>
				</div>
				</div>

			</div>
		</div> <!-- id="content" -->

		<!-- Detect Router Connection, Timmy Add 2013/08/15 -->
		<div id="DetectRouterConnection" style="display:none"></div>
		<div id="footer">
			<div id="copyright"><script>I18N("h", "COPYRIGHT");</script></div>
		</div>
	</div>


	<!-- --------------------PopUp--------------------- -->
	<form name="user_c1_form" id="user_c1_form" action="">
		<input id="sumbit_CheckData" class="submit" type="submit" value="Submit" style="display:none" />
		<div id="createPop" style="display:none">
			<div class="dialogBox"  style="width:550px">
				<div id="closeCreatePopBtn" onclick="clearCreateRulePOP()" style="cursor:pointer"></div>
				<table class="myCreatePop_table" border="0" cellspacing="0" id="tblUserList2">
				   <tbody>
						<tr>
							<td colspan="3"><div class ="popTitle"><script>I18N("h", "Create New User");</script></div></td>
						</tr>
						<tr>
							<th><script>I18N("h", "User Name");</script>:</th>
							<td colspan="2"><input class="styled-text required" type="text" name="shareport_UserName" size="27" maxlength="20" id="shareport_UserName" tabindex="1"></td>
						</tr>
						<tr>
							<th><script>I18N("h", "Password");</script>:</th>
							<td colspan="2"><input class="styled-text" type="text" name="shareport_Password" size="27" maxlength="32" id="shareport_Password" tabindex="2"></td>
						</tr>
						<!-- SAMBA -->
						<tr>
							<td colspan="3"><div class ="title" style="margin: 0px 0px 10px 30px;"><script>I18N("h", "SAMBA");</script></div></td>
						</tr>
						<tr>
							<th><script>I18N("h", "Status");</script>:</th>
							<td>
								<input type="checkbox" class="chkbox" id="status_SAMBA" onchange="ChangeBandStatus('','SAMBA')" checked/><label for="status_SAMBA"><span class="chkbox_disabled"><script>I18N("h","Disabled");</script></span><span class="chkbox_enabled"><script>I18N("h","Enabled");</script></span></label>
							</td>
						</tr>
						<tr>
							<th><script>I18N("h", "Permission");</script>:</th>
							<td colspan="2">
								<div class="styled-select">
								<select style="width: 80px" name="SAMBA_PermissionSelect" id="SAMBA_Permission">
									<option value="1">Read Only</option>
									<option value="2">Read/Write</option>
								</select>
								</div>
							</td>
						</tr>
						<tr>
							<th><script>I18N("h", "Folder");</script>:</th>
							<td style="width:150px;">
								<input class="styled-text" type="text" name="SAMBA_Folder" size="27" id="SAMBA_Folder">
							</td>
							<td>
								<button type="button" name="searchFolderSAMBA" id="searchFolderSAMBA" class="styled_button_ss" tabindex="3" onclick="GetDirectoryList('add', 'SAMBA')"><script>I18N("h", "Browse");</script></button>
							</td>
						</tr>
						<!-- FTP -->
						<tr>
							<td colspan="3"><div class ="title" style="margin: 0px 0px 10px 30px;"><script>I18N("h", "FTP");</script></div></td>
						</tr>
						<tr>
							<th><script>I18N("h", "Status");</script>:</th>
							<td>
								<input type="checkbox" class="chkbox" id="status_FTP" onchange="ChangeBandStatus('', 'FTP')"/><label for="status_FTP"><span class="chkbox_disabled"><script>I18N("h","Disabled");</script></span><span class="chkbox_enabled"><script>I18N("h","Enabled");</script></span></label>
							</td>
						</tr>
						<tr>
							<th><script>I18N("h", "Permission");</script>:</th>
							<td colspan="2">
								<div class="styled-select">
									<select style="width: 80px" name="FTP_PermissionSelect" id="FTP_Permission">
										<option value="1">Read Only</option>
										<option value="2">Read/Write</option>
									</select>
								</div>
							</td>
						</tr>
						<tr>
							<th><script>I18N("h", "Folder");</script>:</th>
							<td style="width:150px;">
								<input class="styled-text" type="text" name="FTP_Folder" size="27" id="FTP_Folder" readonly="true">
							</td>
							<td>
								<button type="button" name="searchFolderFTP" id="searchFolderFTP" class="styled_button_ss" tabindex="3" onclick="GetDirectoryList('add','FTP')"><script>I18N("h", "Browse");</script></button>
							</td>
						</tr>
						<!-- VPN -->
						<tr>
							<td colspan="3"><div class ="title" style="margin: 0px 0px 10px 30px;"><script>I18N("h", "VPN");</script></div></td>
						</tr>
						<tr>
							<th><script>I18N("h", "Status");</script>:</th>
							<td>
								<input type="checkbox" class="chkbox" id="status_VPN" onchange="ChangeBandStatus('','VPN')"/><label for="status_VPN"><span class="chkbox_disabled"><script>I18N("h","Disabled");</script></span><span class="chkbox_enabled"><script>I18N("h","Enabled");</script></span></label>
							</td>
						</tr>

						<!-- OK button -->
						<tr>
							<td id="save_td" colspan="3">
									<center><button type="button" class="styled_button_s" id="save_buttonFocus" tabindex="4" onkeyup="focusToFirstIndex(this)" onclick="document.getElementById('sumbit_CheckData').click()"><script>I18N("h", "OK");</script></button></center>
							</td>
						</tr>
					</tbody>
				</table>
			</div>
		</div>
	</form>

	<!-- --------------------PopUp--------------------- -->
	<form name="user_c2_form" id="user_c2_form" action="">
		<input id="sumbit_CheckData2" class="submit" type="submit" value="Submit" style="display:none" />
		<div id="editPop" style="display:none">
			<div class="dialogBox"  style="width:616px">
				<div id="closeCreatePopBtn" onclick="clearEditRulePOP()" style="cursor:pointer"></div>
				<table class="myCreatePop_table" border="0" cellspacing="0" id="tblUserList3">
					<tbody>
						<tr>
							<td colspan="3"><div class ="popTitle"><script>I18N("h", "Edit User Profile");</script></div></td>
						</tr>
						<tr>
							<th><script>I18N("h", "User Name");</script>:</th>
							<td colspan="2"><input class="styled-text required" type="text" name="edit_UserName" size="27" maxlength="20" id="edit_UserName" tabindex="5" onchange="OnChangeUserName(this.value)"></td>
						</tr>
						<tr>
							<th><script>I18N("h", "Password");</script>:</th>
							<td colspan="2"><input class="styled-text" type="text" name="edit_Password" size="27" maxlength="32" id="edit_Password" tabindex="2"></td>
						</tr>
						<!-- SAMBA -->
						<tr>
							<td colspan="3"><div class ="title" style="margin: 0px 0px 10px 30px;"><script>I18N("h", "SAMBA");</script></div></td>
						</tr>
						<tr>
							<th><script>I18N("h", "Status");</script>:</th>
							<td>
								<input type="checkbox" class="chkbox" id="edit_status_SAMBA" onchange="ChangeBandStatus('edit_','SAMBA')"/><label for="edit_status_SAMBA"><span class="chkbox_disabled"><script>I18N("h","Disabled");</script></span><span class="chkbox_enabled"><script>I18N("h","Enabled");</script></span></label>
							</td>
						</tr>
						<tr>
							<th><script>I18N("h", "Permission");</script>:</th>
							<td colspan="2">
								<div class="styled-select">
									<select style="width: 80px" name="edit_SAMBA_PermissionSelect" id="edit_SAMBA_Permission">
										<option value="1">Read Only</option>
										<option value="2">Read/Write</option>
									</select>
								</div>
							</td>
						</tr>
						<tr>
							<th><script>I18N("h", "Folder");</script>:</th>
							<td style="width:150px;">
								<input class="styled-text" type="text" name="edit_SAMBA_Folder" size="27" id="edit_SAMBA_Folder" readonly="true">
							</td>
							<td>
								<button type="button" name="edit_searchFolderSAMBA" id="edit_searchFolderSAMBA" class="styled_button_ss" tabindex="3" onclick="GetDirectoryList('edit', 'SAMBA')"><script>I18N("h", "Browse");</script></button>
							</td>
						</tr>
						<!-- FTP -->
						<tr>
							<td colspan="3"><div class ="title" style="margin: 0px 0px 10px 30px;"><script>I18N("h", "FTP");</script></div></td>
						</tr>
						<tr>
							<th><script>I18N("h", "Status");</script>:</th>
							<td>
								<input type="checkbox" class="chkbox" id="edit_status_FTP" onchange="ChangeBandStatus('edit_','FTP')"/><label for="edit_status_FTP"><span class="chkbox_disabled"><script>I18N("h","Disabled");</script></span><span class="chkbox_enabled"><script>I18N("h","Enabled");</script></span></label>
							</td>
						</tr>
						<tr>
							<th><script>I18N("h", "Permission");</script>:</th>
							<td colspan="2">
								<div class="styled-select">
									<select style="width: 80px" name="edit_FTP_PermissionSelect" id="edit_FTP_Permission">
										<option value="1">Read Only</option>
										<option value="2">Read/Write</option>
									</select>
								</div>
							</td>
						</tr>
						<tr>
							<th><script>I18N("h", "Folder");</script>:</th>
							<td style="width:150px;">
								<input class="styled-text" type="text" name="edit_FTP_Folder" size="27" id="edit_FTP_Folder" readonly="true">
							</td>
							<td>
								<button type="button" name="edit_searchFolderFTP" id="edit_searchFolderFTP" class="styled_button_ss" tabindex="3" onclick="GetDirectoryList('edit', 'FTP')"><script>I18N("h", "Browse");</script></button>
							</td>
						</tr>
						<!-- VPN -->
						<tr>
							<td colspan="3"><div class ="title" style="margin: 0px 0px 10px 30px;"><script>I18N("h", "VPN");</script></div></td>
						</tr>
						<tr>
							<th><script>I18N("h", "Status");</script>:</th>
							<td>
								<input type="checkbox" class="chkbox" id="edit_status_VPN" onchange="ChangeBandStatus('edit_','VPN')"/><label for="edit_status_VPN"><span class="chkbox_disabled"><script>I18N("h","Disabled");</script></span><span class="chkbox_enabled"><script>I18N("h","Enabled");</script></span></label>
							</td>
						</tr>
						<tr>
							<td id="save_td" colspan="3">
								<center><button type="button" class="styled_button_s" id="save_buttonFocus2" tabindex="7" onkeyup="focusToFirstIndex(this)" onclick="document.getElementById('sumbit_CheckData2').click()"><script>I18N("h", "OK");</script></button></center>
							</td>
						</tr>
				   </tbody>
				</table>
			</div>
		</div>	
	</form>

	<!-- popup alert view -->
	<div id="popalert" class="black_overlay" style="display:none">
		<div class="popup_window_border" style="position:relative;top:15%;">
			<div class="popup_window">
				<div id="popalert_circle">
					<img src="image/loading.gif" width="62px" height="62px">
				</div>
				<div id="popalert_countdown">
				</div>
				<div id="popalert_desc">
				</div>
				<div id="popalert_buttons" class="btn-group" role="group" aria-label="...">
					<button type="button" id="popalert_ok" class="btn btn-default">
						<script>I18N("h", "OK");</script>
					</button>
				</div>
			</div>
		</div>
	</div>

<script type="text/javascript" charset="utf-8">
	$(document).ready( function() {
		$.validator.addMethod("checkHEXChar", function( value, element ) {
			var ValidHEXRegex = /^[a-zA-Z0-9_-]+$/;
			var returnVal = true;
			if (ValidHEXRegex.test(value))
			{
				returnVal = true;
			}
			else
			{
				returnVal = false;
			}
			return returnVal;
		}, jQuery.validator.messages.check_IllegalChar);
		
		$("#user_c1_form, #user_c2_form").each(function(index, el)  {
		    $(el).validate({
		    	rules: {
			    	shareport_UserName: {
						required: true,
						checkHEXChar: true
					},
					edit_UserName: {
						required: true,
						checkHEXChar: true
					}
				},
				messages: {
					shareport_UserName: {
					required: jQuery.validator.messages.check_UserName
					},
					edit_UserName: {
					required: jQuery.validator.messages.check_UserName
					}
				},
		        submitHandler: function(form) {
		            if (form.id == "user_c1_form")
		            {
		            	closeCreateUserPOP();
		            }
		            if (form.id == "user_c2_form")
		            {
		            	closeEditUserPOP(set_Iteration);
		            	save_button_changed();
		            }
		        },
		        debug: true
		    });
		});
	});
</script>

<script type="text/javascript">
	Load_HTML();
	Initial();
	setMenu("menu_Management");
	GetXML();
	startTimeout();
</script>
</body>
</html> 
