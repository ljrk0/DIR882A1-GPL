/* svn info: $Revision: 1418 $ $Date: 2019-04-25 17:36:15 +0800 (Thu, 25 Apr 2019) $ */
define([],function(){function p(e){var t=$.Deferred(),n=new SOAPSetSetupWizardStatus;return n.Enabled=e,n.Duration=e?"180":"0",(new SOAPAction).sendSOAPAction("SetSetupWizardStatus",n,null).done(function(e){t.resolve()}).fail(function(){t.reject()}),t.promise()}function D(e,t){var n=new SOAPSetWLanRadioSettings,i=getWiFiData(t.wifi_datalist,e);switch(e){case"24":n.RadioID="RADIO_2.4GHz",n.Mode="802.11bgn",n.Coexistence=!0;var a=0,o=0;break;case"5":n.RadioID="RADIO_5GHz",n.Mode="802.11anac",n.Coexistence=i.setting.Coexistence;a=currentDevice.featureWizardHNAPChannelWidth,o=function(e,t){var n=!1,i=!1,a="";switch(e){case"24":a="RADIO_2.4GHz";break;case"5":a="RADIO_5GHz";break;case"52":a="RADIO_5GHz_2"}for(var o in t.RadioInfos.RadioInfo){var r=t.RadioInfos.RadioInfo[o];if(r.RadioID==a){for(var s in r.Channels){var d=r.Channels[s];"0"==d&&(n=!0),"999"==d&&(i=!0)}break}}return 0==n&&1==i?"999":"0"}(e,t)}return n.Enabled=!0,n.SSID=XMLEncode(t.apSSID),n.ChannelWidth=a,n.Channel=o,n.SSIDBroadcast=!0,n.QoS=i.setting.QoS,n.ScheduleName=i.setting.ScheduleName,n.TXPower=i.setting.TXPower,n.MUMIMOEnabled=i.setting.MUMIMOEnabled,n.BandSteeringEnabled=i.setting.BandSteeringEnabled,n.AirTimeFairnessEnabled=i.setting.AirTimeFairnessEnabled,n}function P(e,t){var n=new SOAPSetWLanRadioSecurity;switch(e){case"24":n.RadioID="RADIO_2.4GHz";break;case"5":n.RadioID="RADIO_5GHz"}return 0==t.apPWD.length?(n.Enabled=!1,n.Type="NONE",n.Encryption="NONE"):(n.Enabled=!0,n.Type="WPAORWPA2-PSK",n.Encryption="TKIPORAES"),n.Key=t.apPWD,n.KeyRenewal=3600,n}return{WizDeviceInfo:function(){this.opMode="",this.apcSSID="",this.apcPWD="",this.apSSID="",this.apPWD="",this.password="",this.changePassword=!1,this.deviceSettings=null,this.apcSettings=null,this.wifi_datalist=new Array,this.uplink="",this.hasInternet=!1,this.availableOPMode=null,this.LanMacAddress="",this.wps=!1,this.ianaTimeZone="",this.autoUpgradeSetting=!0,this.RadioInfos=""},setWizardStatus:p,getWizDeviceInfo:function(t){var e=$.Deferred(),n=getOPmode().then(function(e){t.availableOPMode=e.OperationModeList.OperationModeInfo[0].AvailableOPMode});t.wifi_datalist=[];var a,o,i,r,s,d=(a=t,o=$.Deferred(),i=new SOAPAction,r=new SOAPGetWLanRadiosResponse,i.sendSOAPAction("GetWLanRadios",null,r).done(function(e){a.RadioInfos=e.RadioInfos;for(var n=r.RadioInfos.RadioInfo.length,i=0,t=0;t<n;t++)!function(e){var t=r.RadioInfos.RadioInfo[e];get_wireless(t.RadioID).then(function(e){"RADIO_2.4GHz"==t.RadioID&&(a.apSSID=e.setting.SSID,a.apPWD=e.security.Key),a.wifi_datalist.push(e),n==++i&&o.resolve()})}(t)}).fail(function(){o.reject()}),o.promise()),l=getUplinkInterface().then(function(e){t.uplink=e.UplinkInterface,t.hasInternet=COMM_ToBOOL(e.NetworkLayerStatus)}),S=(s=$.Deferred(),(new SOAPAction).sendSOAPAction("GetDeviceSettings",null,getDeviceSettings).done(function(e){s.resolve(e)}).fail(function(){s.reject()}),s.promise()).then(function(e){t.deviceSettings=e}),c=new SOAPGetAPLanSettingsResponse,u=(new SOAPAction).sendSOAPAction("GetAPLanSettings",null,c).done(function(e){t.DeviceName=e.DeviceName,t.LanMacAddress=e.MacAddress});return $.when(n,d,l,S,u).always(function(){e.resolve(t)}),e.promise()},storeWizDeviceInfo:function(e){var t,n,i,a,o,r,s=$.Deferred(),d=new SOAPAction;if(0==e.wps&&0==e.hasInternet){for(var l in RadioIDList){var S=RadioIDList[l];t=createOPmode(S,e.opMode),d.SetMultipleSOAP("SetOperationMode",t,null)}"WirelessAp"!=e.opMode&&(t=createAPCSettings(e.apcSSID,e.apcPWD),d.SetMultipleSOAP("SetAPClientSettings",t,null))}setSmartConnectStatus(d,!0);for(var c=0;c<e.wifi_datalist.length;c++){var u=e.wifi_datalist[c].band;t=D(u,e),d.SetMultipleSOAP("SetWLanRadioSettings",t,null),n=P(u,e),d.SetMultipleSOAP("SetWLanRadioSecurity",n,null)}if(i=d,a=e,o=new SOAPSetDeviceSettings,r=a.deviceSettings,o.DeviceName=r.DeviceName,o.PresentationURL=r.PresentationURL,o.AdminPassword=a.password,o.ChangePassword=!0,o.CAPTCHA=r.CAPTCHA,currentDevice.featureNewTime&&(o.TZLocation=a.ianaTimeZone),i.SetMultipleSOAP("SetDeviceSettings",o,null),currentDevice.featureAutoUpgrade){var A=new SOAPSetEventNotification,f=new SOAPSetFirmwareAutoUpdate;A.Enabled=e.autoUpgradeSetting,A.AutoFirmwareUpgrade=e.autoUpgradeSetting,f.AutoDownload=e.autoUpgradeSetting,f.AutoUpdate=e.autoUpgradeSetting,delete f.TimeToUpdate.TimeHourValue,delete f.TimeToUpdate.TimeMinuteValue,delete f.TimeToUpdate.TimeMidDateValue,d.SetMultipleSOAP("SetEventNotification",A,null),d.SetMultipleSOAP("SetFirmwareAutoUpdate",f,null)}return p(!1).then(function(){return d.SendMultipleSOAPAction("SetMultipleActions")}).done(function(){s.resolve()}).fail(function(){s.reject()}),s.promise()}}});