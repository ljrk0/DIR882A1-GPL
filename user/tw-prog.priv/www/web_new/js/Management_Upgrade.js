/* svn info: $Revision: 1272 $ $Date: 2019-01-28 17:51:50 +0800 (Mon, 28 Jan 2019) $ */
top!=self&&(top.location=self.location),null===sessionStorage.getItem("PrivateKey")&&window.location.replace("../info/Login.html"),$(function(){pageFn.Initial(),1==currentDevice.featureSingleUpdateForMultiFirmware?($("#singleFW_text").hide(),$("#singleFirmwareTableMessage_checkNewFirmwareBtn").show(),$("#singleFW_currentVersion").html(sessionStorage.currentFWVersion),singleFirmwareFn.BtnChange(),$("#autoFirmwareTable").hide(),$("#autoFirmwareTableMessage").hide()):$("#singleFirmwareTable").hide(),currentDevice.featureEnableOnlineUpgrade?($("#firmware_onlineUpgrade").show(),$("#adButton").show()):($("#advancedBlock").show(),$("#advanceBlock_hr").hide()),currentDevice.featureAutoUpgrade?($("#rightFunc").show(),$("#AutoFirmwareUpgrade").show(),$("#AutoFirmwareUpgrade_hr").show(),pageFn.GetAutoUpgradeSettings().then(function(){$("#AutoFirmwareUpgrade > table").show(),pageFn.GetXML()})):pageFn.GetXML(),pageFn.BtnChange(),$("#autoUpgrade_form").validate({submitHandler:function(e){return pageFn.CheckConnectionStatus(),!1}})});var datalist=new Datalist,datalistPolling=new Array;function Datalist(){this.list=new Array,this.maxrowid=0}function Data(e,t,a,r){this.rowid=0,this.Type=e,this.MacAddress=t,this.DeviceName=a,this.CurrentFWVersion=r,this.LatestFWVersion="",this.FirmwareStatus=""}function DataPolling(e,t){this.MacAddress=e,this.DeviceName=t,this.Percentage=0}Datalist.prototype.getRowId=function(e){var t=0;for(t=0;t<this.list.length&&e!=this.list[t].rowid;t++);return t},Data.prototype={setRowid:function(e){this.rowid=e},addRowToTable:function(e){var t;t='<tr id="tr'+this.rowid+'"></tr>',$("#"+e+"> tbody").append(t),this.setDataToRow($("#tr"+this.rowid))},setDataToRow:function(e){var t;""==this.DeviceName&&(this.DeviceName="Unknown");var a=I18N("j","Extenders");currentDevice.featureCovrBundle&&(a=I18N("j","COVR Points")),t=0==this.rowid?'<td class="autoFirmware_td1">'+I18N("j","Master")+"</td>":1==this.rowid?'<td class="autoFirmware_td1">'+a+"</td>":'<td class="autoFirmware_td1"></td>',t+='<td class="autoFirmware_td2">'+HTMLEncode(decode_char_text(this.DeviceName))+"&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;</td>",t+='<td class="autoFirmware_td3"></td>',e.html(t)},setFirmware:function(e){$("#tr"+this.rowid+" td").eq(2).html(e)}};var pageFn={updateUpgradeTime:0,count:80,getxmlValue_DeviceName:"",SOAP_NAMESPACE:"http://purenetworks.com/HNAP1/",currentFile:"",Initial:function(){$("#header").load("header.html"),currentDevice.featureRequireLevel?"1"!=sessionStorage.getItem("FirmwareRequireLevel")&&initialMenu():initialMenu(),initialDetectRouterConnection(),currentDevice.featureRequireLevel?"1"!=sessionStorage.getItem("FirmwareRequireLevel")&&setMenu("menu_Management"):setMenu("menu_Management"),startTimeout()},CheckConnectionStatus:function(){var t=this;$.ajax({cache:!1,url:"./js/CheckConnection",timeout:2e3,type:"GET",success:function(e){t.SetAutoUpgradeSettings()},error:function(){document.getElementById("DetectRouterConnection").style.display="inline"}})},SetAutoUpgradeSettings:function(){var n=I18N("j","Please wait")+" ...";PopView.show(n);var e=new SOAPAction,t=new SOAPSetFirmwareAutoUpdate,a=new SOAPSetEventNotification,r=$("#status_AutoUpgrade").prop("checked");a.Enabled=r,a.AutoFirmwareUpgrade=r,$("#status_PreferUpgradeTime").prop("checked")?(t.TimeToUpdate.TimeHourValue=$("#UpgradeTimeHour").val(),t.TimeToUpdate.TimeMinuteValue=$("#UpgradeTimeMinute").val()):(delete t.TimeToUpdate.TimeHourValue,delete t.TimeToUpdate.TimeMinuteValue,delete t.TimeToUpdate.TimeMidDateValue),t.AutoDownload=r,t.AutoUpdate=r,e.SetMultipleSOAP("SetEventNotification",a,null),e.SetMultipleSOAP("SetFirmwareAutoUpdate",t,null),e.SendMultipleSOAPAction("SetMultipleActions").done(function(e,t,a){var r=currentDevice.okcount;""!=a&&(r=a);var i=I18N("j","The new settings have been saved.");PopView.showWithCountdown(n,r).always(function(){PopView.showConfirm(i).done(function(){window.location.reload()})})}).fail(function(){window.location.reload()})},GetAutoUpgradeSettings:function(){var s=this,l=$.Deferred(),e=new SOAPAction,d=new SOAPGetFirmwareAutoUpdateResponse;return e.sendSOAPAction("GetFirmwareAutoUpdate",null,d).done(function(){$("select").selectbox("detach");for(var e=document.getElementById("UpgradeTimeHour"),t=document.getElementById("UpgradeTimeMinute"),a=0;a<=23;a++){var r=a;a<12?(0==a&&(r=12),e.options.add(new Option(r+" AM",a))):(r=a-12==0?a:a-12,e.options.add(new Option(r+" PM",a)))}for(a=0;a<=59;a++)a<10?t.options.add(new Option("0"+a,a)):t.options.add(new Option(a,a));var i=d.TimeToUpdate.TimeHourValue,n=d.TimeToUpdate.TimeMinuteValue,o=d.AutoUpdate;e.value=""!=i?i:"3",t.value=""!=n?n:"30",$("select").selectbox({width:100}),$("select").selectbox("attach"),""==i||""==n?($("#UpgradeTimeHour").selectbox("disable"),$("#UpgradeTimeMinute").selectbox("disable")):$("#status_PreferUpgradeTime").prop("checked","true"),"true"==o?($("#status_AutoUpgrade").prop("checked",!0),$("#upgradeTimeTr").show()):($("#status_AutoUpgrade").prop("checked",!1),$("#upgradeTimeTr").hide()),s.changeAutoUpgradeMSG(o),l.resolve()}).fail(function(){l.reject()}),l.promise()},GetXML:function(){var s=this,n=new SOAPGetClientInfoResponse,e=new SOAPAction,a=new SOAPGetDeviceSettingsResponse,r=new SOAPAction;$("#autoFirmwareTableMessage tr").hide(),$("#autoFirmwareTableMessage_text").show(),$("#autoFirmwareTableMessage_text td span").html(I18N("j","Please wait")+"..."),$("#manualFirmwareTable tr").hide(),$("#manualFirmwareTable_text").show(),$("#manualFirmwareTable_text td span").html(I18N("j","Please wait")+"..."),$("#autoFirmwareTable > tbody").html(""),datalist.list=[],datalist.maxrowid=0;e.sendSOAPAction("GetDeviceSettings",null,a).then(function(){var e=$.Deferred(),t=new Data(a.Type,"Master",a.DeviceName,a.FirmwareVersion);return t.setRowid(datalist.maxrowid),t.addRowToTable("autoFirmwareTable"),datalist.list.push(t),datalist.maxrowid++,s.getxmlValue_DeviceName=a.DeviceName,$("#manualFirmwareTable_seletDeviceSeletbox").selectbox("detach"),$("#manualFirmwareTable_seletDeviceSeletbox").html(""),$("#manualFirmwareTable_seletDeviceSeletbox").selectbox("attach"),$("#manualFirmwareTable_seletDeviceSeletbox").append('<option value="'+a.DeviceName+'" selected data-mac="Master">'+a.DeviceName+" (Master)</option>"),r.sendSOAPAction("GetClientInfo",null,n).done(function(){e.resolve()}).fail(function(){e.reject()}),e.promise()},function(){var e=$.Deferred();$("#autoFirmwareTableMessage tr").hide(),$("#autoFirmwareTableMessage_text").show(),$("#autoFirmwareTableMessage_text td span").html(I18N("j","Please wait")+"..."),$("#manualFirmwareTable tr").hide(),$("#manualFirmwareTable_text").show(),$("#manualFirmwareTable_text td span").html(I18N("j","Please wait")+"...");var t=new Data("none","Master","Covr","N/A");return t.setRowid(datalist.maxrowid),t.addRowToTable("autoFirmwareTable"),datalist.list.push(t),datalist.maxrowid++,s.getxmlValue_DeviceName="Covr",$("#manualFirmwareTable_seletDeviceSeletbox").selectbox("detach"),$("#manualFirmwareTable_seletDeviceSeletbox").html(""),$("#manualFirmwareTable_seletDeviceSeletbox").selectbox("attach"),$("#manualFirmwareTable_seletDeviceSeletbox").append('<option value="'+s.getxmlValue_DeviceName+'" selected data-mac="Master">'+s.getxmlValue_DeviceName+" (Master)</option>"),r.sendSOAPAction("GetClientInfo",null,n).done(function(){e.resolve()}).fail(function(){e.reject()}),e.promise()}).then(function(e){var t,a,r=$.Deferred();for(var i in n.ClientInfoLists.ClientInfo)"WiFi_2.4G_MeshExtender"==n.ClientInfoLists.ClientInfo[i].Type&&(t=i,a=void 0,(a=new Data(n.ClientInfoLists.ClientInfo[t].Type,n.ClientInfoLists.ClientInfo[t].MacAddress,n.ClientInfoLists.ClientInfo[t].NickName)).setRowid(datalist.maxrowid),a.addRowToTable("autoFirmwareTable"),datalist.list.push(a),datalist.maxrowid++,""==n.ClientInfoLists.ClientInfo[t].NickName&&(n.ClientInfoLists.ClientInfo[t].NickName="Unknown "),$("#manualFirmwareTable_seletDeviceSeletbox").append('<option value="'+n.ClientInfoLists.ClientInfo[t].MacAddress+'" data-mac="'+n.ClientInfoLists.ClientInfo[t].MacAddress+'">'+decode_char_text(n.ClientInfoLists.ClientInfo[t].NickName)+" ("+n.ClientInfoLists.ClientInfo[t].MacAddress.toUpperCase()+")</option>"));return setTimeout(function(){r.resolve()},1e3),r.promise()},function(){var e=$.Deferred();return $("#autoFirmwareTableMessage tr").hide(),$("#autoFirmwareTableMessage_text").show(),$("#autoFirmwareTableMessage_text td span").html(I18N("j","Please wait")+"..."),$("#manualFirmwareTable tr").hide(),$("#manualFirmwareTable_text").show(),$("#manualFirmwareTable_text td span").html(I18N("j","Please wait")+"..."),e.resolve(),e.promise()}).then(function(){var i=new Array,n=[],o=0;for(var e in datalist.list)""!=datalist.list[e].MacAddress?"Master"==datalist.list[e].MacAddress?function(e){i[e]="",n[e]="";var t=datalist.list[e].rowid,a=datalist.list[e].CurrentFWVersion;$("#tr"+t).find("td").eq(1).html($("#tr"+t).find("td").eq(1).html()+"&nbsp;&nbsp;"+I18N("j","Firmware Version")+":&nbsp;"+a),o++}(e):function(t){var e=new SOAPAction2,a=datalist.list[t].rowid,r=[datalist.list[t].MacAddress];i[t]=new SOAPGetDeviceSettingsResponse,n[t]=e.sendSOAPAction("GetDeviceSettings",null,i[t],r).done(function(e){datalist.list[t].CurrentFWVersion=e.FirmwareVersion,$("#tr"+a).find("td").eq(1).html($("#tr"+a).find("td").eq(1).html()+"&nbsp;&nbsp;"+I18N("j","Firmware Version")+":&nbsp;"+e.FirmwareVersion),o++}).fail(function(){null!=i&&null!=n&&(datalist.list[t].CurrentFWVersion="N/A",$("#tr"+a).find("td").eq(1).html($("#tr"+a).find("td").eq(1).html()+"&nbsp;&nbsp;"+I18N("j","Firmware Version")+":&nbsp;N/A"),o++)})}(e):o++;var a=setInterval(function(){o==datalist.list.length&&($("#manualFirmwareTable_seletDeviceSeletbox").selectbox("detach"),$("#manualFirmwareTable_seletDeviceSeletbox").val(s.getxmlValue_DeviceName),$("#manualFirmwareTable_seletDeviceSeletbox").selectbox({width:350}),$("#manualFirmwareTable_seletDeviceSeletbox").selectbox("attach"),$("#autoFirmwareTableMessage tr").hide(),$("#autoFirmwareTableMessage_text").hide(),$("#autoFirmwareTableMessage_checkNewFirmware").show(),$("#autoFirmwareTableMessage_checkNewFirmwareBtn").attr("disabled",!1),$("#manualFirmwareTable tr").hide(),$("#manualFirmwareTable_text").hide(),$("#manualFirmwareTable_selectDevice").show(),$("#manualFirmwareTable2").show(),$("#manualFirmwareTable2 tr").hide(),$("#manualFirmwareTable2_selectFile").show(),clearInterval(a),a=null,clearTimeout(r),n=i=r=null)},1e3),r=setTimeout(function(){if(null!=a){for(var e in clearInterval(a),a=null,clearTimeout(r),n=i=r=null,datalist.list){var t=datalist.list[e].rowid;""==datalist.list[e].CurrentFWVersion&&(datalist.list[e].CurrentFWVersion="N/A",$("#tr"+t).find("td").eq(1).html($("#tr"+t).find("td").eq(1).html()+"&nbsp;&nbsp;"+I18N("j","Firmware Version")+":&nbsp;N/A"))}$("#manualFirmwareTable_seletDeviceSeletbox").selectbox("detach"),$("#manualFirmwareTable_seletDeviceSeletbox").val(s.getxmlValue_DeviceName),$("#manualFirmwareTable_seletDeviceSeletbox").selectbox({width:350}),$("#manualFirmwareTable_seletDeviceSeletbox").selectbox("attach"),$("#autoFirmwareTableMessage tr").hide(),$("#autoFirmwareTableMessage_text").hide(),$("#autoFirmwareTableMessage_checkNewFirmware").show(),$("#autoFirmwareTableMessage_checkNewFirmwareBtn").attr("disabled",!1),$("#manualFirmwareTable tr").hide(),$("#manualFirmwareTable_text").hide(),$("#manualFirmwareTable_selectDevice").show(),$("#manualFirmwareTable2").show(),$("#manualFirmwareTable2 tr").hide(),$("#manualFirmwareTable2_selectFile").show()}},12e4)})},GetXML2_1:function(){var t=this;$("#autoFirmwareTableMessage tr").hide(),$("#autoFirmwareTableMessage_text").show(),$("#autoFirmwareTableMessage_text td span").html(I18N("j","Please wait")+"..."),$("#autoFirmwareTableMessage_checkNewFirmware").show(),$("#autoFirmwareTableMessage_checkNewFirmwareBtn").attr("disabled",!0);var e=new SOAPGetWanStatusResponse;(new SOAPAction).sendSOAPAction("GetWanStatus",null,e).done(function(e){"CONNECTED"==e.Status?t.GetXML2_2():($("#autoFirmwareTableMessage tr").hide(),$("#autoFirmwareTableMessage_text").show(),$("#autoFirmwareTableMessage_text td span").html(I18N("j","Internet Disconnected")),$("#autoFirmwareTableMessage_checkNewFirmware").show(),$("#autoFirmwareTableMessage_checkNewFirmwareBtn").attr("disabled",!1))}).fail(function(){$("#autoFirmwareTableMessage tr").hide(),$("#autoFirmwareTableMessage_text").show(),$("#autoFirmwareTableMessage_text td span").html(I18N("j","Internet Disconnected")),$("#autoFirmwareTableMessage_checkNewFirmware").show(),$("#autoFirmwareTableMessage_checkNewFirmwareBtn").attr("disabled",!1)})},GetXML2_2:function(){var i=new Array,n=[],o=0;for(var e in $("#autoFirmwareTableMessage tr").hide(),$("#autoFirmwareTableMessage_text").show(),$("#autoFirmwareTableMessage_text td span").html(I18N("j","Please wait")+"..."),$("#autoFirmwareTableMessage_checkNewFirmware").show(),$("#autoFirmwareTableMessage_checkNewFirmwareBtn").attr("disabled",!0),datalist.list)""!=datalist.list[e].MacAddress?"Master"==datalist.list[e].MacAddress?function(t){var e=new SOAPAction,a=datalist.list[t].rowid;i[t]=new SOAPGetFirmwareStatusResponse,n[t]=e.sendSOAPAction("GetFirmwareStatus",null,i[t]).done(function(e){datalist.list[t].LatestFWVersion=e.LatestFWVersion,$("#tr"+a).find("td").eq(2).html(I18N("j","New Firmware Version")+":&nbsp;"+e.LatestFWVersion),o++}).fail(function(){datalist.list[t].LatestFWVersion="unknown",$("#tr"+a).find("td").eq(2).html("&nbsp;"),o++})}(e):function(t){var e=new SOAPAction2,a=datalist.list[t].rowid,r=[datalist.list[t].MacAddress];i[t]=new SOAPGetFirmwareStatusResponse,n[t]=e.sendSOAPAction("GetFirmwareStatus",null,i[t],r).done(function(e){datalist.list[t].LatestFWVersion=e.LatestFWVersion,$("#tr"+a).find("td").eq(2).html(I18N("j","New Firmware Version")+":&nbsp;"+e.LatestFWVersion),o++}).fail(function(){datalist.list[t].LatestFWVersion="unknown",$("#tr"+a).find("td").eq(2).html("&nbsp;"),o++})}(e):o++;var a=setInterval(function(){if(o==datalist.list.length){var e=0;for(var t in datalist.list)"N/A"==datalist.list[t].CurrentFWVersion?datalist.list[t].FirmwareStatus="unknown":0<=parseFloat(datalist.list[t].CurrentFWVersion)-parseFloat(datalist.list[t].LatestFWVersion)?datalist.list[t].FirmwareStatus="new":parseFloat(datalist.list[t].CurrentFWVersion)-parseFloat(datalist.list[t].LatestFWVersion)<0?(datalist.list[t].FirmwareStatus="upgrade",e++):datalist.list[t].FirmwareStatus="fail";$("#autoFirmwareTableMessage tr").hide(),0==e?($("#autoFirmwareTableMessage tr").hide(),$("#autoFirmwareTableMessage_text").show(),$("#autoFirmwareTableMessage_text td span").html(I18N("j","This firmware is the latest version."))):($("#autoFirmwareTableMessage tr").hide(),$("#autoFirmwareTableMessage_upgradeFirmware").show(),$("#autoFirmwareTableMessage_upgradeFirmwareBtn").attr("disabled",!1)),clearInterval(a),a=null,clearTimeout(r),n=i=r=null}},1e3),r=setTimeout(function(){if(null!=a){clearInterval(a),a=null,clearTimeout(r),n=i=r=null;var e=0;for(var t in datalist.list)"N/A"==datalist.list[t].CurrentFWVersion?datalist.list[t].FirmwareStatus="unknown":0<=parseFloat(datalist.list[t].CurrentFWVersion)-parseFloat(datalist.list[t].LatestFWVersion)?datalist.list[t].FirmwareStatus="new":parseFloat(datalist.list[t].CurrentFWVersion)-parseFloat(datalist.list[t].LatestFWVersion)<0?(datalist.list[t].FirmwareStatus="upgrade",e++):datalist.list[t].FirmwareStatus="fail";$("#autoFirmwareTableMessage tr").hide(),0==e?($("#autoFirmwareTableMessage tr").hide(),$("#autoFirmwareTableMessage_text").show(),$("#autoFirmwareTableMessage_text td span").html(I18N("j","This firmware is the latest version."))):($("#autoFirmwareTableMessage tr").hide(),$("#autoFirmwareTableMessage_upgradeFirmware").show(),$("#autoFirmwareTableMessage_upgradeFirmwareBtn").attr("disabled",!1))}},12e4)},BtnChange:function(){var i=this;$("input").on("click",function(){changeTimeoutAction()}),$("button").on("click",function(){changeTimeoutAction()}),$("#autoFirmwareTableMessage_checkNewFirmwareBtn").on("click",function(){i.GetXML2_1()}),$("#autoFirmwareTableMessage_upgradeFirmwareBtn").on("click",function(){stopTimeout(),i.AutoUpgradeFirmware()}),$("#manualFirmwareTable_seletDeviceSeletbox").on("change",function(){"Master"==$("#manualFirmwareTable_seletDeviceSeletbox option:selected").attr("data-mac")?($("#manualFirmwareTable2").show(),$("#manualFirmwareTable2_selectFile").show(),$("#manualFirmwareTable_goDevice").hide()):($("#manualFirmwareTable2").hide(),$("#manualFirmwareTable_goDevice").show())}),$("#manualFirmwareTable_goDeviceBtn").on("click",function(){var e=$("#manualFirmwareTable_seletDeviceSeletbox option:selected").attr("data-mac").split(":"),t="http://dlinkap"+(e[4]+e[5])+".local./info/Login_Simple.html";i.manual_openWindow(t,"D-Link",640,420)}),$("#manualFirmwareTable2_selectFileBtn").on("click",function(){var e=$.client.browser;$.client.version;"Explorer"==e&&$.client.version<10?alert(I18N("j","The system doesn't support your browser.")):$("#uploadfile").trigger("click")}),$("input[type=file]").on("change",function(e){var t=i.manual_prepareUpload(e);i.manual_ShowUpgradeBtn(t)}),$("#status_AutoUpgrade").on("click",function(){var e=$("#UpgradeTimeHour"),t=$("#UpgradeTimeMinute"),a=$(this).prop("checked"),r=$("#upgradeTimeTr");a?r.show():(r.hide(),$("#status_PreferUpgradeTime").prop("checked",!1),e.selectbox("disable"),t.selectbox("disable")),i.changeAutoUpgradeMSG(a),$("#Save_Disable_btn").hide(),$("#Save_btn").show(),changeFlag=!0,changeTimeoutAction()}),$("#UpgradeTimeHour, #UpgradeTimeMinute").on("change",function(){$("#Save_Disable_btn").hide(),$("#Save_btn").show(),changeFlag=!0,changeTimeoutAction(),i.updateUpgradeTime=1}),$("#status_PreferUpgradeTime").on("click",function(){$("#Save_Disable_btn").hide(),$("#Save_btn").show();var e=$(this).prop("checked"),t=$("#UpgradeTimeHour"),a=$("#UpgradeTimeMinute");e?(t.selectbox("enable"),a.selectbox("enable")):(t.selectbox("disable"),a.selectbox("disable")),changeFlag=!0,changeTimeoutAction()})},AutoUpgradeFirmware:function(){var e=this;$("#autoFirmwareTableMessage tr").hide(),$("#autoFirmwareTableMessage_upgradeFirmware").show(),$("#autoFirmwareTableMessage_upgradeFirmwareBtn").attr("disabled",!0),PopView.show(I18N("j","Please wait")+"..."),e.StartFirmwareDownload().progress(function(e){}).done(function(){setTimeout(function(){$("#popalert>.popup_window_border").css({width:280,height:280,margin:"0 auto",marginBottom:0}),$("#popalert").css({overflow:"hidden"}),$("body").css({overflow:"auto"}),$(".black_overlay").css({height:"200%"}),$("#progressBlock").remove(),e.do_upgrade()},3e3)}).fail(function(){setTimeout(function(){$("#popalert>.popup_window_border").css({width:280,height:280,margin:"0 auto",marginBottom:0}),$("#popalert").css({overflow:"hidden"}),$("body").css({overflow:"auto"}),$(".black_overlay").css({height:"200%"}),$("#progressBlock").remove();var e=I18N("j","Firmware Upgrade failed!");PopView.showConfirm(e).done(function(){location.reload()})},3e3)})},StartFirmwareDownload:function(){var i=this,n=$.Deferred();return(new SOAPAction).sendSOAPAction("StartFirmwareDownload",null,null).done(function(e){if("OK"==e.StartFirmwareDownloadResult||"RESTART"==e.StartFirmwareDownloadResult){for(var t=0;t<datalist.list.length;t++)if("Master"==datalist.list[t].MacAddress){var a=new DataPolling(datalist.list[t].MacAddress,datalist.list[t].DeviceName);datalistPolling.push(a);break}for(t=0;t<datalist.list.length;t++)if("upgrade"==datalist.list[t].FirmwareStatus&&"Master"!=datalist.list[t].MacAddress){a=new DataPolling(datalist.list[t].MacAddress,datalist.list[t].DeviceName);datalistPolling.push(a)}PopView.showCleanUI(),$(".cleanUI").append('<div id="progressBlock" style="width:100%;height:100%;"><p style="font-size:15px;margin: 50px 100px;text-align:center;">'+I18N("j","Please do not close the browser while the firmware is being downloaded!")+'</p><table id="pollingFirmwareTable"></table></div>'),$("#popalert>.popup_window_border").css({width:630,height:"auto",margin:"0 auto",marginBottom:60}),$("#popalert").css({overflow:"auto"}),$("body").css({overflow:"hidden"}),$(".black_overlay").css({height:"100%"});var r="";for(t=0;t<datalistPolling.length;t++)r+='<tr class="pollingProgress'+t+'"><td class="td1">',"Master"==datalistPolling[t].MacAddress?r+="<p>"+I18N("j","Master")+"</p>":1==t&&(currentDevice.featureCovrBundle?r+="<p>"+I18N("j","COVR Points")+"</p>":r+="<p>"+I18N("j","Extender")+"</p>"),r+='</td><td class="td2"><p>'+datalistPolling[t].DeviceName+'</p></td><td class="td3"><div class="progressbar"><p class="progressbar_bg">&nbsp;</p><p class="progressbar_text">0%</p></div></td></tr>';$("#pollingFirmwareTable").append(r),i.GetPollingFirmwareDownloadStatus().progress(function(){n.notify()}).done(function(){n.resolve()}).fail(function(){n.reject()})}else n.reject()}).fail(function(){n.reject()}),n.promise()},GetPollingFirmwareDownloadStatus:function(){var o=this,s=$.Deferred(),l=null,d=null;return l=setInterval(function(){var e={},t='"'+o.SOAP_NAMESPACE+'PollingFirmwareDownload"';e={SOAPAction:t};var a=sessionStorage.getItem("PrivateKey");if(null!=a){var r=sessionStorage.getItem("Cookie");$.cookie("uid",r,{expires:1,path:"/"});var i=(new Date).getTime();i=(i=Math.floor(i)%2e12).toString();var n=hex_hmac_md5(a,i+t);n=n.toUpperCase()+" "+i,e.HNAP_AUTH=n}$.ajax({url:"/HNAP1/",type:"POST",contentType:"text/xml; charset=utf-8",data:'<?xml version="1.0" encoding="UTF-8"?><soap:Envelope xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><soap:Body><PollingFirmwareDownload xmlns="http://purenetworks.com/HNAP1/" /></soap:Body></soap:Envelope>',cache:!1,headers:e,timeout:0,success:function(e,t,a){if(void 0===e.error){var r=!0,i=($(e).find("PollingFirmwareDownloadResult").text(),$(e).find("DownloadPercentage").text().toUpperCase());"ERROR"!=i?i=parseInt(i,10):r=!1,"ERROR"!=(datalistPolling[0].Percentage=i)?0<i&&($(".pollingProgress0 .progressbar_text").text(i+"%"),$(".pollingProgress0 .progressbar_bg").css({width:i+"%",backgroundColor:"rgba(69, 152, 170, 1)"})):($(".pollingProgress0 .td2 p").css({color:"rgba(255, 22, 0, 1)"}),$(".pollingProgress0 .progressbar").css({border:"1px solid rgba(255, 22, 0, 1)"}),$(".pollingProgress0 .progressbar_text").text(i),$(".pollingProgress0 .progressbar_bg").css({width:"100%",backgroundColor:"rgba(255, 22, 0, 1)"})),$(e).find("DownloadPercentageMulti").each(function(e){var t=$(this).attr("Dest"),a=$(this).text().toUpperCase(),r=!1,i="",n=0;"ERROR"!=a&&(a=parseInt(a,10));for(e=0;e<datalistPolling.length;e++)datalistPolling[e].MacAddress==t&&(r=!0,"ERROR"!=(datalistPolling[e].Percentage=a)?0<a&&($(".pollingProgress"+e+" .progressbar_text").text(a+"%"),$(".pollingProgress"+e+" .progressbar_bg").css({width:a+"%",backgroundColor:"rgba(69, 152, 170, 1)"})):($(".pollingProgress"+e+" .td2 p").css({color:"rgba(255, 22, 0, 1)"}),$(".pollingProgress"+e+" .progressbar").css({border:"1px solid rgba(255, 22, 0, 1)"}),$(".pollingProgress"+e+" .progressbar_text").text(a),$(".pollingProgress"+e+" .progressbar_bg").css({width:"100%",backgroundColor:"rgba(255, 22, 0, 1)"})));if(0==r){var o=new DataPolling(t,t);datalistPolling.push(o),n=datalistPolling.length-1,datalistPolling[n].Percentage=a,$("#pollingFirmwareTable tr").length<2?(i+='<tr class="pollingProgress'+n+'"><td class="td1">',currentDevice.featureCovrBundle?i+="<p>"+I18N("j","COVR Points")+"</p>":i+="<p>"+I18N("j","Extender")+"</p>",i+='</td><td class="td2"><p>'+datalistPolling[n].DeviceName+'</p></td><td class="td3"><div class="progressbar"><p class="progressbar_bg">&nbsp;</p><p class="progressbar_text">0%</p></div></td></tr>'):i+='<tr class="pollingProgress'+n+'"><td class="td1"></td><td class="td2"><p>'+datalistPolling[n].DeviceName+'</p></td><td class="td3"><div class="progressbar"><p class="progressbar_bg">&nbsp;</p><p class="progressbar_text">0%</p></div></td></tr>',$("#pollingFirmwareTable").append(i),"ERROR"!=a?0<a&&($(".pollingProgress"+n+" .progressbar_text").text(a+"%"),$(".pollingProgress"+n+" .progressbar_bg").css({width:a+"%",backgroundColor:"rgba(69, 152, 170, 1)"})):($(".pollingProgress"+n+" .td2 p").css({color:"rgba(255, 22, 0, 1)"}),$(".pollingProgress"+n+" .progressbar").css({border:"1px solid rgba(255, 22, 0, 1)"}),$(".pollingProgress"+n+" .progressbar_text").text(a),$(".pollingProgress"+n+" .progressbar_bg").css({width:"100%",backgroundColor:"rgba(255, 22, 0, 1)"}))}}),0!=r?i<99?s.notify():i<100?null==d&&(d=setTimeout(function(){clearInterval(l),clearTimeout(d),s.reject()},3e5)):(clearInterval(l),clearTimeout(d),s.resolve()):(clearInterval(l),clearTimeout(d),s.reject())}else clearInterval(l),clearTimeout(d),s.reject()},error:function(e,t,a){401==e.status&&location.assign("/"),clearInterval(l),clearTimeout(d),s.reject()}})},3e3),s.promise()},do_upgrade:function(){var e=I18N("j","Please wait")+" ...";PopView.show(e),this.GetFirmwareValidation().done(function(e){var t=I18N("j","The firmware is being upgraded, please do not power off your device."),a=I18N("j","Firmware Upgrade success!");PopView.showWithPercent(t,e).done(function(){PopView.showConfirm(a).done(function(){location.assign("/")})})}).fail(function(){var e=I18N("j","Firmware Upgrade failed!");PopView.showConfirm(e).done(function(){location.reload()})})},GetFirmwareValidation:function(){var t=$.Deferred(),e=new SOAPGetFirmwareValidationResponse;return(new SOAPAction).sendSOAPAction("GetFirmwareValidation",null,e).done(function(e){"true"==e.IsValid?t.resolve(parseInt(e.CountDown)):t.reject()}).fail(function(){t.reject()}),t.promise()},manual_prepareUpload:function(e){if(void 0!==e.target){var t=e.target.files;this.currentFile=t[0]}return this.currentFile},manual_openWindow:function(e,t,a,r){var i=null!=window.screenLeft?window.screenLeft:screen.left,n=null!=window.screenTop?window.screenTop:screen.top,o=(window.innerWidth?window.innerWidth:document.documentElement.clientWidth?document.documentElement.clientWidth:screen.width)/2-a/2+i,s=(window.innerHeight?window.innerHeight:document.documentElement.clientHeight?document.documentElement.clientHeight:screen.height)/2-r/2+n,l=window.open(e,t,"scrollbars=yes, width="+a+", height="+r+", top="+s+", left="+o);window.focus&&l.focus()},manual_ShowUpgradeBtn:function(t){var a=this;$("#manualFirmwareTable2_fileName").show(),$("#manualFirmwareTable2_fileName td p").text(t.name),$("#manualFirmwareTable2_upgrade").show(),$("#manualFirmwareTable2_upgradeBtn").off("click").on("click",function(){var e=I18N("j","Do you want to upgrade Firmware?");PopView.showDialog(e).done(function(){a.manual_upgradeFirmware(t),stopTimeout()}).fail(function(){a.manual_resetFileSelect(),PopView.hide()})})},manual_upgradeFirmware:function(e){var t=this,a=I18N("j","Please wait")+"...";PopView.show(a),t.uploadFile("FirmwareUpload","FWFile",e).done(function(){var e=I18N("j","Please wait")+"...";PopView.show(e),t.manual_upgrade()}).fail(function(){setTimeout(function(){var e=I18N("j","Firmware Upgrade failed!");PopView.showConfirm(e).done(function(){t.manual_resetFileSelect(),PopView.hide()})},1e3)})},uploadFile:function(t,a,r){var i=this,n=$.Deferred(),e=new FileReader;return e.onload=function(e){i.upload(t,a,e.target.result,r,0).done(function(){n.resolve()}).fail(function(){n.reject()})},e.readAsArrayBuffer(r),n.promise()},manual_upgrade:function(){var t=this,e=I18N("j","Please wait")+"...";PopView.show(e),t.GetFirmwareValidation().done(function(e){var t=I18N("j","The firmware is being upgraded, please do not power off your device.");PopView.showWithPercent(t,e).done(function(){var e=I18N("j","Firmware Upgrade success!");PopView.showConfirm(e).done(function(){location.assign("/")})})}).fail(function(){var e=I18N("j","Firmware Upgrade failed!");PopView.showConfirm(e).done(function(){t.manual_resetFileSelect(),PopView.hide()})})},upload:function(e,t,a,r,i){var n=$.Deferred(),o=new Blob([a]),s=new FormData,l={};s.append(t,o,r.name);var d='"'+this.SOAP_NAMESPACE+e+'"';l={SOAPAction:d};var c=sessionStorage.getItem("PrivateKey");if(null!=c){var u=sessionStorage.getItem("Cookie");$.cookie("uid",u,{expires:1,path:"/"});var w=(new Date).getTime();w=(w=Math.floor(w)%2e12).toString();var m=hex_hmac_md5(c,w+d);m=m.toUpperCase()+" "+w,l.HNAP_AUTH=m}return $.ajax({url:"/HNAP1/",type:"POST",data:s,cache:!1,processData:!1,headers:l,contentType:!1,success:function(e,t,a){void 0===e.error?n.resolve():n.reject()},error:function(e,t,a){401==e.status&&location.assign("/"),n.reject()}}),n.promise()},manual_resetFileSelect:function(){$("#manualFirmwareTable2_fileName td p").html(""),$("#uploadfile").val(""),$("#manualFirmwareTable2_fileName").hide(),$("#manualFirmwareTable2_upgrade").hide()},changeAutoUpgradeMSG:function(e){"true"==e.toString()?$("#autoUpgradeText").html(I18N("j","Update my device automatically every day at 3:30-4:00 AM to always enjoy the latest improvements and features.")):$("#autoUpgradeText").html(I18N("j","Update my device automatically to always enjoy the latest improvements and features."))}},singleFirmwareFn={BtnChange:function(){var e=this;$("#singleFirmwareTableMessage_checkNewFirmwareBtn").on("click",function(){$("#singleFW_text span").html(I18N("j","Please wait")+"..."),$("#singleFW_text").show(),$("#singleFirmwareTableMessage_checkNewFirmwareBtn").addClass("active").prop("disabled",!0),e.GetFirmwareStatus().done(function(e){var t=e.CurrentFWVersion,a=e.LatestFWVersion;parseFloat(t)<parseFloat(a)?($("#singleFW_latestVersion_tr").show(),$("#singleFW_latestDate_tr").show(),$("#singleFW_latestVersion span").html(a),$("#singleFW_latestDate span").html(e.LatestFWVersionDate),$("#singleFW_text").hide(),$("#singleFirmwareTableMessage_checkNewFirmwareBtn").hide(),$("#singleFirmwareTableMessage_upgradeFirmwareBtn").show()):($("#singleFW_latestVersion_tr").hide(),$("#singleFW_latestDate_tr").hide(),$("#singleFW_text span").html(I18N("j","This firmware is the latest version.")),$("#singleFW_text").show()),$("#singleFirmwareTableMessage_checkNewFirmwareBtn").removeClass("active").prop("disabled",!1)}).fail(function(){$("#singleFW_latestVersion_tr").hide(),$("#singleFW_latestDate_tr").hide(),$("#singleFW_text span").html(I18N("j","This firmware is the latest version.")),$("#singleFW_text").show(),$("#singleFirmwareTableMessage_checkNewFirmwareBtn").removeClass("active").prop("disabled",!1)})}),$("#singleFirmwareTableMessage_upgradeFirmwareBtn").on("click",function(){stopTimeout(),e.AutoUpgradeFirmware()})},checkFirmware:function(){var t=$.Deferred(),e=new SOAPGetFirmwareSettingsResponse;return(new SOAPAction).sendSOAPAction("GetFirmwareSettings",null,e).done(function(e){t.resolve(e)}).fail(function(){t.reject()}),t.promise()},GetFirmwareStatus:function(){var t=$.Deferred(),e=new SOAPGetFirmwareStatusResponse;return(new SOAPAction).sendSOAPAction("GetFirmwareStatus",null,e).done(function(e){t.resolve(e)}).fail(function(){t.reject()}),t.promise()},AutoUpgradeFirmware:function(){var e=this;PopView.showcount(I18N("j","Please do not close the browser while the firmware is being downloaded!"),""),e.StartFirmwareDownload().progress(function(e){$("#popalert_countdown").html(e+" %")}).done(function(){$("#popalert_countdown").html("100 %"),setTimeout(function(){e.do_upgrade()},2e3)}).fail(function(){var e=I18N("j","Firmware Upgrade failed!");PopView.showConfirm(e).done(function(){location.reload()})})},StartFirmwareDownload:function(){var t=this,a=$.Deferred();return(new SOAPAction).sendSOAPAction("StartFirmwareDownload",null,null).done(function(e){"OK"==e.StartFirmwareDownloadResult||"RESTART"==e.StartFirmwareDownloadResult?t.GetPollingFirmwareDownloadStatus(3e3).progress(function(e){a.notify(e)}).done(function(){a.resolve()}).fail(function(){a.reject()}):a.reject()}).fail(function(){a.reject()}),a.promise()},GetPollingFirmwareDownloadStatus:function(e){var a=$.Deferred(),t=new SOAPPollingFirmwareDownloadResponse,r=new SOAPAction,i=null,n=null;return 0<e?(i=setInterval(function(){r.sendSOAPAction("PollingFirmwareDownload",null,t).done(function(e){var t=parseInt(e.DownloadPercentage);t<100?a.notify(t):(clearInterval(i),clearInterval(n),a.resolve())})},e),n=setTimeout(function(){clearInterval(i),a.reject()},18e4)):(clearInterval(i),clearInterval(n),a.resolve()),a.promise()},do_upgrade:function(){var e=I18N("j","Please wait")+" ...";PopView.show(e),this.GetFirmwareValidation().done(function(e){var t=I18N("j","The firmware is being upgraded, please do not power off your device."),a=I18N("j","Firmware Upgrade success!");PopView.showWithPercent(t,e).done(function(){PopView.showConfirm(a).done(function(){location.assign("/")})})}).fail(function(){var e=I18N("j","Firmware Upgrade failed!");PopView.showConfirm(e).done(function(){location.reload()})})},GetFirmwareValidation:function(){var t=$.Deferred(),e=new SOAPGetFirmwareValidationResponse;return(new SOAPAction).sendSOAPAction("GetFirmwareValidation",null,e).done(function(e){"true"==e.IsValid?t.resolve(parseInt(e.CountDown)):t.reject()}).fail(function(){t.reject()}),t.promise()}};