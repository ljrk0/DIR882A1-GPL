/* svn info: $Revision: 1195 $ $Date: 2018-11-29 14:17:58 +0800 (Thu, 29 Nov 2018) $ */
var RadioIDList,wifi_datalist=new Array;function WiFiSetting(e,n,t){this.band=e,this.setting=n,this.security=t}function getWiFiData(e,n){for(obj in e)if(n==e[obj].band)return e[obj];return null}function RadioIDToBand(e){var n=null;switch(e){case"RADIO_2.4GHz":n="24";break;case"RADIO_5GHz":n="5"}return n}function GetWirelessXML(){var t=$.Deferred(),i=[null,null];return InitInfo().done(function(){for(var e in RadioIDList){var n=RadioIDList[e];i[e]=get_wireless(n).then(function(e){wifi_datalist.push(e)})}$.when(i[0],i[1]).done(function(){t.resolve(wifi_datalist)})}).fail(function(){t.reject()}),t.promise()}function GetExtenderXML(){var e=$.Deferred();return InitInfo().done(function(){e.resolve()}).fail(function(){e.reject()}),e.promise()}function InitInfo(){var i=$.Deferred(),e=new SOAPAction,r=new SOAPGetWLanRadiosResponse,n=e.sendSOAPAction("GetWLanRadios",null,r);return $.when(n).done(function(){for(var e in RadioIDList=new Array,r.RadioInfos.RadioInfo){var n=r.RadioInfos.RadioInfo[e],t=RadioIDToBand(n.RadioID);RadioIDList.push(n.RadioID),"function"==typeof initChannel&&initChannel(n,t)}i.resolve()}).fail(function(){i.reject()}),i.promise()}function getSmartConnectStatus(){var n=$.Deferred(),e=new SOAPGetSmartconnectSettingsResponse;return(new SOAPAction).sendSOAPAction("GetSmartconnectSettings",null,e).done(function(e){n.resolve(e)}).fail(function(){n.reject()}),n.promise()}function getSmartCovrStatus(){var n=$.Deferred(),e=new SOAPGetSmartconnectSettingsResponse,t=(new SOAPGetWiFiSONSettingsResponse,new SOAPAction);return currentDevice.featureSmartConnect_e?t.sendSOAPAction("GetSmartconnectSettings",null,e).done(function(e){n.resolve(e)}).fail(function(){n.reject()}):n.resolve(),n.promise()}function getWPSbtnStatus(){var n=$.Deferred(),e=new SOAPGetWPSSettingsResponse,t=new SOAPAction;return currentDevice.featureWPS?t.sendSOAPAction("GetWPSSettings",null,e).done(function(e){n.resolve(e)}).fail(function(){n.reject()}):n.resolve(),n.promise()}function get_wireless(e){var t=$.Deferred(),n=new SOAPAction,i=new SOAPGetWLanRadioSettings,r=new SOAPGetWLanRadioSecurity,o=new SOAPGetWLanRadioSettingsResponse,a=new SOAPGetWLanRadioSecurityResponse,s=RadioIDToBand(e);i.RadioID=e;var S=n.sendSOAPAction("GetWLanRadioSettings",i,o);r.RadioID=e;var c=n.sendSOAPAction("GetWLanRadioSecurity",r,a);return $.when(S,c).done(function(e){var n=new WiFiSetting(s,o,a);t.resolve(n)}).fail(function(e){t.reject()}),t.promise()}function getOPmode(){var n=$.Deferred(),e=new SOAPAction,t=new SOAPGetOperationModeResponse;return e.sendSOAPAction("GetOperationMode",null,t).done(function(e){n.resolve(e)}).fail(function(e){n.reject()}),n.promise()}function getAPCsettings(e){var n=$.Deferred(),t=new SOAPAction,i=new SOAPGetAPClientSettings,r=new SOAPGetAPClientSettingsResponse;return i.RadioID=e,t.sendSOAPAction("GetAPClientSettings",i,r).done(function(e){"true"==e.Enabled.toLowerCase()&&""!=e.SSID?n.resolve(e):n.reject()}).fail(function(e){n.reject()}),n.promise()}function getAPCinfoByRadio(e,n){var t=$.Deferred(),i=n;return getAPCsettings(e[i]).done(function(e){t.resolve(e)}).fail(function(){++i<e.length?getAPCinfoByRadio(e,i).done(function(e){t.resolve(e)}).fail(function(){t.reject()}):t.reject()}),t.promise()}function getAPCinfo(e){var n=$.Deferred();return getAPCinfoByRadio(e,0).done(function(e){n.resolve(e)}).fail(function(){var e=new SOAPGetAPClientSettingsResponse;n.resolve(e)}),n.promise()}function createWlanSettings(e){var n=new SOAPSetWLanRadioSettings,t=getWiFiData(wifi_datalist,e),i=$("#CurrentOPMode").val(),r=$("#APenabled_Smart").prop("checked");switch(e){case"24":n.RadioID="RADIO_2.4GHz",n.Coexistence=$("#APcoexistence_"+e).prop("checked"),n.Mode="802.11bgn";break;case"5":n.RadioID="RADIO_5GHz",n.Mode="802.11anac",n.Coexistence=t.setting.Coexistence}return n.Enabled=$("#APenabled_"+e).prop("checked"),n.SSID=XMLEncode($("#APssid_"+e).val()),r?(n.ChannelWidth=0,n.Channel=0):"WirelessAp"==i?(n.ChannelWidth=$("#APchannelWidth_"+e).val(),n.Channel=$("#APchannel_"+e).val()):(n.ChannelWidth=t.setting.ChannelWidth,n.Channel=t.setting.Channel),n.SSIDBroadcast=t.setting.SSIDBroadcast,n.SecondaryChannel=t.setting.SecondaryChannel,n.QoS=t.setting.QoS,n.ScheduleName=$("#schedule_"+e).val(),n.TXPower=t.setting.TXPower,n}function createWlanSecurity(e){var n=new SOAPSetWLanRadioSecurity,t=$("#APkey_"+e).val();switch(e){case"24":n.RadioID="RADIO_2.4GHz";break;case"5":n.RadioID="RADIO_5GHz"}return 0==t.length?n.Enabled=!1:(n.Enabled=!0,n.Type="WPAORWPA2-PSK",n.Encryption="TKIPORAES",n.Key=t,n.KeyRenewal=3600),n}function createOPmode(e,n){var t=new SOAPSetOperationMode;return t.RadioID=e,t.CurrentOPMode=n,t}function createAPCSettings(e,n){var t=XMLEncode(e),i=n,r=new SOAPSetAPClientSettings;return r.RadioID="",r.SSID=t,r.Enabled=!0,0==(r.Key=i).length?(r.SupportedSecurity.SecurityInfo[0].SecurityType="NONE",r.SupportedSecurity.SecurityInfo[0].Encryptions=["NONE"]):(r.SupportedSecurity.SecurityInfo[0].SecurityType="WPAORWPA2-PSK",r.SupportedSecurity.SecurityInfo[0].Encryptions=["TKIPORAES"]),r}function SetExtenderXML(){var e,t=$.Deferred(),n=new SOAPAction;if(e=createAPCSettings($("#APCssid").val(),$("#APCkey").val()),n.SetMultipleSOAP("SetAPClientSettings",e,null),currentDevice.feature_WirelessAp_WPS){var i=new SOAPSetWPSSettings;i.WPSPBC=$("#wps_pbc").prop("checked"),i.WPSPIN=$("#wps_pin").prop("checked"),n.SetMultipleSOAP("SetWPSSettings",i,null)}return n.SendMultipleSOAPAction("SetMultipleActions").done(function(e,n){t.resolve(e,n)}),t.promise()}function setSmartConnectStatus(e,n){var t=new SOAPSetSmartconnectSettings;t.Enabled=n,e.SetMultipleSOAP("SetSmartconnectSettings",t,null)}function startWPSPBC(e){var n=$.Deferred(),t=new SOAPAction,i=new SOAPSetTriggerWPS,r=new SOAPSetTriggerWPSResponse;return stopTimeout(),i.Duration=e,t.sendSOAPAction("SetTriggerWPS",i,r).done(function(e){getWPSStatus(1e3*parseInt(e.WaitTime)).progress(function(e){n.notify(e)}).then(function(e){startTimeout(),n.resolve(e)}).fail(function(){n.reject()})}).fail(function(e){n.reject()}),n.promise()}var wpstimer=null,wpstimer2=null;function getWPSStatus(e){var i=$.Deferred(),n=new SOAPAction,t=new SOAPGetWPSStatusResponse;return wpstimer=setTimeout(function(){null==wpstimer2&&(wpstimer2=setInterval(function(){n.sendSOAPAction("GetWPSStatus",null,t).done(function(e){for(var n in e.WPSStatusLists.WPSStatus){var t=e.WPSStatusLists.WPSStatus[n];if("WPS_IN_PROGRESS"==t.Status.toUpperCase())break;"WPS_SUCCESS"==t.Status.toUpperCase()&&(clearInterval(wpstimer2),wpstimer2=null,i.resolve(t))}}).fail(function(e){clearInterval(wpstimer2),wpstimer2=null,i.reject()})},2e3)),i.notify(wpstimer)},e),i.notify(wpstimer),i.promise()}function getSiteSurveyResult(e){var n=$.Deferred(),t=new SOAPAction,i=new SOAPGetSiteSurvey,r=new SOAPGetSiteSurveyResponse;return i.RadioID=e,t.sendSOAPAction("GetSiteSurvey",i,r).done(function(e){n.resolve(e)}).fail(function(){n.reject()}),n.promise()}function doSiteSurveyByRadio(i,e){var r=$.Deferred(),o=e,n=new SOAPAction,t=new SOAPSetTriggerWirelessSiteSurvey,a=new SOAPSetTriggerWirelessSiteSurveyResponse;t.RadioID=i[o],n.sendSOAPAction("SetTriggerWirelessSiteSurvey",t,a).done(function(e){var n=parseInt(e.WaitTime);sleep(1e3*n).then(function(){return getSiteSurveyResult(i[o])}).then(function(e){var n=e.APStatInfoLists.APStatInfo;for(var t in n)n[t].radioID=i[o];r.notify(n),s(!0)}).fail(function(){s(!1)})}).fail(function(){r.reject()});var s=function(e){++o<i.length?doSiteSurveyByRadio(i,o).done(function(e){r.resolve()}).progress(function(e){r.notify(e)}).fail(function(){r.reject()}):e?r.resolve():r.reject()};return r.promise()}function sortSiteList(e){e.sort(function(e,n){return parseInt(n.SignalStrength)-parseInt(e.SignalStrength)||e.radioID.length-n.radioID.length})}function doSiteSurvey(){var e=$.Deferred(),t=new Array;return stopTimeout(),doSiteSurveyByRadio(RadioIDList,0).progress(function(e){for(var n in e)t.push(e[n])}).always(function(){sortSiteList(t),startTimeout(),e.resolve(t)}),e.promise()}function getschedulesettings(){var e=$.Deferred(),n=new SOAPAction,o=new SOAPGetScheduleSettingsResponse,t=n.sendSOAPAction("GetScheduleSettings",null,o);return $.when(t).done(function(){RadioIDList.map(function(e){var n=RadioIDToBand(e),t=$("#schedule_"+n);for(var i in o.ScheduleInfoLists){var r=o.ScheduleInfoLists[i].ScheduleName;t.append('<option value="'+r+'">'+decode_char_text(r)+"</option>")}t.selectbox({width:"100%"})}),e.resolve()}).fail(function(){e.reject()}),e.promise()}