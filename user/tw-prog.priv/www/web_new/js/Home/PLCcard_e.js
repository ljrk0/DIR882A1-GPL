/* svn info: $Revision: 847 $ $Date: 2018-06-06 18:37:11 +0800 (Wed, 06 Jun 2018) $ */
var macList2="";function LoadMACList2(){$.ajax({url:"/js/MacList.json",type:"GET",dataType:"json",success:function(e){macList2=e,GetXMLPLC(),hometimer3=setInterval("GetXMLPLC()",6e3)}})}function getVendor2(e){var t,a="Unknown Vendor";if(void 0===macList2||""==macList2)return a;try{var n=e.split(":"),i=Base92(parseInt(n[0],16)),d=Base92(parseInt(n[1]+n[2],16));void 0===(t=macList2[i][d])&&(t=a)}catch(e){t=a}return decode_char_text(t)}function GetXMLPLC(){var r=$.Deferred(),s=new SOAPGetPLCStationInfoResponse,e=(new SOAPAction).sendSOAPAction("GetPLCStationInfo",null,s);return $.when(e).done(function(e){for(var t in deviceDataArray)deviceDataArray[t].Live=!1;var a=0;if(s.StationInfoLists.StationInfo.length<=0)mySlideshow.update();else{for(var n in a=deviceDataArray.length-1,s.StationInfoLists.StationInfo){var i=s.StationInfoLists.StationInfo[n],d=getDataRowNumByMac2(i.StationMAC),c=null,l=0;l=parseInt(i.StationTxPHY)>=parseInt(i.StationRxPHY)?parseInt(i.StationTxPHY):parseInt(i.StationRxPHY),isNaN(l)&&(l=0),null!=d?(c=deviceDataArray[d].rownumid,deviceDataArray[d].deviceName=i.StationName,deviceDataArray[d].vendor=getVendor2(i.StationMAC),deviceDataArray[d].mac=i.StationMAC,deviceDataArray[d].PHYnum=l,deviceDataArray[d].Live=!0,deviceDataArray[d].rownumid=d,deviceDataArray[d].stationMode=i.StationMode,""==i.StationName?$("#plccard"+c).find(".dataElement_deviceName").html(i.StationMode):$("#plccard"+c).find(".dataElement_deviceName").html(i.StationName),$("#plccard"+c).find(".dataElement_vendor").html(getVendor2(i.StationMAC)),$("#plccard"+c).find(".dataElement_mac").html(i.StationMAC),$("#plccard"+c).find(".dataElement_phynum").find("p").html(l),$("#ss_itemContainer").find(".dataElement").eq(d).attr("id","plccard"+d),$("#ss_itemContainer").find(".dataElement").eq(d).attr("data-num",d),mySlideshow.itemArray[d].id="plccard"+d,mySlideshow.dataArray[d].element.id="plccard"+d,"Slave"!=sessionStorage.getItem("WiFiSONRole")?$(".dataElement_editbtn").show():$(".dataElement_editbtn").hide()):(a+=1,addDevice(i.StationName,getVendor2(i.StationMAC),i.StationMAC,l,a,i.StationMode))}for(t=0;t<deviceDataArray.length;t++)if(0==deviceDataArray[t].Live){deviceDataArray[t].rownumid;$("#plccard"+deviceDataArray[t].rownumid).remove(),deviceDataArray.splice(t,1),mySlideshow.itemArray.splice(t,1),mySlideshow.dataArray.splice(t,1),t--}mySlideshow.update()}r.resolve()}).fail(function(){r.reject()}),r.promise()}function getDataRowNumByMac2(e){var t,a=null,n=e.toLowerCase();for(t=0;t<deviceDataArray.length;t++)if(deviceDataArray[t].mac.toLowerCase()==n){a=t;break}return a}var deviceData=function(e,t,a,n,i,d){this.deviceName=e,this.vendor=t,this.mac=a,this.PHYnum=n,this.element,this.Live=!0,this.rownumid=i,this.proprity="none",this.stationMode=d,this.element=document.createElement("div"),this.element.style.width="188px",this.element.style.height="140px",this.element.style.fontSize="12px",this.element.style.verticalAlign="top",this.element.style.margin="0 6px",this.element.className="dataElement",this.element.onmouseover=function(){this.style.backgroundPosition="bottom left"},this.element.onmouseout=function(){this.style.backgroundPosition="top left"},this.element.id="plccard"+i,this.element.setAttribute("data-num",i),this.element_deviceName=document.createElement("div"),this.element_deviceName.className="dataElement_deviceName",this.element_deviceName.innerHTML=""==e?d:e,this.element_vendor=document.createElement("div"),this.element_vendor.className="dataElement_vendor",this.element_vendor.innerHTML=t,this.element_mac=document.createElement("div"),this.element_mac.className="dataElement_mac",this.element_mac.innerHTML=a,this.element_phynum=document.createElement("div"),this.element_phynum.className="dataElement_phynum",this.element_editbtn=document.createElement("div"),this.element_editbtn.className="dataElement_editbtn",this.element_phynum_num=document.createElement("p"),this.element_phynum_num.innerHTML=n,this.element_phynum_span=document.createElement("span"),this.element_phynum_span.innerHTML="Mbps",this.element.appendChild(this.element_deviceName),this.element.appendChild(this.element_vendor),this.element.appendChild(this.element_mac),this.element.appendChild(this.element_phynum),this.element_phynum.appendChild(this.element_phynum_num),this.element_phynum.appendChild(this.element_phynum_span),this.element.appendChild(this.element_editbtn)},deviceDataArray=new Array,createDeviceData=function(e,t,a,n,i,d){var c=new deviceData(e,t,a,n,i,d);return deviceDataArray.push(c),c};function addDevice(e,t,a,n,i,d){var c=createDeviceData(e,t,a,n,i,d);mySlideshow.addItem(c),"Slave"!=sessionStorage.getItem("WiFiSONRole")?$(".dataElement_editbtn").show():$(".dataElement_editbtn").hide()}var mySlideshow=new Slideshow("slideshow");function clearCreateRulePOP_plccard(){$("#editPop_plccard").hide(),$("#check_btn_plc").removeClass().addClass("styled_button_dis"),$("#check_btn_plc").attr("disabled",!0),$("#plc_Name").val(""),$("#closeCreatePopBtn_plccard").show(),$("#closeCreatePopBtn_plccard2").hide(),$(".plccardform_editPop_savetext").hide(),starthometimer()}function checkUpdate_plc(){$("#check_btn_plc").removeClass().addClass("styled_button_s"),$("#check_btn_plc").attr("disabled",!1)}function closeEditPOP_plc(){var e=new SOAPAction,t=new SOAPSetClientInfo,a=new SOAPClientInfo;a.MacAddress=$("#MACAddress_plc").html(),a.NickName=$("#plc_Name").val(),t.ClientInfoLists.push(a);var n=e.sendSOAPAction("SetClientInfo",t,null);$("#check_btn_plc").removeClass().addClass("styled_button_dis"),$("#check_btn_plc").attr("disabled",!0),$("#closeCreatePopBtn_plccard").hide(),$("#closeCreatePopBtn_plccard2").show(),$(".plccardform_editPop_savetext").show(),n.then(function(){GetXMLPLC().then(function(){clearCreateRulePOP_plccard()})})}function setplcValidate(){$("#plccard_form").validate({rules:{client_editMac:{checkMac:!0,checkMacConflict:!0},client_IPAdrReserve:{checkIP:!0,checkIPConflict:!0,checkDHCPrange:!0}},submitHandler:function(e){closeEditPOP_plc()}})}$(document).on("click",".dataElement_editbtn",function(){clearhometimer();var e=$(this).closest(".dataElement").attr("data-num"),t=parseInt(e);""==deviceDataArray[t].deviceName?$("#plc_Name").val(deviceDataArray[t].stationMode):$("#plc_Name").val(deviceDataArray[t].deviceName),$("#Vendor_plc").html(deviceDataArray[t].vendor.toUpperCase()),$("#MACAddress_plc").html(deviceDataArray[t].mac.toUpperCase()),$("#linkrate_plc").html(deviceDataArray[t].PHYnum+"&nbsp;Mbps"),$("#editPop_plccard").show()});