/* svn info: $Revision: 1449 $ $Date: 2019-05-10 21:23:01 +0800 (Fri, 10 May 2019) $ */
var RadioIDList,wifi_datalist=new Array;function WiFiSetting(e,t,n){this.band=e,this.setting=t,this.security=n}function getWiFiData(e,t){for(obj in e)if(t==e[obj].band)return e[obj];return null}function RadioIDToBand(e){var t=null;switch(e){case"RADIO_2.4GHz":t="24";break;case"RADIO_5GHz":t="5"}return t}function GetWirelessXML(){var n=$.Deferred(),i=[null,null];return InitInfo().done(function(){for(var e in RadioIDList){var t=RadioIDList[e];i[e]=get_wireless(t).then(function(e){wifi_datalist.push(e)})}$.when(i[0],i[1]).done(function(){n.resolve(wifi_datalist)})}).fail(function(){n.reject()}),n.promise()}function GetExtenderXML(){var e=$.Deferred();return InitInfo().done(function(){e.resolve()}).fail(function(){e.reject()}),e.promise()}function InitInfo(){var i=$.Deferred(),e=new SOAPAction,r=new SOAPGetWLanRadiosResponse,t=e.sendSOAPAction("GetWLanRadios",null,r);return $.when(t).done(function(){for(var e in RadioIDList=new Array,r.RadioInfos.RadioInfo){var t=r.RadioInfos.RadioInfo[e],n=RadioIDToBand(t.RadioID);RadioIDList.push(t.RadioID),"function"==typeof initChannel&&initChannel(t,n)}i.resolve()}).fail(function(){i.reject()}),i.promise()}function getSmartConnectStatus(){var t=$.Deferred(),e=new SOAPGetSmartconnectSettingsResponse;return(new SOAPAction).sendSOAPAction("GetSmartconnectSettings",null,e).done(function(e){t.resolve(e)}).fail(function(){t.reject()}),t.promise()}function getSmartCovrStatus(){var t=$.Deferred(),e=new SOAPGetSmartconnectSettingsResponse,n=(new SOAPGetWiFiSONSettingsResponse,new SOAPAction);return currentDevice.featureSmartConnect_e?n.sendSOAPAction("GetSmartconnectSettings",null,e).done(function(e){t.resolve(e)}).fail(function(){t.reject()}):t.resolve(),t.promise()}function getWPSbtnStatus(){var t=$.Deferred(),e=new SOAPGetWPSSettingsResponse,n=new SOAPAction;return currentDevice.featureWPS?n.sendSOAPAction("GetWPSSettings",null,e).done(function(e){t.resolve(e)}).fail(function(){t.reject()}):t.resolve(),t.promise()}function get_wireless(e){var n=$.Deferred(),t=new SOAPAction,i=new SOAPGetWLanRadioSettings,r=new SOAPGetWLanRadioSecurity,o=new SOAPGetWLanRadioSettingsResponse,s=new SOAPGetWLanRadioSecurityResponse,S=RadioIDToBand(e);i.RadioID=e;var a=t.sendSOAPAction("GetWLanRadioSettings",i,o);r.RadioID=e;var u=t.sendSOAPAction("GetWLanRadioSecurity",r,s);return $.when(a,u).done(function(e){var t=new WiFiSetting(S,o,s);n.resolve(t)}).fail(function(e){n.reject()}),n.promise()}function getOPmode(){var t=$.Deferred(),e=new SOAPAction,n=new SOAPGetOperationModeResponse;return e.sendSOAPAction("GetOperationMode",null,n).done(function(e){t.resolve(e)}).fail(function(e){t.reject()}),t.promise()}function getAPCsettings(e){var t=$.Deferred(),n=new SOAPAction,i=new SOAPGetAPClientSettings,r=new SOAPGetAPClientSettingsResponse;return i.RadioID=e,n.sendSOAPAction("GetAPClientSettings",i,r).done(function(e){"true"==e.Enabled.toLowerCase()&&""!=e.SSID?t.resolve(e):t.reject()}).fail(function(e){t.reject()}),t.promise()}function getAPCinfoByRadio(e,t){var n=$.Deferred(),i=t;return getAPCsettings(e[i]).done(function(e){n.resolve(e)}).fail(function(){++i<e.length?getAPCinfoByRadio(e,i).done(function(e){n.resolve(e)}).fail(function(){n.reject()}):n.reject()}),n.promise()}function getAPCinfo(e){var t=$.Deferred();return getAPCinfoByRadio(e,0).done(function(e){t.resolve(e)}).fail(function(){var e=new SOAPGetAPClientSettingsResponse;t.resolve(e)}),t.promise()}function createOPmode(e,t){var n=new SOAPSetOperationMode;return n.RadioID=e,n.CurrentOPMode=t,n}function createAPCSettings(e,t){var n=XMLEncode(e),i=t,r=new SOAPSetAPClientSettings;return r.RadioID="",r.SSID=n,r.Enabled=!0,0==(r.Key=i).length?(r.SupportedSecurity.SecurityInfo[0].SecurityType="NONE",r.SupportedSecurity.SecurityInfo[0].Encryptions=["NONE"]):(r.SupportedSecurity.SecurityInfo[0].SecurityType="WPAORWPA2-PSK",r.SupportedSecurity.SecurityInfo[0].Encryptions=["TKIPORAES"]),r}function SetExtenderXML(){var e,n=$.Deferred(),t=new SOAPAction;if(e=createAPCSettings($("#APCssid").val(),$("#APCkey").val()),t.SetMultipleSOAP("SetAPClientSettings",e,null),currentDevice.feature_WirelessAp_WPS){var i=new SOAPSetWPSSettings;i.WPSPBC=$("#wps_pbc").prop("checked"),i.WPSPIN=$("#wps_pin").prop("checked"),t.SetMultipleSOAP("SetWPSSettings",i,null)}return t.SendMultipleSOAPAction("SetMultipleActions").done(function(e,t){n.resolve(e,t)}),n.promise()}function setSmartConnectStatus(e,t){var n=new SOAPSetSmartconnectSettings;n.Enabled=t,e.SetMultipleSOAP("SetSmartconnectSettings",n,null)}function startWPSPBC(e){var t=$.Deferred(),n=new SOAPAction,i=new SOAPSetTriggerWPS,r=new SOAPSetTriggerWPSResponse;return stopTimeout(),i.Duration=e,n.sendSOAPAction("SetTriggerWPS",i,r).done(function(e){getWPSStatus(1e3*parseInt(e.WaitTime)).progress(function(e){t.notify(e)}).then(function(e){startTimeout(),t.resolve(e)}).fail(function(){t.reject()})}).fail(function(e){t.reject()}),t.promise()}var wpstimer=null,wpstimer2=null;function getWPSStatus(e){var i=$.Deferred(),t=new SOAPAction,n=new SOAPGetWPSStatusResponse;return wpstimer=setTimeout(function(){null==wpstimer2&&(wpstimer2=setInterval(function(){t.sendSOAPAction("GetWPSStatus",null,n).done(function(e){for(var t in e.WPSStatusLists.WPSStatus){var n=e.WPSStatusLists.WPSStatus[t];if("WPS_IN_PROGRESS"==n.Status.toUpperCase())break;"WPS_SUCCESS"==n.Status.toUpperCase()&&(clearInterval(wpstimer2),wpstimer2=null,i.resolve(n))}}).fail(function(e){clearInterval(wpstimer2),wpstimer2=null,i.reject()})},2e3)),i.notify(wpstimer)},e),i.notify(wpstimer),i.promise()}function getSiteSurveyResult(e){var t=$.Deferred(),n=new SOAPAction,i=new SOAPGetSiteSurvey,r=new SOAPGetSiteSurveyResponse;return i.RadioID=e,n.sendSOAPAction("GetSiteSurvey",i,r).done(function(e){t.resolve(e)}).fail(function(){t.reject()}),t.promise()}function doSiteSurveyByRadio(i,e){var r=$.Deferred(),o=e,t=new SOAPAction,n=new SOAPSetTriggerWirelessSiteSurvey,s=new SOAPSetTriggerWirelessSiteSurveyResponse;n.RadioID=i[o],t.sendSOAPAction("SetTriggerWirelessSiteSurvey",n,s).done(function(e){var t=parseInt(e.WaitTime);sleep(1e3*t).then(function(){return getSiteSurveyResult(i[o])}).then(function(e){var t=e.APStatInfoLists.APStatInfo;for(var n in t)t[n].radioID=i[o];r.notify(t),S(!0)}).fail(function(){S(!1)})}).fail(function(){r.reject()});var S=function(e){++o<i.length?doSiteSurveyByRadio(i,o).done(function(e){r.resolve()}).progress(function(e){r.notify(e)}).fail(function(){r.reject()}):e?r.resolve():r.reject()};return r.promise()}function sortSiteList(e){e.sort(function(e,t){return parseInt(t.SignalStrength)-parseInt(e.SignalStrength)||e.radioID.length-t.radioID.length})}function doSiteSurvey(){var e=$.Deferred(),n=new Array;return stopTimeout(),doSiteSurveyByRadio(RadioIDList,0).progress(function(e){for(var t in e)n.push(e[t])}).always(function(){sortSiteList(n),startTimeout(),e.resolve(n)}),e.promise()}function getschedulesettings(){var e=$.Deferred(),t=new SOAPAction,o=new SOAPGetScheduleSettingsResponse,n=t.sendSOAPAction("GetScheduleSettings",null,o);return $.when(n).done(function(){RadioIDList.map(function(e){var t=RadioIDToBand(e),n=$("#schedule_"+t);for(var i in o.ScheduleInfoLists){var r=o.ScheduleInfoLists[i].ScheduleName;n.append('<option value="'+r+'">'+decode_char_text(r)+"</option>")}n.selectbox({width:"100%"})}),e.resolve()}).fail(function(){e.reject()}),e.promise()}