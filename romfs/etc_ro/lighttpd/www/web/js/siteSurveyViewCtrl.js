/* svn info: $Revision: 1263 $ $Date: 2019-01-22 18:38:43 +0800 (Tue, 22 Jan 2019) $ */
var siteSurveyViewCtrl=function(){function s(){$("#scanSection, #passwordSection").hide()}function c(e){0!=S&&($("body").off("touchmove"),$("#SurveyListTable").off("touchmove"),$("#wrapper").css({height:"","overflow-y":""}),e&&($("#SurveyListTable").on("touchmove",function(e){e.stopPropagation()}),$("body").on("touchmove",function(e){e.preventDefault()}),e=$(window).height(),$("#wrapper").css({height:e,"overflow-y":"hidden"})),$("#survey_key").off("focus").on("focus",function(e){var t=$("#passwordSection");e=$(window).height();var i=t.height();t=t.offset();e=parseInt((e-350)/2-i/2),0<(e=t.top-$(document).scrollTop()-e)&&$(document).scrollTop(e)}))}function t(){$("#SiteSurvey").hide(),c(!1),$(window).resize(function(){})}function r(){$("#SiteSurveySection").css({top:"","max-height":""}),$("#SurveyListTableBlock").css({"max-height":""});var e=$(window).height(),t=$("#SiteSurveySection").outerHeight();e<200&&(e=200),0<(t=parseInt(e/2-t/2))&&t<150?$("#SiteSurveySection").css({top:t,"max-height":""}):150<=t?$("#SiteSurveySection").css({top:150,"max-height":""}):$("#SiteSurveySection").css({top:10,"max-height":e-20}),e=$("#SiteSurveySection").height()-80,$("#SurveyListTableBlock").css({"max-height":e})}function i(e){s(),$("#backBtn").hide(),$("#selectBtn").css("width","100%").html(I18N("j","Select")).attr("disabled",!0).off("click").on("click",function(){var e,t=siteSelected;"NONE"!=t.SupportedSecurity.SecurityInfo[0].SecurityType.toUpperCase()?(e=t,s(),null!=d&&d.resetForm(),d=$("#survey_form").validate({rules:{survey_key:{checkASCIIChar:!0,checkWPAPassword:!0}},submitHandler:function(e){return a(siteSelected),!1},errorPlacement:function(e,t){var i=t.parent();e.insertAfter(i).css({color:"#f00","font-size":"14px","font-weight":"normal"})},skipBr:function(e){return 0!=e.parent("div").length}}),$("#selectBtn").html(I18N("j","OK")).off("click").on("click",function(){$("#survey_form").submit()}),$("#passwordSection_desc").html(I18N("j",'A password is required to join "%s"',HTMLEncode(e.SSID))),$("#survey_key").attr("placeholder",I18N("j","Password")).val(""),$("#backBtn").show(),$("#passwordSection").show(),$("#selectBtn").css("width",""),c(!1),r(),$("#survey_key").focus()):a(t)});var t=$("#SurveyListTable");for(var i in t.html(""),e){var o=e[i],n=(n=(n=(n=(n='<button type="button" class="list-group-item">'+HTMLEncode(o.SSID))+'<span class="stationInfo">')+l(o.SupportedSecurity.SecurityInfo[0].SecurityType))+h(parseInt(o.SignalStrength)))+"</span></button>";u(n=$(n),o),t.append(n)}$("#SiteSurvey").show(),$("#scanSection").show(),r(),c(!0)}function u(e,t){var i="click";S&&(i="touchstart"),e.on(i,function(e){changeTimeoutAction(),siteSelected=t,$("#selectBtn").attr("disabled",!1),$("#SurveyListTable > button").removeClass("list-selected"),$(this).addClass("list-selected"),S&&(n=e.originalEvent.touches[0].pageY)}),S&&e.on("touchmove",function(e){20<=Math.abs(e.originalEvent.touches[0].pageY-n)&&(siteSelected=null,$("#selectBtn").attr("disabled",!0),$("#SurveyListTable > button").removeClass("list-selected"))})}function a(e){$("#APCssid").val(e.SSID),$("#APCssid_auto").html(HTMLEncode(e.SSID)),$("#APCssid_div").hide(),$("#APCssid_div_auto").show(),"NONE"!=e.SupportedSecurity.SecurityInfo[0].SecurityType.toUpperCase()?$("#APCkey").val($("#survey_key").val()).attr("disabled",!1):$("#APCkey").val("").attr("disabled",!0),save_button_changed(),t()}function l(e){var t="";return"NONE"!=e.toUpperCase()&&(t="<img src='image/wisp_security.png?v=d2f4e66b0f' width='15' height='21' />"),t}function h(e){var t="";return e<=35?t="wisp_strength_low.png?v=6dffd34d83":35<e&&e<=70?t="wisp_strength_medium.png?v=c766540a02":70<e&&(t="wisp_strength_high.png?v=e7d7944fbc"),"<img src='image/"+t+"' width='25' height='20' />"}var d=null,o=null,n=0,S=!1;return{init:function(){var e="click";o=d=null,(S=isTouch())&&(e="tap"),$("#closeBtn").on(e,function(){t()}),$("#backBtn").on("click",function(){i(o)})},start:function(){$("#SiteSurvey").hide(),s(),$("#SurveyListTable").html(""),o=siteSelected=null,$(window).resize(function(){r()}),PopView.show(I18N("j","Scanning...")),doSiteSurvey().done(function(e){i(o=e),PopView.hide()}),c(!0)}}}();