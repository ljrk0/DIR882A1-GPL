/* svn info: $Revision: 1314 $ $Date: 2019-03-07 18:25:15 +0800 (Thu, 07 Mar 2019) $ */
function homeTreeMapFn_datalist(t,e,n,r,a,o,i){this.MacAddress=t,this.WiFiSONRole=e,this.HOP=n,this.UplinkMacAddress=r,this.UplinkType=a,this.ErrorCode=o,this.VarInfo=i,this.testRoot=0}$(window).load(function(){var t=!1;$("#extenderTopolotyNextBtn").on("click",function(){0==t&&(t=!0,clearTimeout(getClientInfo_timer),getClientInfo_timer=null,$("svg").remove(),$("#extenderMsgBlock").html(I18N("j","Please wait")+"..."),$("#extenderMsgBlock").show(),$("#content").animate({left:-900},1500),$("#content2").animate({left:0},1500),$("#Total_MeshExtender").html(""),setTimeout(function(){homeTreeMapFn.get1_1(),t=!1},1600))}),$("#extenderTopolotyBackBtn").on("click",function(){0==t&&(t=!0,homeTreeMapFn.closeFn(),$("#content").css({height:"auto"}),$("#contentBox").animate({height:"100%"},1500),$("#content").animate({left:0},1500),$("#content2").animate({left:900},1500),setTimeout(function(){$("svg").remove(),t=!1},1600),null==getClientInfo_timer&&(getClientInfo_timer=setTimeout("Get_ClientInfo()",5e3)))})});var homeTreeMapFn={nowversion:2,getxmldata:[],getxmldata2:[],dataJson:{},dataJson2:{},hasRoot:0,loopNum:0,count:0,nodeCount:0,hop:0,width:0,height:0,nowRun:!1,get_result_getWiFiSONSettings:null,get_result_getClientInfo:null,get_result_getDeviceSettings:null,get_result_finish:null,get3Timer:null,get2_2Timer:null,failFnTimer:null,get1_1:function(){var a,o=this,i=new SOAPAction,s=new SOAPGetWiFiSONSettingsResponse,l=new SOAPGetClientInfoResponse,g=new SOAPGetDeviceSettingsResponse;o.nowRun=!0,1==o.nowversion?o.nowversion=2:o.nowversion=1,o.get_result_getWiFiSONSettings=i.sendSOAPAction("GetWiFiSONSettings",null,s),o.get_result_getClientInfo=o.get_result_getWiFiSONSettings.then(function(){var t=$.Deferred();o.loopNum=0,1==o.nowversion?(o.getxmldata.length=0,o.getxmldata=[],a=o.getxmldata):(o.getxmldata2.length=0,o.getxmldata2=[],a=o.getxmldata2);var e=s.WiFiSONList.WiFiSON;for(var n in s.WiFiSONList.WiFiSON){var r=new homeTreeMapFn_datalist(e[n].MacAddress,e[n].WiFiSONRole,e[n].HOP,e[n].UplinkMacAddress,e[n].UplinkType,e[n].ErrorCode,e[n].VarInfo);a.push(r)}return i.sendSOAPAction("GetClientInfo",null,l).then(function(){t.resolve()},function(){t.reject()}),t.promise()},function(){o.failFn()}),o.get_result_getDeviceSettings=o.get_result_getClientInfo.then(function(){var t=$.Deferred(),e=l.ClientInfoLists.ClientInfo;for(var n in l.ClientInfoLists.ClientInfo)for(var r in a)a[r].MacAddress==e[n].MacAddress&&(a[r].NickName=e[n].NickName,a[r].SignalStrength=e[n].SignalStrength);return i.sendSOAPAction("GetDeviceSettings",null,g).then(function(){t.resolve()},function(){t.reject()}),t.promise()},function(){o.failFn()}),o.get_result_finish=o.get_result_getDeviceSettings.then(function(){for(var t in a)"Master"==a[t].WiFiSONRole&&(a[t].HOP=-1,a[t].NickName=g.DeviceName),"Root"==a[t].WiFiSONRole&&(a[t].testRoot=1);o.nowRun&&o.get1_2()},function(){o.failFn()})},get1_2:function(){var t,e=this;t=1==e.nowversion?e.getxmldata:e.getxmldata2,e.nowRun&&e.get1_3(t)},get1_3:function(t){var e=this;t.sort(function(t,e){return parseInt(t.HOP)-parseInt(e.HOP)}),e.get1_4().then(function(){e.nowRun&&e.get1_5()},function(){e.failFn()})},get1_4:function(){var t,e=$.Deferred(),n=this;return(t=1==n.nowversion?n.getxmldata:n.getxmldata2).length<1?e.reject():-1!=parseInt(t[0].HOP)&&e.reject(),e.resolve(),e.promise()},get1_5:function(){var t=this;if(t.hasRoot=0,1==t.nowversion)if(t.dataJson={},t.dataJson.MacAddress=t.getxmldata[0].MacAddress,t.dataJson.NickName=t.getxmldata[0].NickName,t.dataJson.SignalStrength=t.getxmldata[0].SignalStrength,t.dataJson.WiFiSONRole=t.getxmldata[0].WiFiSONRole,t.dataJson.HOP=t.getxmldata[0].HOP,t.dataJson.UplinkMacAddress=t.getxmldata[0].UplinkMacAddress,t.dataJson.UplinkType=t.getxmldata[0].UplinkType,t.dataJson.ErrorCode=t.getxmldata[0].ErrorCode,t.dataJson.VarInfo=t.getxmldata[0].VarInfo,t.nowRun&&t.get1_6(t.getxmldata,t.getxmldata[0],t.dataJson),1==t.nowRun&&t.loopNum<500){for(var e in t.getxmldata)t.getxmldata[e].HOP==t.getxmldata[t.getxmldata.length-1].HOP&&1==t.getxmldata[t.getxmldata.length-1].testRoot&&(t.hasRoot=1);t.get2_1(t.getxmldata.length,parseInt(t.getxmldata[t.getxmldata.length-1].HOP)+1)}else t.failFn();else if(t.dataJson2={},t.dataJson2.MacAddress=t.getxmldata2[0].MacAddress,t.dataJson2.NickName=t.getxmldata2[0].NickName,t.dataJson2.SignalStrength=t.getxmldata2[0].SignalStrength,t.dataJson2.WiFiSONRole=t.getxmldata2[0].WiFiSONRole,t.dataJson2.HOP=t.getxmldata2[0].HOP,t.dataJson2.UplinkMacAddress=t.getxmldata2[0].UplinkMacAddress,t.dataJson2.UplinkType=t.getxmldata2[0].UplinkType,t.dataJson2.ErrorCode=t.getxmldata2[0].ErrorCode,t.dataJson2.VarInfo=t.getxmldata2[0].VarInfo,t.nowRun&&t.get1_6(t.getxmldata2,t.getxmldata2[0],t.dataJson2),1==t.nowRun&&t.loopNum<500){for(var e in t.getxmldata2)t.getxmldata2[e].HOP==t.getxmldata2[t.getxmldata2.length-1].HOP&&1==t.getxmldata2[t.getxmldata2.length-1].testRoot&&(t.hasRoot=1);t.get2_1(t.getxmldata2.length,parseInt(t.getxmldata2[t.getxmldata2.length-1].HOP)+1)}else t.failFn()},get1_6:function(t,e,n){var r=this;for(var a in t)if(r.loopNum++,-1!=parseInt(t[a].HOP)&&t[a].UplinkMacAddress==e.MacAddress)if(1==e.testRoot&&(t[a].testRoot=1),null==n.children){n.children=[],n.children.push(t[a]);var o=n.children.length-1;r.loopNum<500&&1==r.nowRun&&r.get1_6(t,t[a],n.children[o])}else{n.children.push(t[a]);o=n.children.length-1;r.loopNum<500&&1==r.nowRun&&r.get1_6(t,t[a],n.children[o])}},get2_1:function(t,e){var n=this;n.count=t-1,0==e||1==e||1==n.hasRoot?n.hop=e+1:n.hop=e,5<n.hop&&(n.hop=5),n.get2_2().done(function(){n.width=170*n.hop,n.height=150*n.nodeCount,$("svg").remove(),n.nowRun&&n.get3()})},get2_2:function(){var t=this,e=$.Deferred();return t.nodeCount=0,t.nowRun&&(1==t.nowversion?null==t.dataJson.children?t.nodeCount=1:t.nodeCount<50&&t.jsonCountFn(t.dataJson):null==t.dataJson2.children?t.nodeCount=1:t.nodeCount<50&&t.jsonCountFn(t.dataJson2)),e.resolve(),e.promise()},jsonCountFn:function(t){for(var e=this,n=0;n<t.children.length;n++)null!=t.children[n].children?e.nowRun&&e.nodeCount<50&&e.jsonCountFn(t.children[n]):e.nodeCount++},get3:function(){var t=this,e=I18N("j","Click for diagnostics_ford3").split(",");$("#extenderMsgBlock").hide(),$("#Total_MeshExtender").html(t.count);var n,r=d3.layout.tree().size([t.height,t.width-100]),a=d3.select("#extenderpainting").append("svg").attr("width",t.width).attr("height",t.height).append("g").attr("class","largePaint").attr("transform","translate(40,10)");n=1==t.nowversion?r.nodes(t.dataJson):r.nodes(t.dataJson2);var o=r.links(n),i=(a.selectAll(".link").data(o).enter().append("line").attr("class","link").attr("x1",function(t){return t.source.y}).attr("y1",function(t){return t.source.x}).attr("x2",function(t){return t.target.y}).attr("y2",function(t){return t.target.x}).attr("stroke",function(t){return parseInt(t.target.SignalStrength)<=0?"#CCCCCC":1<=parseInt(t.target.SignalStrength)&&parseInt(t.target.SignalStrength)<=33?"#FF1600":34<=parseInt(t.target.SignalStrength)&&parseInt(t.target.SignalStrength)<=67?"#FDAE2D":"#63B236"}).attr("stroke-dasharray",function(t){return parseInt(t.target.SignalStrength)<=0?"20, 7":"0"}),a.selectAll(".node").data(n).enter().append("g").attr("class","node").attr("transform",function(t){return"translate("+t.y+","+t.x+")"}));i.append("image").attr("xlink:href",function(t){return"Master"==t.WiFiSONRole?"image/extendertopology_router.png?v=b06efe0342":"image/extendertopology_extender.png?v=f87b114c30"}).attr("x","-45px").attr("y","-45px").attr("width","90px").attr("height","90px"),i.append("image").attr("xlink:href",function(t){return"Master"==t.WiFiSONRole?"image/router-wifi.png?v=f608335595":""}).attr("x","-25px").attr("y","-25px").attr("width","50px").attr("height","50px"),i.append("text").attr("dy",-45).attr("fill","#7e7e7e").attr("font-size","14px").style("text-anchor","middle").text(function(t){return 10<t.NickName.length&&(t.NickName=t.NickName.substr(0,10)+"..."),decode_char_text(t.NickName)});a.selectAll(".hintIcon").data(o).enter().append("svg:image").attr("class","hintIcon").attr("xlink:href",function(t){return"image/warning.png?v=f137f563d2"}).attr("x",function(t){return t.source.y+(t.target.y-t.source.y)/2-15}).attr("y",function(t){return t.source.x+(t.target.x-t.source.x)/2-18}).attr("height",function(t){return 30}).attr("width",function(t){return 30}).style("display",function(t){return""==t.target.ErrorCode?"none":"block"});var s=a.selectAll(".meshExtenderHintBtn").data(o).enter().append("g").attr("class","meshExtenderHintBtn").style("display",function(t){return""==t.target.ErrorCode?"none":"block"});s.append("path").attr("d",function(t){var e=t.source.y+(t.target.y-t.source.y)/2-7,n=t.source.y+(t.target.y-t.source.y)/2,r=t.source.y+(t.target.y-t.source.y)/2+7,a=t.source.x+(t.target.x-t.source.x)/2+15,o=t.source.x+(t.target.x-t.source.x)/2+20;return"M "+e+" "+o+" L"+r+" "+o+" L"+n+" "+a+" z"}).attr("stroke","red").attr("stroke-width","2").attr("fill","red"),s.append("svg:rect").attr("class","meshExtenderHintBtn_rect").attr("x",function(t){return e.length<2?t.source.y+(t.target.y-t.source.y)/2-75:t.source.y+(t.target.y-t.source.y)/2-90}).attr("y",function(t){return t.source.x+(t.target.x-t.source.x)/2+20}).attr("height",function(t){return e.length<2?30:50}).attr("width",function(t){return e.length<2?150:180}).attr("rx","5").attr("ry","5").attr("fill","red").attr("cursor","pointer"),s.append("svg:text").attr("class","meshExtenderHintBtn_text").attr("x",function(t){var e=this.getComputedTextLength();return t.source.y+(t.target.y-t.source.y)/2-e/2}).attr("y",function(t){return t.source.x+(t.target.x-t.source.x)/2+18+22}).attr("height",function(t){return 30}).attr("width",function(t){return 80}).attr("fill","#FFFFFF").attr("cursor","pointer").style("text-anchor","middle").text(function(t){return e[0]}),s.append("svg:text").attr("class","meshExtenderHintBtn_text").attr("x",function(t){var e=this.getComputedTextLength();return t.source.y+(t.target.y-t.source.y)/2-e/2}).attr("y",function(t){return t.source.x+(t.target.x-t.source.x)/2+18+22+20}).attr("height",function(t){return e.length<2?0:30}).attr("width",function(t){return 80}).attr("fill","#FFFFFF").attr("cursor","pointer").style("text-anchor","middle").text(function(t){return e.length<2?"":e[1]}),a.selectAll(".meshExtenderHintBtn_rect, .meshExtenderHintBtn_text").on("click",function(t){$(".popup_window_border").css({top:"150px"}),$("#popalert_title").css({"font-size":"20px"}),$("#popalert_desc").css({"text-align":"left"});var e,n=t.target.VarInfo.split(",");e="1"==t.target.ErrorCode?(e=(e=I18N("j",'The uplink signal strength from <span class="errorCodeText">[Audit AP]</span> to <span class="errorCodeText">[Uplink AP]</span> is too weak and may be affecting wireless performance.<br/>Try moving <span class="errorCodeText">[Audit AP]</span> closer to <span class="errorCodeText">[Uplink AP]</span> until the signal is strong enough. You may also place another access point between <span class="errorCodeText">[Audit AP]</span> and <span class="errorCodeText">[Uplink AP]</span> to improve signal strength.')).replace(/\[Audit AP\]/g,n[0])).replace(/\[Uplink AP\]/g,n[2]):"2"==t.target.ErrorCode?(e=(e=I18N("j",'<span class="errorCodeText">[Audit AP]</span> is <span class="errorCodeText">[Hops]</span> hops away within the mesh network. Too many hops may decrease overall wireless performance.<br/>Try connecting the AP <span class="errorCodeText">[Audit AP]</span> to a nearby access point using Ethernet to decrease the amount hops and improve wireless performance.')).replace(/\[Audit AP\]/g,n[0])).replace(/\[Hops\]/g,n[2]):(e=(e=I18N("j",'<span class="errorCodeText">[Audit AP]</span> is currently connected to <span class="errorCodeText">[Num]</span> downlink APs. Too many downlink AP per device may decrease overall wireless performance.<br/>Try adding an additional root AP to share the load of <span class="errorCodeText">[Audit AP]</span> and improve performance.')).replace(/\[Audit AP\]/g,n[0])).replace(/\[Num\]/g,n[2]),PopView.showWarningMSG(I18N("j","Diagnostics"),e).done(function(){PopView.hide(),$(".popup_window_border").css({top:"15%"}),$("#popalert_title").css({"font-size":"16px"}),$("#popalert_desc").css({"text-align":"center"})})});var l=$(".largePaint")[0].getBBox().height,g=(t.height-l)/2;0<l&&($("svg").css({"margin-top":"-"+g+"px"}),$("svg").css({height:$("svg").height()-g+50}));var d=$("svg").outerHeight(!0),c=400-d/2;1==currentDevice.featureUsbPort&&1==currentDevice.featureMeshExtenderTopology&&(c=290-d/2),c<160&&(c=160),$("#extenderpainting").css({"padding-top":c,height:c+d}),$("#content, #content2").css({height:$("#extenderpainting").outerHeight(!0)}),t.get3Timer=setTimeout(function(){t.nowRun&&t.get1_1()},15e3)},failFn:function(){var t=this;t.get_result_getWiFiSONSettings=null,t.get_result_getClientInfo=null,t.get_result_getDeviceSettings=null,t.get_result_finish=null,clearTimeout(t.get3Timer),clearTimeout(t.get2_2Timer),clearTimeout(t.failFnTimer),$("#Total_MeshExtender").html(""),$("#extenderMsgBlock").html(I18N("j","Data error")+", "+I18N("j","Please wait")+"..."),$("#extenderMsgBlock").show(),$("svg").remove(),t.failFnTimer=setTimeout(function(){t.nowRun&&t.get1_1()},5e3)},closeFn:function(){var t=this;t.nowRun=!1,t.get_result_getWiFiSONSettings=null,t.get_result_getClientInfo=null,t.get_result_getDeviceSettings=null,t.get_result_finish=null,clearTimeout(t.get3Timer),clearTimeout(t.get2_2Timer),clearTimeout(t.failFnTimer)}};